!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="cd0fed95-0cf0-4918-aa5a-2d8fe4563401",e._sentryDebugIdIdentifier="sentry-dbid-cd0fed95-0cf0-4918-aa5a-2d8fe4563401")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[20549],{2376:(e,t,s)=>{s.d(t,{ru:()=>y,_c:()=>I,sS:()=>f,v5:()=>p});var o=s(28245),n=s(38541),i=s.n(n),r=s(88382),a=s(65146),l=s(6132),d=s(75500);let c=l.z.object({personaId:l.z.string(),prompt:l.z.string().optional()}),u=l.z.object({personaPresets:l.z.array(c)}),h=l.z.union([l.z.literal("imageGen"),l.z.literal("search"),l.z.literal("think"),l.z.literal("deepsearch")]),m=l.z.object({personaId:l.z.string(),name:l.z.string(),systemPromptName:l.z.string(),disclaimer:l.z.string().optional(),disabledTools:h.array(),prompt:l.z.string().optional()});function p(){let{stage:e}=(0,o.Sf)(),{t}=(0,a.Bd)("base"),s=function(){let e=(0,d.h)();return(0,r.useMemo)(()=>{var t;let s=null==(t=e.PERSONAS)?void 0:t.value;if(!s)return{personaPresets:[]};let o=u.safeParse(s);return o.success?o.data:{personaPresets:[]}},[e.PERSONAS])}(),n=(0,r.useMemo)(()=>({news:t("persona-name.news","Latest News"),romance:t("persona-name.romance","Companion"),unhinged:t("persona-name.unhinged","Unhinged Comedian"),friend:t("persona-name.friend","Loyal Friend"),tutor:t("persona-name.tutor","Homework Helper"),doctor:t("persona-name.doctor_with_quotes",'Grok "Doc"'),therapist:t("persona-name.therapist_with_quotes",'"Therapist"'),scientist:t("persona-name.scientist","Scientist"),coder:t("persona-name.coder","Coder")}),[t]),l=(0,r.useMemo)(()=>g.map(e=>({personaId:e,name:n[e],systemPromptName:v[e],disabledTools:[],prompt:function(e,t){let s=t.personaPresets.find(t=>t.personaId===e);return(null==s?void 0:s.prompt)||""}(e,s)})).filter(t=>!y.includes(t.personaId)||"nopass"!==e).map(e=>m.safeParse(e)).filter(e=>e.success).map(e=>e.data),[e,n,s]),c=(0,r.useMemo)(()=>i().keyBy(l,e=>e.personaId),[l]),h=(0,r.useCallback)(e=>{if(!g.includes(e))return;let t=c[e];if(t)return t},[c]),p=(0,r.useCallback)(e=>{if(!e||!e.personaId||!g.includes(e.personaId))return;let t=c[e.personaId];if(t)return t},[c]);return{personas:l,personaById:c,getPersonaForConversation:p,getPersonaFromId:h}}let g=["news","romance","unhinged","friend","tutor","doctor","therapist"],v={doctor:"grok3_personality_medical_advisor",news:"grok3_personality_latest_news",friend:"grok3_personality_loyal_friend",tutor:"grok3_personality_homework_helper",romance:"grok3_personality_romance_me",unhinged:"grok3_personality_unhinged_comedian",therapist:"grok3_personality_trusted_therapist",scientist:"grok3_personality_science_geek",coder:"grok3_personality_cracked_coder"};function I(e){if(!e)return;let t=i().invert(v)[e];if(f(t))return t}function f(e){return!!e&&g.includes(e)}let y=["romance","unhinged"]},4295:(e,t,s)=>{s.d(t,{c:()=>n,f:()=>i});var o=s(88382);function n(){let[e,t]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{let e=()=>{let e=navigator.userAgent||navigator.vendor;t(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e))};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),e}function i(){let e=navigator.userAgent||navigator.vendor;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e)}},13103:(e,t,s)=>{s.d(t,{Cf:()=>u,Es:()=>m,L3:()=>p,ZJ:()=>d,c7:()=>h,eB:()=>i,lG:()=>a,rr:()=>g,zM:()=>l});var o=s(79342),n=s(61312),i=s(53592),r=s(88382);let a=i.bL,l=i.l9,d=i.ZL;i.bm;let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,o.jsx)(i.hJ,{ref:t,className:(0,n.cn)("fixed inset-0 z-[100] bg-overlay backdrop-blur-[2px] duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});c.displayName=i.hJ.displayName;let u=r.forwardRef((e,t)=>{let{className:s,overlayClassname:r,children:a,...l}=e;return(0,o.jsxs)(d,{children:[(0,o.jsx)(c,{className:r}),(0,o.jsx)(i.UC,{ref:t,className:(0,n.cn)("fixed left-[50%] top-[50%] z-[100] grid translate-x-[-50%] translate-y-[-50%] gap-4 bg-surface-base dark:border dark:border-border-l1 duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",s),onCloseAutoFocus:e=>{e.preventDefault(),document.body.style.pointerEvents=""},...l,children:a})]})});u.displayName=i.UC.displayName;let h=e=>{let{className:t,...s}=e;return(0,o.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};h.displayName="DialogHeader";let m=e=>{let{className:t,...s}=e;return(0,o.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};m.displayName="DialogFooter";let p=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,o.jsx)(i.hE,{ref:t,className:(0,n.cn)("text-lg font-semibold leading-none tracking-tight",s),...r})});p.displayName=i.hE.displayName;let g=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,o.jsx)(i.VY,{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",s),...r})});g.displayName=i.VY.displayName},17014:(e,t,s)=>{s.d(t,{Oj5:()=>b,Qtr:()=>c,c11:()=>h,nfr:()=>p,VAL:()=>v,id:()=>f,vjv:()=>S});var o=s(79342),n=s(40409),i=s(37953);function r(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,i.QP)((0,n.$)(t))}var a=s(88382);let l=e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",...e,children:(0,o.jsx)("path",{d:"m10.828 12 4.95 4.95-1.414 1.415L8 12l6.364-6.364 1.414 1.414z"})}),d=e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 33 33",...e,children:(0,o.jsx)("path",{fill:"currentColor",d:"m13.237 21.04 11.082-8.19c.543-.4 1.32-.244 1.578.38 1.363 3.288.754 7.241-1.957 9.955-2.71 2.714-6.482 3.31-9.93 1.954l-3.765 1.745c5.401 3.697 11.96 2.782 16.059-1.324 3.251-3.255 4.258-7.692 3.317-11.693l.008.009c-1.365-5.878.336-8.227 3.82-13.031q.123-.17.247-.345l-4.585 4.59v-.014L13.234 21.044M10.95 23.031c-3.877-3.707-3.208-9.446.1-12.755 2.446-2.449 6.454-3.448 9.952-1.979L24.76 6.56c-.677-.49-1.545-1.017-2.54-1.387A12.465 12.465 0 0 0 8.675 7.901c-3.519 3.523-4.625 8.94-2.725 13.561 1.42 3.454-.907 5.898-3.251 8.364-.83.874-1.664 1.749-2.335 2.674l10.583-9.466"})}),c=e=>{let{"aria-label":t,className:s,color:n,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,o.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:n,...a},children:(0,o.jsx)(d,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};c.displayName="GrokLogoIcon";let u=e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",...e,children:(0,o.jsx)("path",{d:"M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"})}),h=e=>{let{"aria-label":t,className:s,color:n,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,o.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:n,...a},children:(0,o.jsx)(u,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};h.displayName="PlusIcon";let m=e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",style:{height:24,width:24,marginRight:0},viewBox:"0 0 122.8 122.8",...e,children:(0,o.jsx)("path",{fill:"currentColor",d:"M25.8 77.6c0 7.1-5.8 12.9-12.9 12.9S0 84.7 0 77.6s5.8-12.9 12.9-12.9h12.9zm6.5 0c0-7.1 5.8-12.9 12.9-12.9s12.9 5.8 12.9 12.9v32.3c0 7.1-5.8 12.9-12.9 12.9s-12.9-5.8-12.9-12.9zM45.2 25.8c-7.1 0-12.9-5.8-12.9-12.9S38.1 0 45.2 0s12.9 5.8 12.9 12.9v12.9zm0 6.5c7.1 0 12.9 5.8 12.9 12.9s-5.8 12.9-12.9 12.9H12.9C5.8 58.1 0 52.3 0 45.2s5.8-12.9 12.9-12.9zM97 45.2c0-7.1 5.8-12.9 12.9-12.9s12.9 5.8 12.9 12.9-5.8 12.9-12.9 12.9H97zm-6.5 0c0 7.1-5.8 12.9-12.9 12.9s-12.9-5.8-12.9-12.9V12.9C64.7 5.8 70.5 0 77.6 0s12.9 5.8 12.9 12.9zM77.6 97c7.1 0 12.9 5.8 12.9 12.9s-5.8 12.9-12.9 12.9-12.9-5.8-12.9-12.9V97zm0-6.5c-7.1 0-12.9-5.8-12.9-12.9s5.8-12.9 12.9-12.9h32.3c7.1 0 12.9 5.8 12.9 12.9s-5.8 12.9-12.9 12.9z"})}),p=e=>{let{"aria-label":t,className:s,color:n,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,o.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:n,...a},children:(0,o.jsx)(m,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};p.displayName="SlackLogoIcon";let g=e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",...e,children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.712 4.33a9 9 0 0 1 1.652 1.306c.51.51.944 1.064 1.306 1.652M16.712 4.33l-3.448 4.138m3.448-4.138a9.01 9.01 0 0 0-9.424 0M19.67 7.288l-4.138 3.448m4.138-3.448a9.01 9.01 0 0 1 0 9.424m-4.138-5.976a3.7 3.7 0 0 0-.88-1.388 3.7 3.7 0 0 0-1.388-.88m2.268 2.268a3.77 3.77 0 0 1 0 2.528m-2.268-4.796a3.77 3.77 0 0 0-2.528 0m4.796 4.796a3.75 3.75 0 0 1-.88 1.388 3.7 3.7 0 0 1-1.388.88m2.268-2.268 4.138 3.448m0 0a9 9 0 0 1-1.306 1.652c-.51.51-1.064.944-1.652 1.306m0 0-3.448-4.138m3.448 4.138a9.01 9.01 0 0 1-9.424 0m5.976-4.138a3.77 3.77 0 0 1-2.528 0m0 0a3.7 3.7 0 0 1-1.388-.88 3.7 3.7 0 0 1-.88-1.388m2.268 2.268L7.288 19.67m0 0a9 9 0 0 1-1.652-1.306 9 9 0 0 1-1.306-1.652m0 0 4.138-3.448M4.33 16.712a9.01 9.01 0 0 1 0-9.424m4.138 5.976a3.77 3.77 0 0 1 0-2.528m0 0c.181-.506.475-.982.88-1.388a3.7 3.7 0 0 1 1.388-.88m-2.268 2.268L4.33 7.288m6.406 1.18L7.288 4.33m0 0a9 9 0 0 0-1.652 1.306A9 9 0 0 0 4.33 7.288"})}),v=e=>{let{"aria-label":t,className:s,color:n,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,o.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:n,...a},children:(0,o.jsx)(g,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};v.displayName="SupportIcon";let I=e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",...e,children:(0,o.jsx)("path",{d:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10m0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16m-1-5h2v2h-2zm0-8h2v6h-2z"})}),f=e=>{let{"aria-label":t,className:s,color:n,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,o.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:n,...a},children:(0,o.jsx)(I,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};f.displayName="WarningIcon";let y=e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",...e,children:(0,o.jsx)("path",{d:"M8 2H1l8.26 11.015L1.45 22H4.1l6.388-7.349L16 22h7l-8.608-11.478L21.8 2h-2.65l-5.986 6.886zm9 18L5 4h2l12 16z"})}),S=e=>{let{"aria-label":t,className:s,color:n,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,o.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:n,...a},children:(0,o.jsx)(y,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};S.displayName="XLogoIcon";let b=e=>{let{"aria-label":t,className:s,color:n,disabled:i,size:d="medium",type:c="button",...u}=e,h=(0,a.useRef)(null),m=null!=i?!!i:!t,p="number"==typeof d?{height:d,width:d}:void 0;return(0,o.jsx)("button",{...u,type:c,"aria-disabled":i,"aria-hidden":m,"aria-label":t,className:r("inline-flex items-center justify-center border-none bg-transparent hover:bg-muted/50 rounded-full p-0 m-0 appearance-none disabled:opacity-30",{"w-4 h-4":"x-small"===d,"w-5 h-5":"small"===d,"w-6 h-6":"medium"===d,"w-8 h-8":"large"===d,"w-full h-full":"fill"===d},s),"data-namespace":"@xai/icons","data-slot":"icon",disabled:i,ref:h,style:{color:n,...p},children:(0,o.jsx)(l,{className:r({"w-[1.125rem] h-[1.125rem]":"medium"===d,"w-[1.375rem] h-[1.375rem]":"large"===d,"w-3.5 h-3.5":"x-small"===d,"w-4 h-4":"small"===d,"w-full h-full":"fill"===d}),focusable:"false",style:{fill:"currentColor",...p}})})};b.displayName="ArrowLeftIconButton"},24994:(e,t,s)=>{s.d(t,{R:()=>d});var o=s(79342);s(88382);var n=s(13103),i=s(34500),r=s(41320),a=s(61312),l=s(65146);function d(e){let{open:t,setOpen:s,trigger:d,title:c,description:u,footer:h,children:m,contentClassName:p,headerClassName:g,footerClassName:v,titleClassName:I,descriptionClassName:f,blurBackground:y}=e,{t:S}=(0,l.Bd)();return!(0,r.Di)()&&t?(0,o.jsxs)(n.lG,{open:t,onOpenChange:s,children:[d&&(0,o.jsx)(n.zM,{asChild:!0,children:d}),(0,o.jsxs)(n.Cf,{className:(0,a.cn)("focus:outline-none rounded-none",p),overlayClassname:(0,a.cn)(y&&"backdrop-blur-lg"),"aria-describedby":void 0,children:[(0,o.jsxs)(n.c7,{className:(0,a.cn)(!c&&!u&&"sr-only",g),children:[(0,o.jsx)(n.L3,{className:I,children:null!=c?c:S("dialog.title","Dialog")}),u?(0,o.jsx)(n.rr,{className:f,children:u}):null]}),m,h?(0,o.jsx)(n.Es,{className:v,children:h}):null]})]}):(0,o.jsxs)(i._s,{open:t,onOpenChange:s,dismissible:!!s,children:[d&&(0,o.jsx)(i.Uz,{asChild:!0,children:d}),(0,o.jsxs)(i.zj,{className:(0,a.cn)("focus:outline-none",p,"max-w-none !rounded-b-none"),overlayClassName:(0,a.cn)(y&&"backdrop-blur-lg"),"aria-describedby":void 0,children:[(0,o.jsxs)(i.BE,{className:(0,a.cn)(!c&&!u&&"sr-only","p-0 text-left",g),children:[(0,o.jsx)(i.gk,{className:I,children:null!=c?c:S("dialog.title","Dialog")}),u?(0,o.jsx)(i.I6,{className:f,children:u}):null]}),m,h?(0,o.jsx)(i.tb,{className:(0,a.cn)("pt-2",v),children:h}):null]})]})}},28245:(e,t,s)=>{s.d(t,{Sf:()=>y,TL:()=>S});var o=s(79342),n=s(56691),i=s(24994);s(37931);var r=s(61312),a=s(23232),l=s(38541),d=s.n(l),c=s(32171),u=s.n(c),h=s(68332),m=s(44347),p=s(88382),g=s(65146),v=s(82509),I=s(17823),f=s(69648);d().range(1900,new Date().getFullYear()).map(e=>e.toString()).reverse();let y=(0,v.v)()((0,I.Zr)(e=>({stage:"start",setStage:t=>e({stage:t})}),{name:"age-verif"}));function S(e){let{onPass:t}=e,{t:s}=(0,g.Bd)("base"),{stage:l,setStage:d}=y(),{routeToConversation:c}=(0,h.o)(),v=(0,a._)(),I=(0,p.useCallback)(()=>{v("clicked_signin",void 0,{location:"age-verification"})},[v]),S=(0,p.useCallback)(()=>{d("pass"),null==t||t(),v("selected_over_18","pass",{location:"over-18-verification"})},[t,v,d]),b=(0,p.useCallback)(()=>{d("nopass"),v("selected_over_18","nopass",{location:"over-18-verification"})},[v,d]),w=(0,p.useCallback)(()=>{let{setShowAgeVerification:e}=m.C$.getState();e(!1),c(void 0)},[c]);return(0,o.jsxs)(i.R,{open:"pass"!==l,contentClassName:(0,r.cn)("focus:outline-0 focus-within:outline-0 gap-2","bg-background rounded-3xl","w-full md:w-5/6 lg:w-3/5 max-w-sm","flex flex-col","md:overflow-hidden","px-6 py-6"),blurBackground:!0,headerClassName:(0,r.cn)("nopass"===l&&"mb-4"),titleClassName:(0,r.cn)("nopass"===l&&"mb-1"),title:"nopass"===l?s("Restricted","Restricted"):"start"===l?s("Please confirm your age","Please confirm your age"):null,description:"nopass"===l?s("Restricted.description","Based on the information you provided you cannot use Grok image generation or 18+ personas."):"start"===l?s("Please confirm your age.description","In order to continue using Grok we need to confirm your age."):null,children:["start"===l&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"flex items-center justify-center gap-4 p-1",children:[(0,o.jsx)(n.$n,{className:"w-full",variant:"secondary",onClick:b,tabIndex:-1,children:s("I am not over 18","I am not over 18")}),(0,o.jsx)(n.$n,{className:"w-full",variant:"primary",onClick:S,children:s("I am 18 or older","I am 18 or older")})]}),(0,o.jsxs)("div",{className:"relative flex items-center justify-center w-full",children:[(0,o.jsx)(f.w,{className:"absolute -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2"}),(0,o.jsx)("p",{className:"relative px-2 py-1 mx-auto text-xs bg-background text-secondary",children:s("Or","Or")})]}),(0,o.jsx)(n.$n,{asChild:!0,variant:"secondary",size:"lg",onClick:I,children:(0,o.jsx)(u(),{href:"sign-in",children:s("Sign in or create an account","Sign in or create an account")})})]}),"nopass"===l&&(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(n.$n,{className:"w-full mt-2",variant:"primary",size:"lg",onClick:w,children:s("Start a new chat","Start a new chat")})})]})}},29938:(e,t,s)=>{s.d(t,{Uk:()=>c,X4:()=>d,jN:()=>p,yo:()=>g});var o=s(65258),n=s(38541),i=s.n(n),r=s(6132),a=s(97196);let l="custom_personality_id",d={personalityId:l,name:"Custom",prompt:"",description:"Responds to you as you please.",isPreset:!1};function c(e){return!!e&&(e===l||36===e.length)}function u(e){return{name:e.name,content:[{text:e.prompt}]}}function h(e){var t,s;return{personalityId:e.systemPromptId||"",name:e.name||d.name,prompt:(null==(s=e.content)||null==(t=s[0])?void 0:t.text)||"",description:d.description,isPreset:!1}}class m{constructor(e,t){this.set=e,this.get=t,this.promiseById={},this.byId={},this.list=[],this.draftPromptById={},this.upsertPersonality=(0,o.el)(this.set,"byId","personalityId"),this.appendPersonalities=(0,o.BC)(this.set,"byId","personalityId"),this.removePersonality=(0,o.TF)(this.set,"byId"),this.idsertPersonalityPromise=(0,o.q5)(this.set,"promiseById"),this.removePersonalityPromise=(0,o.TF)(this.set,"promiseById"),this.upsertDraftPrompt=(0,o.q5)(this.set,"draftPromptById"),this.fetchCreatePersonality=e=>{let t=this.get(),s=a.eb.systemPromptRepositoryCreateSystemPrompt({body:u(e)}).then(e=>{let t=h(e);return t.description=d.description,t}).then(e=>(t.upsertPersonality(e),t.idsertPersonalityPromise(s,e.personalityId),e));return s},this.fetchUpdatePersonality=e=>{let t=this.get(),s=a.eb.systemPromptRepositoryUpdateSystemPrompt({systemPromptId:e.personalityId,body:u(e)}).then(e=>h(e)).then(e=>(t.upsertPersonality(e),e));return t.idsertPersonalityPromise(s,e.personalityId),s},this.fetchDeletePersonality=e=>(this.get().removePersonality(e.personalityId),a.eb.systemPromptRepositoryDeleteSystemPrompt({systemPromptId:e.personalityId})),this.fetchListPersonalities=()=>{let e=this.get();return a.eb.systemPromptRepositoryListSystemPrompts({body:{pageSize:100}}).then(e=>{var t;return(null==(t=e.assets)?void 0:t.map(h))||[]}).then(t=>(e.appendPersonalities(t),e.set(e=>({promiseById:{...e.promiseById,...i().mapValues(i().keyBy(t,"personalityId"),e=>Promise.resolve(e))}})),t))},this.fetchGetPersonality=e=>{let t=this.get(),s=e.personalityId;if(s in t.promiseById)return t.promiseById[s];let o=a.eb.systemPromptRepositoryGetSystemPrompt({systemPromptId:s}).then(e=>h(e)).then(e=>(t.upsertPersonality(e),t.idsertPersonalityPromise(o,e.personalityId),e));return o}}}let p=(0,o.y$)(m,"usePersonalityStore");(0,o.lB)(p,"byId","list",Object.values);let g=r.z.object({personalityId:r.z.string(),name:r.z.string(),prompt:r.z.string(),description:r.z.string(),isPreset:r.z.boolean()});r.z.array(g)},34500:(e,t,s)=>{s.d(t,{BE:()=>h,I6:()=>g,Uz:()=>l,_s:()=>a,gk:()=>p,tb:()=>m,zj:()=>u});var o=s(79342),n=s(88382),i=s(62961),r=s(61312);let a=e=>{let{shouldScaleBackground:t=!0,...s}=e;return(0,o.jsx)(i._.Root,{shouldScaleBackground:t,...s})};a.displayName="Drawer";let l=i._.Trigger,d=i._.Portal;i._.Close;let c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,o.jsx)(i._.Overlay,{ref:t,className:(0,r.cn)("fixed inset-0 z-50 bg-black/20 dark:bg-black/80",s),...n})});c.displayName=i._.Overlay.displayName;let u=n.forwardRef((e,t)=>{let{className:s,overlayClassName:n,disableDrag:a,children:l,...u}=e;return(0,o.jsxs)(d,{children:[(0,o.jsx)(c,{className:n}),(0,o.jsxs)(i._.Content,{ref:t,className:(0,r.cn)("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[24px] bg-surface-base dark:border dark:border-border-l1",s),onCloseAutoFocus:e=>{e.preventDefault(),document.body.style.pointerEvents=""},...u,children:[a?null:(0,o.jsx)("div",{className:"flex-shrink-0 w-12 h-1 mx-auto mt-3 mb-0 rounded-full bg-secondary/80"}),l]})]})});u.displayName="DrawerContent";let h=e=>{let{className:t,...s}=e;return(0,o.jsx)("div",{className:(0,r.cn)("grid gap-1.5 p-4 text-center sm:text-left",t),...s})};h.displayName="DrawerHeader";let m=e=>{let{className:t,...s}=e;return(0,o.jsx)("div",{className:(0,r.cn)("mt-auto flex flex-col gap-2 p-4",t),...s})};m.displayName="DrawerFooter";let p=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,o.jsx)(i._.Title,{ref:t,className:(0,r.cn)("text-lg font-semibold leading-none tracking-tight",s),...n})});p.displayName=i._.Title.displayName;let g=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,o.jsx)(i._.Description,{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",s),...n})});g.displayName=i._.Description.displayName},36936:(e,t,s)=>{s.d(t,{V:()=>i});var o=s(65258);class n{constructor(e,t){this.set=e,this.get=t,this.models=[],this.unavailableModels=[],this.defaultAnonModelId="",this.defaultFreeModelId="",this.defaultProModelId="",this.modelById={},this.isPending=!1}}let i=(0,o.y$)(n,"useModelsStore")},37931:(e,t,s)=>{s.d(t,{bq:()=>d,eb:()=>u,gC:()=>c,l6:()=>a,yv:()=>l});var o=s(79342),n=s(64653),i=s(72055);s(88382);var r=s(61312);function a(e){let{...t}=e;return(0,o.jsx)(n.bL,{"data-slot":"select",...t})}function l(e){let{...t}=e;return(0,o.jsx)(n.WT,{"data-slot":"select-value",...t})}function d(e){let{className:t,size:s="default",children:a,...l}=e;return(0,o.jsxs)(n.l9,{"data-slot":"select-trigger","data-size":s,className:(0,r.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...l,children:[a,(0,o.jsx)(n.In,{asChild:!0,children:(0,o.jsx)(i.D3D,{className:"size-4 opacity-50"})})]})}function c(e){let{className:t,children:s,position:i="popper",...a}=e;return(0,o.jsxs)(n.UC,{"data-slot":"select-content",className:(0,r.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:i,...a,children:[(0,o.jsx)(h,{}),(0,o.jsx)(n.LM,{className:(0,r.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:s}),(0,o.jsx)(m,{})]})}function u(e){let{className:t,children:s,...a}=e;return(0,o.jsxs)(n.q7,{"data-slot":"select-item",className:(0,r.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...a,children:[(0,o.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,o.jsx)(n.VF,{children:(0,o.jsx)(i.Srz,{className:"size-4"})})}),(0,o.jsx)(n.p4,{children:s})]})}function h(e){let{className:t,...s}=e;return(0,o.jsx)(n.PP,{"data-slot":"select-scroll-up-button",className:(0,r.cn)("flex cursor-default items-center justify-center py-1",t),...s,children:(0,o.jsx)(i.Mtm,{className:"size-4"})})}function m(e){let{className:t,...s}=e;return(0,o.jsx)(n.wn,{"data-slot":"select-scroll-down-button",className:(0,r.cn)("flex cursor-default items-center justify-center py-1",t),...s,children:(0,o.jsx)(i.D3D,{className:"size-4"})})}},38614:(e,t,s)=>{s.d(t,{vC:()=>U,aP:()=>O});var o=s(55881),n=s(58192),i=s(44845),r=s(83626),a=s(17703),l=s(33960);class d{static getInstance(){return d.instance||(d.instance=new d),d.instance}startVoiceSession(e){let{sessionId:t,voiceId:s,personalityId:o,customInstructions:n,playbackSpeed:i,enableSearch:r,enableVision:l}=e,d=Date.now();this.currentSession={sessionId:t,requestId:null,connectionStartTime:d,voiceId:s,personalityId:o,customInstructions:n,playbackSpeed:i,enableSearch:r,enableVision:l,userTurns:0,assistantTurns:0,errors:[],personalityChanges:[],voiceChanges:[],manualMessagesSent:0},(0,a.iu)("voice_session_started",t,{location:"voice-metrics-tracker",sessionId:t,voiceId:s,personalityId:o||"none",customInstructions:n||"none",playbackSpeed:i.toString(),enableSearch:r.toString(),enableVision:l.toString()}),this.trackPersonalityChange({fromPersonality:null,toPersonality:o,fromCustomInstructions:null,toCustomInstructions:n}),this.trackVoiceChange({fromVoice:null,toVoice:s}),this.trackPlaybackSpeedChange({fromSpeed:1,toSpeed:i})}trackLivekitTokenReceived(e){this.currentSession&&!this.currentSession.livekitTokenReceivedTime&&(this.currentSession.livekitTokenReceivedTime=Date.now(),this.currentSession.requestId=e,(0,a.iu)("voice_livekit_token_received",this.currentSession.sessionId,{location:"voice-metrics-tracker",sessionId:this.currentSession.sessionId,requestId:e||"unavailable",timestamp:this.currentSession.livekitTokenReceivedTime.toString(),duration:(this.currentSession.livekitTokenReceivedTime-this.currentSession.connectionStartTime).toString()}))}trackLocalTrackSubscribed(){this.currentSession&&this.currentSession.livekitTokenReceivedTime&&!this.currentSession.trackSubscribedTime&&(this.currentSession.trackSubscribedTime=Date.now(),(0,a.iu)("voice_local_track_subscribed",this.currentSession.sessionId,{location:"voice-metrics-tracker",sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",timestamp:this.currentSession.trackSubscribedTime.toString(),duration:(this.currentSession.trackSubscribedTime-this.currentSession.livekitTokenReceivedTime).toString()}))}trackConversationCreated(e){let{conversationId:t,connectionState:s}=e;if(!this.currentSession||!this.currentSession.trackSubscribedTime||this.currentSession.conversationCreatedTime)return;let o=Date.now();this.currentSession.conversationCreatedTime=o,(0,a.iu)("voice_conversation_created",this.currentSession.sessionId,{location:"voice-metrics-tracker",sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",conversationId:t||"unavailable",connectionState:s,timestamp:o.toString(),duration:(o-this.currentSession.trackSubscribedTime).toString()})}trackConnectionReady(){if(!this.currentSession)return;let e=Date.now();this.currentSession.readyTime=e,(0,a.iu)("voice_connection_ready",this.currentSession.sessionId,{location:"voice-metrics-tracker",sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",timestamp:e.toString(),duration:(e-this.currentSession.connectionStartTime).toString()})}trackUserTurn(){this.currentSession&&this.currentSession.userTurns++}trackAssistantTurn(){this.currentSession&&this.currentSession.assistantTurns++}trackManualMessage(){this.currentSession&&this.currentSession.manualMessagesSent++}trackPersonalityChange(e){let{fromPersonality:t,toPersonality:s,fromCustomInstructions:o,toCustomInstructions:n}=e;if(!this.currentSession)return;let i={fromPersonality:t,toPersonality:s,fromCustomInstructions:o,toCustomInstructions:n,timestamp:Date.now()};this.currentSession.personalityChanges.push(i),this.currentSession.personalityId=s,this.currentSession.customInstructions=n,(0,a.iu)("voice_personality_changed",n?"custom-instructions":s||void 0,{location:"voice-metrics-tracker",sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",fromPersonality:t||"none",toPersonality:s||"none",fromCustomInstructions:o||"none",toCustomInstructions:n||"none",changeCount:this.currentSession.personalityChanges.length.toString()})}trackVoiceChange(e){let{fromVoice:t,toVoice:s}=e;if(!this.currentSession)return;let o={fromVoice:t,toVoice:s,timestamp:Date.now()};this.currentSession.voiceChanges.push(o),this.currentSession.voiceId=s,(0,a.iu)("voice_voice_changed",s,{location:"voice-metrics-tracker",sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",fromVoice:t||"none",toVoice:s,changeCount:this.currentSession.voiceChanges.length.toString()})}trackPlaybackSpeedChange(e){let{fromSpeed:t,toSpeed:s}=e;this.currentSession&&(this.currentSession.playbackSpeed=s,(0,a.iu)("voice_playback_speed_changed",s.toString(),{location:"voice-metrics-tracker",sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",fromSpeed:t.toString(),toSpeed:s.toString()}))}trackScreenShareStart(){this.currentSession&&(this.currentSession.screenShareStartTime=Date.now(),(0,a.iu)("voice_screen_share_started",void 0,{location:"voice-metrics-tracker",sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable"}))}trackScreenShareEnd(){if(!this.currentSession||!this.currentSession.screenShareStartTime)return;let e=Date.now()-this.currentSession.screenShareStartTime;this.currentSession.screenShareDuration=(this.currentSession.screenShareDuration||0)+e,this.currentSession.screenShareStartTime=void 0,(0,a.iu)("voice_screen_share_ended",e.toString(),{location:"voice-metrics-tracker",sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",duration:e.toString(),totalScreenShareDuration:this.currentSession.screenShareDuration.toString()})}trackError(e,t){if(!this.currentSession)return;let s={type:e,message:t,timestamp:Date.now()};this.currentSession.errors.push(s),(0,a.iu)("voice_session_error",e,{location:"voice-metrics-tracker",sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",errorType:e,errorMessage:t,errorCount:this.currentSession.errors.length.toString()})}endVoiceSession(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"user_initiated";if(!this.currentSession)return;let t=Date.now();this.currentSession.endTime=t,this.currentSession.endReason=e,this.currentSession.readyTime&&(this.currentSession.totalDuration=t-this.currentSession.readyTime),this.currentSession.screenShareStartTime&&this.trackScreenShareEnd(),(0,a.iu)("voice_session_ended",this.currentSession.sessionId,{location:"voice-metrics-tracker",sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",endReason:e,totalDuration:(this.currentSession.totalDuration||0).toString(),livekitTokenReceivedDuration:(this.currentSession.livekitTokenReceivedTime?this.currentSession.livekitTokenReceivedTime-this.currentSession.connectionStartTime:0).toString(),trackSubscribedDuration:(this.currentSession.trackSubscribedTime&&this.currentSession.livekitTokenReceivedTime?this.currentSession.trackSubscribedTime-this.currentSession.livekitTokenReceivedTime:0).toString(),conversationCreatedDuration:(this.currentSession.conversationCreatedTime&&this.currentSession.trackSubscribedTime?this.currentSession.conversationCreatedTime-this.currentSession.trackSubscribedTime:0).toString(),readyDuration:(this.currentSession.readyTime?this.currentSession.readyTime-this.currentSession.connectionStartTime:0).toString(),userTurns:this.currentSession.userTurns.toString(),assistantTurns:this.currentSession.assistantTurns.toString(),totalTurns:(this.currentSession.userTurns+this.currentSession.assistantTurns).toString(),screenShareDuration:(this.currentSession.screenShareDuration||0).toString(),personalityChanges:this.currentSession.personalityChanges.length.toString(),voiceChanges:this.currentSession.voiceChanges.length.toString(),errors:this.currentSession.errors.length.toString(),manualMessages:this.currentSession.manualMessagesSent.toString(),voiceId:this.currentSession.voiceId,personalityId:this.currentSession.personalityId||"none",customInstructions:this.currentSession.customInstructions||"none",enableSearch:this.currentSession.enableSearch.toString(),enableVision:this.currentSession.enableVision.toString()}),this.currentSession=null}trackConnectionStateChange(e,t){this.currentSession&&"disconnected"===t&&"disconnecting"!==e&&this.trackError("unexpected_disconnection","Connection changed from ".concat(e," to ").concat(t))}constructor(){this.currentSession=null}}d.instance=null;let c=d.getInstance();var u=s(65258),h=s(97196),m=s(39488),p=s(49972),g=s(36936),v=s(29938),I=s(43893),f=s(44347),y=s(13511),S=s(83318),b=s(38541),w=s.n(b),C=s(12110),k=s(14908),R=s(27853),_=s(6132),T=s(82509),M=s(17823),x=s(79342);let P=[1];var B=s(98100),E=s(17014),N=s(88382),A=s(65146);let V=e=>{let{modelName:t,reasoningMode:s,waitTimeSeconds:o}=e,{t:n}=(0,A.Bd)("chat"),{modelById:i}=(0,B.GB)(),r=(0,N.useMemo)(()=>{var e;return(null==(e=i[t])?void 0:e.name)||t},[i,t]),a=(0,N.useMemo)(()=>{let e=Math.floor(o/3600),t=Math.floor(o%3600/60);return e>0&&t>0?"".concat(n("time.hours",{defaultValue_one:"{{count}} hour",defaultValue_other:"{{count}} hours",count:e})," ").concat(n("time.minutes",{count:t,defaultValue_one:"{{count}} minutes",defaultValue_other:"{{count}} minutes"})):e>0?n("time.hours",{defaultValue_one:"{{count}} hour",defaultValue_other:"{{count}} hours",count:e}):n("time.minutes",{count:t,defaultValue_one:"{{count}} minutes",defaultValue_other:"{{count}} minutes"})},[o,n]),l=(0,N.useMemo)(()=>"DEEPSEARCH"===s?n("Rate Limit Reached.description-deepsearch","Query limit reached for {{modelName}} with DeepSearch. Limit refreshes in {{time}}.",{modelName:r,time:a}):"DEEPERSEARCH"===s?n("Rate Limit Reached.description-deepersearch","Query limit reached for {{modelName}} with DeeperSearch. Limit refreshes in {{time}}.",{modelName:r,time:a}):"REASONING"===s?n("Rate Limit Reached.description-reasoning","Query limit reached for {{modelName}} with Think. Limit refreshes in {{time}}.",{modelName:r,time:a}):n("Rate Limit Reached.description","Query limit reached for {{modelName}}. Limit refreshes in {{time}}.",{modelName:r,time:a}),[a,r,n,s]);return(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)(E.id,{className:"size-5"}),(0,x.jsx)("div",{className:"font-semibold text-xs",children:l})]})},z=e=>{let{modelName:t,reasoningMode:s,remainingQueries:o,windowSizeSeconds:n}=e,{t:i}=(0,A.Bd)("chat"),{modelById:r}=(0,B.GB)(),a=(0,N.useMemo)(()=>{var e;return(null==(e=r[t])?void 0:e.name)||t},[r,t]),l=(0,N.useMemo)(()=>{let e=Math.floor(n/3600),t=Math.floor(n%3600/60);return e>0&&t>0?"".concat(i("time.hours",{defaultValue_one:"{{count}} hour",defaultValue_other:"{{count}} hours",count:e})," ").concat(i("time.minutes",{count:t,defaultValue_one:"{{count}} minutes",defaultValue_other:"{{count}} minutes"})):e>0?i("time.hours",{defaultValue_one:"{{count}} hour",defaultValue_other:"{{count}} hours",count:e}):i("time.minutes",{count:t,defaultValue_one:"{{count}} minutes",defaultValue_other:"{{count}} minutes"})},[n,i]),d=(0,N.useMemo)(()=>"DEEPSEARCH"===s?i("Remaining Queries.description-deepsearch",{modelName:a,count:o,time:l,defaultValue_one:"One query left for {{modelName}} with DeepSearch. Limit resets every {{time}}.",defaultValue_other:"You have {{count}} remaining queries for {{modelName}} with DeepSearch. Limit resets every {{time}}."}):"DEEPERSEARCH"===s?i("Remaining Queries.description-deepersearch",{modelName:a,count:o,time:l,defaultValue_one:"One query left for {{modelName}} with DeeperSearch. Limit resets every {{time}}.",defaultValue_other:"You have {{count}} remaining queries for {{modelName}} with DeeperSearch. Limit resets every {{time}}."}):"REASONING"===s?i("Remaining Queries.description-reasoning",{modelName:a,count:o,time:l,defaultValue_one:"One query left for {{modelName}} with Think. Limit resets every {{time}}.",defaultValue_other:"You have {{count}} remaining queries for {{modelName}} with Think. Limit resets every {{time}}."}):i("Remaining Queries.description",{modelName:a,count:o,time:l,defaultValue_one:"One query left for {{modelName}}. Limit resets every {{time}}.",defaultValue_other:"You have {{count}} remaining queries for {{modelName}}. Limit resets every {{time}}."}),[o,a,l,i,s]);return(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)(E.id,{className:"size-5"}),(0,x.jsx)("div",{className:"text-xs font-semibold",children:d})]})};function L(e){h.tW.rateLimitsGetRateLimits({body:e}).then(t=>{void 0!==t.remainingQueries&&P.includes(t.remainingQueries)?k.oR.info((0,x.jsx)(z,{reasoningMode:e.requestKind,modelName:e.modelName,remainingQueries:t.remainingQueries,windowSizeSeconds:t.windowSizeSeconds||0}),{duration:7e3}):0===t.remainingQueries&&t.waitTimeSeconds&&k.oR.info((0,x.jsx)(V,{reasoningMode:e.requestKind,modelName:e.modelName,waitTimeSeconds:t.waitTimeSeconds}),{duration:7e3})}).catch(e=>{(0,a.vV)("chat-page-store:checkRateLimits",e)})}function D(e,t){let s=function(e,t){let s=e.trim().replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,"");return s.length>200?s.slice(0,200)+"...":s}(e,200);k.oR.info(s,{duration:7e3}),(0,a.iu)("show_disclaimer",s,{location:"chat-page-store",conversationId:t})}function U(e){if(e)switch(e){case"fast":return m.it.ModelModeFast;case"expert":return m.it.ModelModeExpert;case"heavy":return m.it.ModelModeHeavy;case"auto":return m.it.ModelModeAuto;default:return(0,a.vV)("chat-page-store:modelModeToModelConfigModelMode","Invalid model mode: ".concat(e)),m.it.ModelModeUnknown}}_.z.union([_.z.literal("auto"),_.z.literal("image"),_.z.literal("search"),_.z.literal("modelOnly"),_.z.literal("noSearch")]),_.z.union([_.z.literal("chat"),_.z.literal("voice")]);class j{constructor(e,t){this.set=e,this.get=t,this.activeModelId=n.Sk,this.isRateLimited=!1,this.isThinkingRateLimited=!1,this.isDeepSearchRateLimited=!1,this.isUnauthenticated=!1,this.hasDismissedDisclaimer=!1,this.conversationMode="chat",this.outputMode="auto",this.reasoningMode="none",this.queryBarExpanded=!1,this.isTypingDebounce=!1,this.showStreamingIndicator=!1,this.modelMode="auto",this.metadata={},this.selectedPersonalityId=void 0,this.customPersonality=void 0,this.quotedText=void 0,this.queryByConversationId={},this.chatPageLoaded=!1,this.isDeeperSearchSelected=!1,this.livekitRoom=null,this.livekitToken=null,this.livekitRequestId=null,this.voiceConnectionStatus="disconnected",this.voiceId="Ara",this.voicePersonalityId="assistant",this.voiceCustomInstructions=null,this.voicePlaybackSpeed=1,this.voiceModeTimeoutId=null,this.currentVoiceSessionId=null,this.voiceSessionConversationId=null,this.exitVoiceModePromise=null,this.setModelMode=(0,u.kp)(this.set,"modelMode"),this.setConversationId=(0,u.kp)(this.set,"conversationId"),this.setOptimisticConversationId=(0,u.kp)(this.set,"optimisticConversationId"),this.setLastMessageId=(0,u.kp)(this.set,"lastMessageId"),this.setSidePanelContent=(0,u.kp)(this.set,"sidePanelContent"),this.toggleSidePanelContent=e=>{let t=this.get().sidePanelContent;(null==t?void 0:t.type)===e.type&&t.data===e.data?this.setSidePanelContent(void 0):this.setSidePanelContent(e)},this.setStreamedMessageId=(0,u.kp)(this.set,"streamedMessageId"),this.setActiveModelId=(0,u.kp)(this.set,"activeModelId"),this.setSelectedSystemPromptId=(0,u.kp)(this.set,"selectedSystemPromptId"),this.setIsRateLimited=(0,u.kp)(this.set,"isRateLimited"),this.setIsUnauthenticated=(0,u.kp)(this.set,"isUnauthenticated"),this.setHasDismissedDisclaimer=(0,u.kp)(this.set,"hasDismissedDisclaimer"),this.setOptimisticMessageId=(0,u.kp)(this.set,"optimisticMessageId"),this.setConversationMode=(0,u.kp)(this.set,"conversationMode"),this.setOutputMode=(0,u.kp)(this.set,"outputMode"),this.setReasoningMode=(0,u.kp)(this.set,"reasoningMode"),this.setChatPageLoaded=(0,u.kp)(this.set,"chatPageLoaded"),this.setDefaultAnonModelId=(0,u.kp)(this.set,"defaultAnonModelId"),this.setDefaultFreeModelId=(0,u.kp)(this.set,"defaultFreeModelId"),this.setDefaultProModelId=(0,u.kp)(this.set,"defaultProModelId"),this.setMetadata=(0,u.kp)(this.set,"metadata"),this.setSelectedPersonalityId=(0,u.kp)(this.set,"selectedPersonalityId"),this.setCustomPersonality=(0,u.kp)(this.set,"customPersonality"),this.setQuotedText=(0,u.kp)(this.set,"quotedText"),this.idsetQueryByConversationId=(0,u.q5)(this.set,"queryByConversationId"),this.setQueryBarExpanded=e=>this.set({queryBarExpanded:e}),this.setIsTypingDebounce=e=>this.set({isTypingDebounce:e}),this.setIsDeeperSearchSelected=(0,u.kp)(this.set,"isDeeperSearchSelected"),this.setLivekitRoom=(0,u.kp)(this.set,"livekitRoom"),this.setLivekitToken=(0,u.kp)(this.set,"livekitToken"),this.setLivekitRequestId=(0,u.kp)(this.set,"livekitRequestId"),this.setVoiceConnectionStatus=e=>{let t=this.get().voiceConnectionStatus;this.set({voiceConnectionStatus:e}),this.get().currentVoiceSessionId&&t!==e&&(c.trackConnectionStateChange(t,e),"ready"===e&&c.trackConnectionReady())},this.setVoiceId=(0,u.kp)(this.set,"voiceId"),this.setVoicePersonalityId=(0,u.kp)(this.set,"voicePersonalityId"),this.setVoiceCustomInstructions=(0,u.kp)(this.set,"voiceCustomInstructions"),this.setVoicePlaybackSpeed=(0,u.kp)(this.set,"voicePlaybackSpeed"),this.setVoiceModeTimeoutId=(0,u.kp)(this.set,"voiceModeTimeoutId"),this.setCurrentVoiceSessionId=(0,u.kp)(this.set,"currentVoiceSessionId"),this.setVoiceSessionConversationId=(0,u.kp)(this.set,"voiceSessionConversationId"),this.isErrorRetryable=e=>{let t=(0,l.G1)(e);return 429===t?(this.setIsRateLimited(!0),!1):401===t?(this.setIsUnauthenticated(!0),!1):!(t&&t>=400&&t<500||e.message.includes("Failed to respond")||e.message.includes(y.CZ)||e.message.includes(y.S3))},this.establishNewConversation=async e=>{let{temporary:t,message:s,fileAttachmentIds:o,webpageUrls:a,toolOverrides:l,isPreset:d,persona:c,enableRetries:u,disableArtifactDiff:h,imageEditUri:m,workspaceIds:p,responseMetadata:g,isFromGrokFiles:y,disableToolComposer:S=!1,disableMemory:b=!1,ff:C}=e,k=this.get(),R=I.A3.getState(),_=f.C$.getState(),T=v.jN.getState(),M=w().get(T.byId,_.userSettings.preferences.selectedSystemPromptId||""),x=k.activeModelId,P=Q(void 0,k.reasoningMode,x),B=void 0,E=(null==M?void 0:M.prompt)||k.customPersonality,N=c&&x!==n.E8?"".concat(E,"\n\n").concat(c.prompt,"."):E,A=!1,V={...k.metadata,...g};return k.setMetadata({}),new Promise((e,n)=>{R.streamCreateAndRespond({temporary:t,message:s,modelName:x,fileAttachmentIds:o,webpageUrls:a,systemPromptName:null==c?void 0:c.systemPromptName,personaId:null==c?void 0:c.personaId,toolOverrides:null!=l?l:q(k.outputMode,P),isPreset:d,customInstructions:B,customPersonality:N,deepsearchPreset:(0,i.Ku)(P),isReasoning:"think"===P,imageEditUri:m,enableRetries:u,disableArtifactDiff:h,workspaceIds:p,responseMetadata:V,isFromGrokFiles:y,disableToolComposer:S,disableMemory:b,modelMode:k.modelMode,onOptimisticConversation:e=>{let{conversationId:t}=e;k.setOptimisticConversationId(t)},onOptimisticResponse:e=>{let{responseId:t}=e;k.setOptimisticMessageId(t)},onStart:e=>{var t;k.setStreamedMessageId(null==(t=e[0])?void 0:t.responseId)},onConversation:t=>{k.setConversationId(t.conversationId),k.setOptimisticConversationId(void 0),A=!0,e(t)},onUserResponse:e=>{k.setLastMessageId(e.responseId),k.setOptimisticMessageId(e.responseId)},onStartExperiment:e=>{},onRealResponseId:e=>{k.setStreamedMessageId(e)},onCitations:()=>{},onDisclaimer:c?()=>{}:D,onHasImage:(0,r.S)(()=>_.setShowAgeVerification(!0)),onClose:e=>{let t=w().first(e);t&&this.get().lastMessageId===t.parentResponseId&&(k.setLastMessageId(t.responseId),k.setStreamedMessageId(t.responseId)),L({modelName:x,requestKind:(0,i.ot)(P)}),A?k.setOptimisticConversationId(void 0):n(Error("Not resolved by close"))},onWke:e=>{"RateLimitError"===e.name&&k.setIsRateLimited(!0),n(e)},onError:this.isErrorRetryable,ff:C}).catch(e=>{n(e)})})},this.sendResponse=async e=>{var t;let{message:s,parentResponseId:o,parentQuotedText:a,conversationId:l,fileAttachmentIds:d,webpageUrls:c,toolOverrides:u,setOpimisticUserResponse:h,setUserResponse:m,onOptimisticUserResponse:p,onError:g,imageEditUri:y,persona:S,enableRetries:b,disableArtifactDiff:C,metadata:k,followUpType:R,reasoningMode:_,isFromGrokFiles:T,resumeResponseId:M,disableToolComposer:x=!1,disableMemory:P=!1,modelIdOverride:B,ff:E,threadParentId:N}=e,A=this.get(),V=I.A3.getState(),z=f.C$.getState(),U=v.jN.getState(),j=w().get(U.byId,z.userSettings.preferences.selectedSystemPromptId||""),O=null!=B?B:A.activeModelId,F=void 0,G=null!=(t=(null==j?void 0:j.prompt)||A.customPersonality)?t:"",W=S&&O!==n.E8?"".concat(G,"\n\n").concat(S.prompt,"."):G;N||A.setLastMessageId(o);let H=Q(_,A.reasoningMode,O),K={...A.metadata,...k};return A.setMetadata({}),new Promise((e,t)=>{V.streamResponse({message:s,metadata:K,parentResponseId:o,parentQuotedText:a,conversationId:l,modelName:O,systemPromptName:null==S?void 0:S.systemPromptName,fileAttachmentIds:d,webpageUrls:c,toolOverrides:{...q(A.outputMode,H),...null!=u?u:{}},customInstructions:F,customPersonality:W,deepsearchPreset:(0,i.Ku)(H),isReasoning:"think"===H,imageEditUri:y,enableRetries:b,disableArtifactDiff:C,followUpType:R,isFromGrokFiles:T,resumeResponseId:M,disableToolComposer:x,disableMemory:P,threadParentId:N,modelMode:A.modelMode,onOptimisticUserResponse:e=>{h&&(A.setOptimisticMessageId(e.responseId),null==p||p(e))},onOptimisticModelResponse:e=>{A.setStreamedMessageId(e.responseId)},onStart:e=>{var t;A.setStreamedMessageId(null==(t=e[0])?void 0:t.responseId)},onUserResponse:e=>{m&&(N||A.setLastMessageId(e.responseId),A.setOptimisticMessageId(e.responseId))},onStartExperiment:e=>{},onRealResponseId:e=>{A.setStreamedMessageId(e)},onCitations:()=>{},onDisclaimer:S?()=>{}:D,onHasImage:(0,r.S)(()=>z.setShowAgeVerification(!0)),onClose:s=>{let o=w().first(s);if(o&&!N&&this.get().lastMessageId===o.parentResponseId&&(A.setLastMessageId(o.responseId),A.setStreamedMessageId(o.responseId)),s.length&&s.every(e=>"closed"===e.state))e(s);else{let e=Error("Responses missing, errored, or not closed");null==g||g(e),t(e)}L({modelName:O,requestKind:(0,i.ot)(H)})},onWke:e=>{"RateLimitError"===e.name&&A.setIsRateLimited(!0),null==g||g(e),t(e)},onError:this.isErrorRetryable,ff:E}).catch(e=>{null==g||g(e),t(e)})})},this.reconnectToInflightResponses=async(e,t,s)=>{let o=this.get(),n=I.A3.getState(),l=f.C$.getState(),d=o.activeModelId;try{let c=await n.fetchListInflightResponses(e);if(!c.length)return;let u=w().maxBy(c,e=>new Date(e.createTime?e.createTime:0));if(!u)return;if(!u.responseId)return void(0,a.vV)("chat-page-store:reconnectToInflightResponses","Inflight response missing response id");if(!u.parentResponseId)return void(0,a.vV)("chat-page-store:reconnectToInflightResponses","Inflight response missing parent response id:");o.setLastMessageId(u.parentResponseId),await n.reconnectToResponse({inflightResponse:u,conversationId:e,modelName:d,parentResponseId:u.parentResponseId,enableRetries:t,isReasoning:"think"===o.reasoningMode,deepsearchPreset:(0,i.Ku)(o.reasoningMode),modelMode:o.modelMode,onStart:e=>{let t=e[0];t&&o.setStreamedMessageId(t.responseId)},onCitations:()=>{},onDisclaimer:D,onHasImage:(0,r.S)(()=>l.setShowAgeVerification(!0)),onClose:e=>{let t=w().first(e);t&&(o.setLastMessageId(t.responseId),o.setStreamedMessageId(void 0)),L({modelName:d,requestKind:(0,i.ot)(o.reasoningMode)})},onWke:e=>{"RateLimitError"===e.name&&o.setIsRateLimited(!0),(0,a.vV)("chat-page-store:reconnectToInflightResponses","Error reconnecting to inflight response")},onError:this.isErrorRetryable,ff:s})}catch(e){(0,a.vV)("chat-page-store:reconnectToInflightResponses","Error checking inflight responses")}},this.requestLivekitToken=async e=>{let{livekitUrl:t,conversationId:s,ff:n}=e,i=this.get(),r=null===o.sessionStoreState||void 0===o.sessionStoreState?void 0:o.sessionStoreState.getState();try{var l,d,c;let e=await h.hx.livekitCreateToken({body:{conversationId:s,sessionPayload:JSON.stringify({...G({username:null==r||null==(l=r.user)?void 0:l.givenName,customInstructions:i.voiceCustomInstructions,voiceId:i.voiceId,personalityId:i.voicePersonalityId,playbackSpeed:i.voicePlaybackSpeed,ff:n}),enable_vision:(null==(c=i.livekitRoom)||null==(d=c.localParticipant)?void 0:d.isScreenShareEnabled)||!1,turn_detection:{type:"server_vad"}}),requestAgentDispatch:!1,livekitUrl:t}});if(!e.token)throw Error("No livekit token returned");return i.setLivekitToken(e.token),i.setLivekitRequestId(e.requestId||null),{token:e.token,requestId:e.requestId||null}}catch(e){throw(0,a.vV)("chat-page-store:requestLivekitToken","Failed to get livekit token"),e}},this.enterVoiceMode=async e=>{var t,s;let{livekitUrl:o,ff:n}=e,i=this.get();if(this.voiceModeTimeoutId&&(clearTimeout(this.voiceModeTimeoutId),this.setVoiceModeTimeoutId(null)),"voice"===i.conversationMode&&"disconnected"!==i.voiceConnectionStatus)throw(0,a.vV)("chat-page-store:enterVoiceMode","Already in voice mode"),Error("Already in voice mode");let r=(0,R.A)();this.setCurrentVoiceSessionId(r),this.setVoiceSessionConversationId(i.conversationId||"no-conversation-id"),c.startVoiceSession({sessionId:r,voiceId:i.voiceId,personalityId:i.voicePersonalityId,customInstructions:i.voiceCustomInstructions,playbackSpeed:i.voicePlaybackSpeed,enableSearch:F({personalityId:i.voicePersonalityId,voiceId:i.voiceId,ff:n}),enableVision:!!(null==(s=i.livekitRoom)||null==(t=s.localParticipant)?void 0:t.isScreenShareEnabled)}),this.setConversationMode("voice"),this.setVoiceConnectionStatus("connecting"),(0,S.He)("silent");try{let e=new S.Wv({publishDefaults:{screenShareEncoding:{maxBitrate:35e5,maxFramerate:1}}});this.setLivekitRoom(e);let{token:t,requestId:s}=await this.requestLivekitToken({livekitUrl:o,conversationId:i.conversationId,ff:n});c.trackLivekitTokenReceived(s),e.prepareConnection(o,t).catch(e=>{(0,a.vV)("chat-page-store:enterVoiceMode",e.message),c.trackError("connection_prepare_failed",e.message)});let r=null,l=new Promise(e=>{r=e});e.on(S.u9.Disconnected,async()=>{await this.exitVoiceMode("connection_lost")}),e.on(S.u9.Reconnecting,()=>{this.setVoiceConnectionStatus("reconnecting")}),e.on(S.u9.Reconnected,()=>{this.setVoiceConnectionStatus("connected")}),e.on(S.u9.LocalTrackSubscribed,e=>{e.source===S.CC.Source.Microphone&&c.trackLocalTrackSubscribed()}),e.on(S.u9.ParticipantDisconnected,async()=>(c.trackError("participant_disconnected","Participant disconnected"),this.exitVoiceMode("participant_disconnected").finally(()=>{k.oR.error("Voice connection lost")}))),e.on(S.u9.DataReceived,(e,t,s,o)=>{let n=new TextDecoder().decode(e);if("realtime_server_events"===o){let e=JSON.parse(n);switch(e.type){case"ping":return this.handleVoiceConnectionPing();case"conversation.created":var i;if(c.trackConversationCreated({conversationId:null==e||null==(i=e.conversation)?void 0:i.id,connectionState:this.get().voiceConnectionStatus}),["connecting","reconnecting","connected"].includes(this.get().voiceConnectionStatus))return this.setVoiceConnectionStatus("ready"),r&&r(),this.handleConversationCreated(e);break;case"conversation.item.created":return this.handleConversationItemCreated(e);case"response.created":return this.handleAssistantVoiceResponseCreated(e);case"response.audio_transcript.delta":return this.handleAssistantVoiceResponseTranscriptDelta(e);case"response.search.result":return this.handleVoiceResponseSearchResult(e);case"response.grok.output":return this.handleVoiceGrokOutput(e)}}}),e.localParticipant.on(S.YI.LocalTrackPublished,e=>{if(e.source===S.CC.Source.ScreenShare)return c.trackScreenShareStart(),i.sendVoiceSettingsUpdate({voiceId:i.voiceId,voicePersonalityId:i.voicePersonalityId,voiceCustomInstructions:i.voiceCustomInstructions,voicePlaybackSpeed:i.voicePlaybackSpeed,ff:n})}),e.localParticipant.on(S.YI.LocalTrackUnpublished,e=>{if(e.source===S.CC.Source.ScreenShare)return c.trackScreenShareEnd(),i.sendVoiceSettingsUpdate({voiceId:i.voiceId,voicePersonalityId:i.voicePersonalityId,voiceCustomInstructions:i.voiceCustomInstructions,voicePlaybackSpeed:i.voicePlaybackSpeed,ff:n})}),await e.connect(o,t).then(()=>this.setVoiceConnectionStatus("connected")),await e.localParticipant.setMicrophoneEnabled(!0,{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}).catch(e=>{throw(0,a.vV)("chat-page-store:enterVoiceMode",e.message),c.trackError("microphone_enable_failed",e.message),Error("mic-permission-denied")});let d=new Promise((e,t)=>{this.setVoiceModeTimeoutId(setTimeout(()=>{(0,a.vV)("chat-page-store:enterVoiceMode","Connection ready timeout after 10 seconds"),t(Error("Voice connection ready timeout after 10 seconds"))},1e4))});try{await Promise.race([l,d]),this.get().voiceModeTimeoutId&&(clearTimeout(this.get().voiceModeTimeoutId),this.setVoiceModeTimeoutId(null))}catch(e){throw this.get().voiceModeTimeoutId&&(clearTimeout(this.get().voiceModeTimeoutId),this.setVoiceModeTimeoutId(null)),c.trackError("enter_voice_mode_timeout","Connection ready timeout after 10 seconds"),await this.exitVoiceMode("connection_timeout"),e}}catch(s){let e=s.message||"Unknown error",t="connection_error";throw(null==e?void 0:e.includes("Permission denied"))||(null==e?void 0:e.includes("NotAllowedError"))||"mic-permission-denied"===e?(e="mic-permission-denied",t="mic_permission_denied"):((null==e?void 0:e.includes("Rate limit exceeded"))||(null==e?void 0:e.includes("429")))&&(e="rate-limit-exceeded",t="rate_limit_exceeded"),(0,a.vV)("chat-page-store:enterVoiceMode",(null==s?void 0:s.message)||e),c.trackError("enter_voice_mode_failed",(null==s?void 0:s.message)||e),await this.exitVoiceMode(t),Error(e)}},this.exitVoiceMode=async e=>{let t=this.get();if("disconnected"!==t.voiceConnectionStatus){if("disconnecting"===t.voiceConnectionStatus&&this.exitVoiceModePromise)return this.exitVoiceModePromise;this.exitVoiceModePromise=this.performExitVoiceMode(e);try{await this.exitVoiceModePromise}finally{this.exitVoiceModePromise=null}}},this.performExitVoiceMode=async e=>{let t=this.get(),s=p.w.getState();if(t.setVoiceConnectionStatus("disconnecting"),t.currentVoiceSessionId&&(c.endVoiceSession(e),this.setCurrentVoiceSessionId(null)),t.voiceModeTimeoutId&&(clearTimeout(t.voiceModeTimeoutId),this.setVoiceModeTimeoutId(null)),t.streamedMessageId){let e=I.A3.getState(),s=e.byId[t.streamedMessageId];if(!s)return void(0,a.vV)("chat-page-store:performExitVoiceMode","Streamed message not found");let o=s.responseId,n=s.inflightResponseId||(0,R.A)();e.upsertResponse({...s,state:"closed",partial:!0,responseId:n}),this.setStreamedMessageId(void 0),this.setOptimisticMessageId(void 0),this.setLastMessageId(n),e.removeResponse(o)}if(t.livekitRoom){var o;await (null==(o=t.livekitRoom.localParticipant)?void 0:o.publishData(new TextEncoder().encode(""),{topic:"disconnect"}).catch(e=>{(0,a.vV)("chat-page-store:exitVoiceMode",e.message),c.trackError("disconnect_data_publish_failed",e.message)})),await t.livekitRoom.disconnect()}t.optimisticConversationId&&(s.removeConversation(t.optimisticConversationId),this.setOptimisticConversationId(void 0),s.removeAbortControllerById(t.optimisticConversationId)),this.setLivekitRoom(null),this.setLivekitToken(null),this.setLivekitRequestId(null),this.setVoiceSessionConversationId(null),this.setVoiceConnectionStatus("disconnected"),this.setConversationMode("chat")},this.toggleScreenSharing=async()=>{var e;let t=this.get();if(!(null==t?void 0:t.livekitRoom)||!(null==t||null==(e=t.livekitRoom)?void 0:e.localParticipant)||"ready"!==t.voiceConnectionStatus)throw(0,a.vV)("chat-page-store:startScreenShare","Voice connection not ready"),Error("Voice connection not ready");let s=t.livekitRoom.localParticipant.isScreenShareEnabled;try{await t.livekitRoom.localParticipant.setScreenShareEnabled(!s,{audio:!1,video:!0,selfBrowserSurface:"exclude",surfaceSwitching:"include"})}catch(e){throw(0,a.vV)("chat-page-store:toggleScreenSharing",(null==e?void 0:e.message)||"Failed to toggle screen share"),c.trackError("screen_share_toggle_failed",(null==e?void 0:e.message)||"Failed to toggle screen share"),e}},this.sendVoiceSettingsUpdate=async e=>{var t,s,n;let{voiceId:i,voicePersonalityId:r,voiceCustomInstructions:l,voicePlaybackSpeed:d,ff:u}=e,h=this.get();if(!h.livekitRoom||"ready"!==h.voiceConnectionStatus)throw(0,a.vV)("chat-page-store:sendVoiceSessionUpdate","Voice connection not ready or disconnected"),Error("Voice connection not ready or disconnected");let m={voiceId:h.voiceId,voicePersonalityId:h.voicePersonalityId,voiceCustomInstructions:h.voiceCustomInstructions,playbackSpeed:h.voicePlaybackSpeed};(m.voicePersonalityId!==r||m.voiceCustomInstructions!==l)&&c.trackPersonalityChange({fromPersonality:m.voicePersonalityId,toPersonality:r,fromCustomInstructions:m.voiceCustomInstructions,toCustomInstructions:l}),m.voiceId!==i&&c.trackVoiceChange({fromVoice:m.voiceId,toVoice:i}),m.playbackSpeed!==d&&c.trackPlaybackSpeedChange({fromSpeed:m.playbackSpeed,toSpeed:d}),this.setVoiceId(i),this.setVoicePersonalityId(r),this.setVoiceCustomInstructions(l),this.setVoicePlaybackSpeed(d);let p=null===o.sessionStoreState||void 0===o.sessionStoreState?void 0:o.sessionStoreState.getState(),g={...G({username:null==p||null==(t=p.user)?void 0:t.givenName,voiceId:i,personalityId:r,customInstructions:l,playbackSpeed:d,ff:u}),enable_vision:(null==(n=h.livekitRoom)||null==(s=n.localParticipant)?void 0:s.isScreenShareEnabled)||!1};return h.livekitRoom.localParticipant.publishData(new TextEncoder().encode(JSON.stringify({type:"session.update",session:g})),{topic:"realtime_client_event"}).catch(e=>{throw(0,a.vV)("chat-page-store:sendVoiceSettingsUpdate",e.message),c.trackError("voice_settings_update_failed",e.message),this.setVoiceId(m.voiceId),this.setVoicePersonalityId(m.voicePersonalityId),this.setVoiceCustomInstructions(m.voiceCustomInstructions),this.setVoicePlaybackSpeed(m.playbackSpeed),Error("Failed to send voice settings update")})},this.sendVoiceManualMessage=async e=>{let{message:t}=e,s=this.get();if(!s.livekitRoom||"ready"!==s.voiceConnectionStatus)throw(0,a.vV)("chat-page-store:sendVoiceManualMessage","Voice connection not ready"),Error("Voice connection not ready");return c.trackManualMessage(),s.livekitRoom.localParticipant.publishData(new TextEncoder().encode(t),{topic:"grok.chat"}).catch(e=>{throw(0,a.vV)("chat-page-store:sendVoiceManualMessage",e.message),c.trackError("manual_message_failed",e.message),Error("Failed to send voice message")})},this.handleVoiceConnectionPing=()=>{let e=this.get();return e.livekitRoom?e.livekitRoom.localParticipant.publishData(new TextEncoder().encode(JSON.stringify({timestamp:Date.now()})),{topic:"grok.ping"}):void(0,a.vV)("chat-page-store:handleVoiceConnectionPing","No livekit room available")},this.handleConversationCreated=e=>{let{conversation:t}=e,s=this.get(),o=p.w.getState();if(!s.conversationId&&s.optimisticConversationId){if(!(null==t?void 0:t.id))return(0,a.vV)("chat-page-store:handleConversationCreated","Missing conversation id"),this.exitVoiceMode();let e=o.byId[s.optimisticConversationId];if(!e)return(0,a.vV)("chat-page-store:handleConversationCreated","Optimistic conversation not found"),this.exitVoiceMode();o.removeConversation(s.optimisticConversationId),o.removeAbortControllerById(s.optimisticConversationId);let n={...e,conversationId:t.id,temporary:!1};o.upsertAndCacheConversation(n);let i=new AbortController;o.idsertAbortControllerById(i,t.id),this.setOptimisticConversationId(t.id),this.setVoiceSessionConversationId(t.id)}else if(!s.conversationId&&!s.optimisticConversationId){if(!(null==t?void 0:t.id))return(0,a.vV)("chat-page-store:handleConversationCreated","Missing conversation id"),this.exitVoiceMode();let e={...(0,p.b)({conversationId:t.id,temporary:!1}),mediaTypes:["audio"]};o.upsertAndCacheConversation(e),this.setOptimisticConversationId(t.id);let s=new AbortController;o.idsertAbortControllerById(s,t.id),this.setVoiceSessionConversationId(t.id)}},this.handleConversationItemCreated=e=>{var t,s,o,n,i,r,l,d;let{item:u}=e;if(!u||!u.id)return void(0,a.vV)("chat-page-store:handleConversationItemCreated","Missing item or item.id");if("user"!==u.role||"completed"!==u.status||!(null==(s=u.content)||null==(t=s[0])?void 0:t.text)&&!(null==(n=u.content)||null==(o=n[0])?void 0:o.transcript))return;c.trackUserTurn();let h=this.get(),m=I.A3.getState(),g=p.w.getState(),v=h.conversationId;if(!h.conversationId&&h.optimisticConversationId){let e=g.byId[h.optimisticConversationId];if(!e)return(0,a.vV)("chat-page-store:handleConversationItemCreated","Optimistic conversation not found"),this.exitVoiceMode();let t={...e,temporary:!1,state:"closed"};v=t.conversationId,g.upsertAndCacheConversation(t),h.set({optimisticConversationId:void 0,conversationId:t.conversationId}),m.idsertNodesByConversationId([],t.conversationId)}else if(!h.conversationId||!h.lastMessageId)return void(0,a.vV)("chat-page-store:handleConversationItemCreated","Missing conversationId or lastMessageId");let f=m.byId[u.id];if(f)return void m.upsertResponse({...f,message:(null==(l=u.content)?void 0:l[0].text)||(null==(d=u.content)?void 0:d[0].transcript)||""});let y=h.lastMessageId;if(h.streamedMessageId){let e=I.A3.getState(),t=e.byId[h.streamedMessageId];if(!t)return(0,a.vV)("chat-page-store:handleConversationItemCreated","Streamed message not found"),this.exitVoiceMode();let s=t.responseId,o=t.inflightResponseId||(0,R.A)();y=o,e.upsertResponse({...t,state:"closed",partial:!0,responseId:o,inflightResponseId:void 0}),this.setStreamedMessageId(void 0),this.setOptimisticMessageId(void 0),this.setLastMessageId(o),e.removeResponse(s)}m.createVoiceUserMessage({userResponseId:u.id,conversationId:v,parentResponseId:y,message:(null==(i=u.content)?void 0:i[0].text)||(null==(r=u.content)?void 0:r[0].transcript)||"",onUserResponse:e=>{h.setLastMessageId(e.responseId)},onOptimisticModelResponse:e=>{h.setStreamedMessageId(e.responseId)}})},this.handleAssistantVoiceResponseCreated=e=>{let{response:t}=e;if(!(null==t?void 0:t.id))return void(0,a.vV)("chat-page-store:handleAssistantVoiceResponseCreated","Missing response id");let s=this.get(),o=I.A3.getState();if(!s.streamedMessageId)return;let n=o.byId[s.streamedMessageId];return n&&(null==n?void 0:n.parentResponseId)?o.byId[n.parentResponseId]?void(n.inflightResponseId?o.upsertResponse({...n,message:"",inflightResponseId:t.id,state:"streaming"}):(o.upsertResponse({...n,inflightResponseId:t.id,state:"streaming"}),s.setStreamedMessageId(n.responseId))):void(0,a.vV)("chat-page-store:handleAssistantVoiceResponseCreated","Missing parent response"):void(0,a.vV)("chat-page-store:handleAssistantVoiceResponseCreated","Missing streaming response or parent response id")},this.handleAssistantVoiceResponseTranscriptDelta=e=>{let{response_id:t,delta:s}=e;if(!t||!s)return void(0,a.vV)("chat-page-store:handleAssistantVoiceResponseTranscriptDelta","Missing response_id or delta");let o=I.A3.getState(),n=this.get();if(!n.conversationId)return void(0,a.vV)("chat-page-store:handleAssistantVoiceResponseTranscriptDelta","Missing conversationId");let i=o.byConversationId[n.conversationId];if(!i)return void(0,a.vV)("chat-page-store:handleAssistantVoiceResponseTranscriptDelta","Missing conversation responses");let r=i.find(e=>e.inflightResponseId===t);r&&"streaming"===r.state&&o.upsertResponse({...r,message:r.message+s})},this.handleVoiceGrokOutput=e=>{let{response_id:t,follow_ups:s}=e;if(!t)return void(0,a.vV)("chat-page-store:handleVoiceGrokOutput","Missing response_id");let o=I.A3.getState(),n=this.get();if(!n.conversationId)return void(0,a.vV)("chat-page-store:handleVoiceGrokOutput","Missing conversationId");let i=o.byConversationId[n.conversationId];if(!i)return void(0,a.vV)("chat-page-store:handleVoiceGrokOutput","Missing conversation responses");let r=i.find(e=>e.inflightResponseId===t);r&&(c.trackAssistantTurn(),o.upsertResponse({...r,state:"closed",partial:!1,responseId:t,suggestions:s,inflightResponseId:void 0}),this.setStreamedMessageId(void 0),this.setOptimisticMessageId(void 0),this.setLastMessageId(t),o.removeResponse(r.responseId))},this.handleVoiceResponseSearchResult=e=>{let{response_id:t,x_posts:s,web_search_results:o}=e;if(!t)return void(0,a.vV)("chat-page-store:handleVoiceResponseSearchResult","Missing response_id");if(!(null==s?void 0:s.length)&&!(null==o?void 0:o.length))return;let n=this.get(),i=I.A3.getState();if(!n.conversationId)return void(0,a.vV)("chat-page-store:handleVoiceResponseSearchResult","Missing conversationId");let r=i.byConversationId[n.conversationId];if(!r)return void(0,a.vV)("chat-page-store:handleVoiceResponseSearchResult","Missing conversation responses");let l=i.byId[t]||r.find(e=>e.inflightResponseId===t);if(!l)return void(0,a.vV)("chat-page-store:handleVoiceResponseSearchResult","Missing response");let d=(null==s?void 0:s.map(e=>({username:e.userhandle,name:e.name,text:e.text,createTime:e.create_time,profileImageUrl:e.profile_image_url,postId:e.post_id,viewCount:e.view_count,citationId:e.post_id})))||[],c=(null==o?void 0:o.map(e=>({url:e.url,title:e.title,preview:e.snippet})))||[];i.upsertResponse({...l,xposts:(null==d?void 0:d.length)?d:l.xposts,xpostIds:(null==d?void 0:d.length)?w().compact(null==d?void 0:d.map(e=>e.postId)):l.xpostIds,webSearchResults:(null==c?void 0:c.length)?c:l.webSearchResults}),d.length?n.setSidePanelContent({type:"xPosts",data:d}):c.length&&n.setSidePanelContent({type:"webSearchResults",data:{webSearchResults:c}})},this.setShowStreamingIndicator=(0,u.kp)(this.set,"showStreamingIndicator"),this.abortStream=(e,t)=>{let s=I.A3.getState();return s.abortStream(e,t).then(t=>{let s=O.getState();s.conversationId===e&&(s.setLastMessageId(t),s.setStreamedMessageId(t))}).catch(t=>{let s=O.getState();if(s.conversationId===e)throw s.setStreamedMessageId(void 0),t}).finally(()=>{t&&s.updateResponse(t,{experimentIds:void 0})})}}}let O=(0,T.v)()((0,M.lt)((0,M.eh)((0,M.Zr)((e,t)=>new j(e,t),{name:"chat-preferences",partialize:e=>({outputMode:e.outputMode,activeModelId:e.activeModelId,selectedPersonalityId:e.selectedPersonalityId,customPersonality:e.customPersonality,quotedText:e.quotedText,defaultAnonModelId:e.defaultAnonModelId,defaultFreeModelId:e.defaultFreeModelId,defaultProModelId:e.defaultProModelId,voiceId:e.voiceId,voicePersonalityId:e.voicePersonalityId,voiceCustomInstructions:e.voiceCustomInstructions,voicePlaybackSpeed:e.voicePlaybackSpeed,modelMode:e.modelMode}),version:2})),{name:"useChatPageStore"}));function q(e,t){switch(t){case"deepsearch":case"deepersearch":return{imageGen:void 0,webSearch:void 0,xSearch:void 0,xMediaSearch:void 0,trendsSearch:void 0,xPostAnalyze:void 0,videoGen:void 0}}switch(e){case"modelOnly":return{imageGen:!1,webSearch:!1,xSearch:!1,xMediaSearch:!1,trendsSearch:!1,xPostAnalyze:!1,videoGen:void 0};case"noSearch":return{imageGen:void 0,webSearch:!1,xSearch:!1,xMediaSearch:!1,trendsSearch:!1,xPostAnalyze:!1,videoGen:void 0};default:return{imageGen:void 0,webSearch:void 0,xSearch:void 0,xMediaSearch:void 0,trendsSearch:void 0,xPostAnalyze:void 0,videoGen:void 0}}}function F(e){var t,s,o,n,i,r,a,l,d;let{personalityId:c,voiceId:u,ff:h}=e,m=Array.isArray(null==h||null==(s=h.VOICE_MODE_CONFIG)||null==(t=s.value)?void 0:t.personalities)?null==h||null==(n=h.VOICE_MODE_CONFIG)||null==(o=n.value)?void 0:o.personalities:[],p=(Array.isArray(null==h||null==(r=h.VOICE_MODE_CONFIG)||null==(i=r.value)?void 0:i.voices)?null==h||null==(l=h.VOICE_MODE_CONFIG)||null==(a=l.value)?void 0:a.voices:[]).find(e=>e.id===u),g=!1;return!c||(null==p?void 0:p.disablePersonalities)||(g=(null==(d=m.find(e=>e.id===c&&e.enableSearch))?void 0:d.enableSearch)||!1),g}function G(e){var t,s,o,n;let{username:i,voiceId:r,personalityId:a,customInstructions:l,playbackSpeed:d,ff:c}=e,u=(Array.isArray(null==c||null==(s=c.VOICE_MODE_CONFIG)||null==(t=s.value)?void 0:t.voices)?null==c||null==(n=c.VOICE_MODE_CONFIG)||null==(o=n.value)?void 0:o.voices:[]).find(e=>e.id===r),h=null;!a||(null==u?void 0:u.disablePersonalities)||(h=a);let m=null;return!l||(null==u?void 0:u.disablePersonalities)||(m=l),{instructions:function(e){var t,s,o,n,i,r,a,l,d,c;let{username:u,customInstructions:h,voiceId:m,personalityId:p,ff:g}=e,v=Array.isArray(null==g||null==(s=g.VOICE_MODE_CONFIG)||null==(t=s.value)?void 0:t.voices)?null==g||null==(n=g.VOICE_MODE_CONFIG)||null==(o=n.value)?void 0:o.voices:[],I=Array.isArray(null==g||null==(r=g.VOICE_MODE_CONFIG)||null==(i=r.value)?void 0:i.personalities)?null==g||null==(l=g.VOICE_MODE_CONFIG)||null==(a=l.value)?void 0:a.personalities:[],f=(null==v||null==(d=v.find(e=>e.id===m))?void 0:d.prompt)||"Reminder: You do not need to introduce yourself unless the user asks for your name. You are Grok, a smart and helpful AI assistant created by xAI. You have a PLEASANT female voice. You're a helpful AI assistant that helps get things done. Never use commands and write your answer as if it was a transcript of an audio conversation. You are using your voice to speak aloud, so keep your responses brief.",y=(null==I||null==(c=I.find(e=>e.id===p))?void 0:c.prompt)||"";return"".concat(f," ").concat(p?y:""," ").concat(u?"You are speaking with ".concat(u,". Do not repeat the name unless necessary."):""," ").concat(h||"")}({username:i,customInstructions:m,voiceId:r,personalityId:h,ff:c}),voice:r,personality:h,enable_search:F({personalityId:a,voiceId:r,ff:c}),playback_speed:d}}function Q(e,t,s){var o,n;if(e)return e;let i=g.V.getState().modelById[s];return((null==i||null==(o=i.tags)?void 0:o.includes("think"))||"think"!==t)&&((null==i||null==(n=i.tags)?void 0:n.includes("deepsearch"))||"deepsearch"!==t&&"deepersearch"!==t)?t:"none"}(0,u.lB)(O,"conversationId","optimisticConversationId",()=>void 0),(0,u.lB)(O,"conversationId","lastMessageId",e=>{if(!e)return}),(0,u.lB)(O,"conversationId","streamedMessageId",e=>{if(!e)return}),(0,u.lB)(O,"conversationId","isRateLimited",()=>!1),(0,u.lB)(O,"conversationId","isUnauthenticated",()=>!1),(0,u.lB)(O,"conversationId","hasDismissedDisclaimer",()=>!1),(0,u.lB)(O,"activeModelId","isRateLimited",()=>!1),(0,u.lB)(O,"reasoningMode","isRateLimited",()=>!1),O.subscribe(e=>{"voice"===e.conversationMode&&"disconnecting"!==e.voiceConnectionStatus&&e.voiceSessionConversationId&&("no-conversation-id"===e.voiceSessionConversationId&&e.conversationId||"no-conversation-id"!==e.voiceSessionConversationId&&(e.conversationId&&e.voiceSessionConversationId!==e.conversationId||!e.conversationId&&e.optimisticConversationId!==e.voiceSessionConversationId))&&e.exitVoiceMode("navigation").catch(e=>(0,a.vV)("chat-page-store:handleVoiceModeExit",e))}),!function(e){let t=new C.w("/chat/:chatId").test(window.location.pathname);e.setState({conversationId:t?t.chatId:void 0})}(O)},41320:(e,t,s)=>{s.d(t,{Di:()=>n,Iu:()=>i});var o=s(88382);function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:768,[t,s]=o.useState(void 0);return o.useEffect(()=>{let t=window.matchMedia("(max-width: ".concat(e-1,"px)")),o=()=>{s(window.innerWidth<e)};return t.addEventListener("change",o),s(window.innerWidth<e),()=>t.removeEventListener("change",o)},[e]),!!t}function i(){let e=n();return{isMobileSize:function(){return e},isTouchDevice:function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}}}},41739:(e,t,s)=>{s.d(t,{a:()=>d});var o=s(65258),n=s(38541),i=s.n(n),r=s(82509),a=s(17823);class l{constructor(e,t){var s=this;this.set=e,this.get=t,this.drawerOpen=!1,this.menuFixed=!0,this.menuHidden=!0,this.tabByConversationId={},this.inEditId=void 0,this.upsertConversationAsTab=function(e,t){let o=!(arguments.length>2)||void 0===arguments[2]||arguments[2],n=s.get(),r=t?n.tabByConversationId[t]:void 0;r&&t&&n.removeTab(t);let a=r||n.tabByConversationId[e.conversationId];if(a)return void n.upsertTab({isTemporary:e.temporary,title:e.title,index:a.index,conversationId:e.conversationId,isPreserved:a.isPreserved});n.setTabByConversationId({...i().mapValues(n.tabByConversationId,e=>({...e,index:e.index+1})),[e.conversationId]:{isTemporary:e.temporary,title:e.title,index:0,conversationId:e.conversationId,isPreserved:o}})},this.upsertTab=(0,o.el)(this.set,"tabByConversationId","conversationId"),this.removeTab=(0,o.TF)(this.set,"tabByConversationId"),this.appendTabByConversationId=(0,o.BC)(this.set,"tabByConversationId","conversationId"),this.setTabByConversationId=(0,o.kp)(this.set,"tabByConversationId"),this.setDrawerOpen=(0,o.kp)(this.set,"drawerOpen"),this.toggleMenuFixed=(0,o.L$)(this.set,"menuFixed"),this.setMenuFixed=(0,o.kp)(this.set,"menuFixed"),this.setMenuHidden=(0,o.kp)(this.set,"menuHidden"),this.setInEditId=(0,o.kp)(this.set,"inEditId")}}let d=(0,r.v)()((0,a.eh)((0,a.Zr)((e,t)=>new l(e,t),{name:"active-chat-tabs",storage:(0,a.KU)(()=>localStorage),partialize:e=>({tabByConversationId:i().omitBy(e.tabByConversationId,e=>!e.isTemporary&&e.isPreserved)}),version:2})))},43893:(e,t,s)=>{s.d(t,{Jg:()=>B,Pn:()=>L,Ko:()=>V,Mn:()=>R,dr:()=>P,A3:()=>x});var o=s(38614),n=s(4295),i=s(98100),r=s(48992),a=s(17703),l=s(33960),d=s(65258),c=s(97196),u=s(5129);async function*h(e){if(null===e.body)throw Error("Cannot process response chunks of a response without body.");let t=e.body.getReader(),s=new TextDecoder,o="";for(;;){let{done:e,value:n}=await t.read();if(e)break;let[i,r]=m(o+=s.decode(n,{stream:!0}));for(let e of i)yield e;o=r}let[n,i]=m(o);for(let e of n)yield e;i.length>0&&(yield i)}function m(e){let t=e.split("\n"),s=t.pop();return[t,s]}async function*p(e){for await(let t of h(e))try{let s=JSON.parse(t);(0,u.YM)(s,e),yield s}catch(t){(0,u.YM)(t,e)}}var g=s(44347),v=s(13511),I=s(99452),f=s.n(I),y=s(38541),S=s.n(y),b=s(81353),w=s(6132),C=s(49972),k=s(56096);let R=w.z.object({memoryReferences:w.z.array(w.z.object({conversationId:w.z.string()})).optional().catch(void 0),deepsearchPreset:w.z.string().optional().catch(void 0),ui_layout:w.z.object({reasoningUiLayout:w.z.enum(["UNIFIED","SPLIT"]).optional().catch(void 0)}).optional().catch(void 0),artifactAction:w.z.enum(["ask","explain"]).optional().catch(void 0),agenticWorkspace:w.z.object({workspaceId:w.z.string()}).optional().catch(void 0),requestModelDetails:w.z.object({modelId:w.z.string().nullish(),name:w.z.string().nullish(),description:w.z.string().nullish()}).optional().catch(void 0),modelConfigOverride:g.DC.optional().catch(void 0),isMozart:w.z.boolean().optional().catch(void 0),parentQuotedText:w.z.string().optional().catch(void 0),usedCustomInstructions:w.z.boolean().optional().catch(void 0),is_think_harder:w.z.boolean().optional().catch(void 0)}),_={nodesPromisesByConversationId:{},nodesByConversationId:{},initialResponsesPromisesByConversationId:{},loadMoreResponsesPromisesByConversationId:{},previewResponsesPromisesByConversationIdResponseId:{},conversationImageResponsesPromisesByConversationId:{},byId:{},byConversationId:{},imageIdByUrl:{},inflightPromisesByConversationId:{}};class T{constructor(e,t){var s=this;this.set=e,this.get=t,this.nodesPromisesByConversationId=_.nodesPromisesByConversationId,this.nodesByConversationId=_.nodesByConversationId,this.initialResponsesPromisesByConversationId=_.initialResponsesPromisesByConversationId,this.loadMoreResponsesPromisesByConversationId=_.loadMoreResponsesPromisesByConversationId,this.previewResponsesPromisesByConversationIdResponseId=_.previewResponsesPromisesByConversationIdResponseId,this.conversationImageResponsesPromisesByConversationId=_.conversationImageResponsesPromisesByConversationId,this.byId=_.byId,this.byConversationId=_.byConversationId,this.imageIdByUrl=_.imageIdByUrl,this.inflightPromisesByConversationId=_.inflightPromisesByConversationId,this.upsertResponse=(0,d.el)(this.set,"byId","responseId"),this.updateResponse=(e,t)=>{this.set(s=>({...s,byId:{...s.byId,[e]:{...s.byId[e],...t}}}))},this.appendResponses=(0,d.BC)(this.set,"byId","responseId"),this.removeResponse=(0,d.TF)(this.set,"byId"),this.idsertInitialResponsesPromisesByConversationId=(0,d.q5)(this.set,"initialResponsesPromisesByConversationId"),this.removeInitialResponsesPromiseByConversationId=(0,d.TF)(this.set,"initialResponsesPromisesByConversationId"),this.idsertLoadMoreResponsesPromisesByConversationId=(0,d.q5)(this.set,"loadMoreResponsesPromisesByConversationId"),this.removeLoadMoreResponsesPromiseByConversationId=(0,d.TF)(this.set,"loadMoreResponsesPromisesByConversationId"),this.idsertPreviewResponsesPromisesByConversationIdResponseId=(0,d.q5)(this.set,"previewResponsesPromisesByConversationIdResponseId"),this.removePreviewResponsesPromiseByConversationIdResponseId=(0,d.TF)(this.set,"previewResponsesPromisesByConversationIdResponseId"),this.idsertConversationImageResponsesPromisesByConversationId=(0,d.q5)(this.set,"conversationImageResponsesPromisesByConversationId"),this.removeConversationImageResponsesPromiseByConversationId=(0,d.TF)(this.set,"conversationImageResponsesPromisesByConversationId"),this.setOneImageIdByUrl=(0,d.q5)(this.set,"imageIdByUrl"),this.idsertInflightPromisesByConversationId=(0,d.q5)(this.set,"inflightPromisesByConversationId"),this.idsertNodesByConversationId=(0,d.q5)(this.set,"nodesByConversationId"),this.idsertNodesPromisesByConversationId=(0,d.q5)(this.set,"nodesPromisesByConversationId"),this.removeNodesPromise=(0,d.TF)(this.set,"nodesPromisesByConversationId"),this.fetchListResponseNodes=async e=>{let t=this.get();if(t.nodesByConversationId[e])return t.nodesByConversationId[e];if(e in t.nodesPromisesByConversationId)return t.nodesPromisesByConversationId[e];let s=c.chatApi.chatListResponseNodes({conversationId:e}).then(e=>{let{responseNodes:t=[]}=e;return t});return t.idsertNodesPromisesByConversationId(s,e),s.then(s=>{t.idsertNodesByConversationId(s,e)}).catch((0,a.HX)("response-store:fetchListResponseNodes")).finally(()=>{t.removeNodesPromise(e)}),s},this.fetchListInflightResponses=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=s.get();if(!t&&e in o.inflightPromisesByConversationId)return o.inflightPromisesByConversationId[e];let n=c.chatApi.chatListResponseNodes({conversationId:e}).then(e=>{let{inflightResponses:t=[]}=e;return t});return o.idsertInflightPromisesByConversationId(n,e),n.then(o.appendResponses).catch((0,a.HX)("response-store:fetchListInflightResponses")),n},this.loadResponses=async(e,t)=>{let s=this.get(),o=t.filter(e=>!s.byId[e]);if(o.length){var n;let t=((null==(n=await c.chatApi.chatLoadResponses({conversationId:e,body:{responseIds:o}}))?void 0:n.responses)||[]).map(t=>{let s=R.optional().parse(t.metadata),{toolUsageResultById:o,traceSteps:n}=L(t.steps);return{...t,conversationId:e,memoryReferences:null==s?void 0:s.memoryReferences,deepsearchPreset:null==s?void 0:s.deepsearchPreset,parentQuotedText:null==s?void 0:s.parentQuotedText,usedCustomInstructions:null==s?void 0:s.usedCustomInstructions,toolUsageResultById:o,traceSteps:n,threadParentId:t.threadParentId||""}});s.appendResponses(t)}return t.map(e=>this.get().byId[e]).sort((e,t)=>new Date(e.createTime).getTime()-new Date(t.createTime).getTime())},this.loadInitialResponses=async e=>{let t=this.get(),s=t.initialResponsesPromisesByConversationId[e];if(s)return s;let o=t.nodesPromisesByConversationId[e];return o||(o=this.fetchListResponseNodes(e)),s=(async()=>{try{let s=await o;if(!s.length)return[];let n=s.filter(e=>!e.threadParentId),i=n[n.length-1],a=(0,r.d7)(i.responseId||"",n,30).filter(e=>!!e.responseId).map(e=>e.responseId);return t.loadResponses(e,a)}catch(e){return(0,a.vV)("response-store:loadInitialResponses",e),[]}})().finally(()=>{t.removeInitialResponsesPromiseByConversationId(e)}),t.idsertInitialResponsesPromisesByConversationId(s,e),s},this.loadMoreResponses=async(e,t)=>{let s=this.get(),o=s.nodesByConversationId[e].filter(e=>!e.threadParentId);if(!o.length)return[];if(e in s.initialResponsesPromisesByConversationId)return s.initialResponsesPromisesByConversationId[e];let n=s.loadMoreResponsesPromisesByConversationId[e];return n||(n=(async()=>{try{let n=s.byConversationId[e]||[],i=(0,r.d7)(t,o),a=(0,r.m$)(i,n),l=i.findIndex(e=>e.responseId===(null==a?void 0:a.responseId)),d=i.slice(l+1,l+30+1).filter(e=>!!e.responseId).map(e=>e.responseId);return s.loadResponses(e,d)}catch(e){return(0,a.vV)("response-store:loadMoreResponses",e),[]}})().finally(()=>{s.removeLoadMoreResponsesPromiseByConversationId(e)}),s.idsertLoadMoreResponsesPromisesByConversationId(n,e)),n},this.loadPreviewResponses=async(e,t)=>{let s=this.get(),o=s.nodesPromisesByConversationId[e];o||(o=this.fetchListResponseNodes(e));let n=s.previewResponsesPromisesByConversationIdResponseId[e+t];return n||(n=(async()=>{try{let n=await o,i=(0,r.d7)(n[n.length-1].responseId,n);if(!i.length)return{responses:[],hasOlderResponses:!1,hasNewerResponses:!1};let a=[];if(t&&i.some(e=>e.responseId===t)){let e=i.findIndex(e=>e.responseId===t),s=Math.max(0,e-5);a=i.slice(s,e+5+1).map(e=>e.responseId)}else a=i.slice(0,10).map(e=>e.responseId);let l=i[i.length-1],d=i[0],c=await s.loadResponses(e,a);return{responses:c,hasOlderResponses:!(null==c?void 0:c.some(e=>e.responseId===l.responseId)),hasNewerResponses:!(null==c?void 0:c.some(e=>e.responseId===d.responseId))}}catch(e){return(0,a.vV)("response-store:loadPreviewResponses",e),{responses:[],hasOlderResponses:!1,hasNewerResponses:!1}}})(),s.idsertPreviewResponsesPromisesByConversationIdResponseId(n,e+t)),n},this.loadConversationBranch=async(e,t,s)=>{let o=this.get(),n=o.nodesByConversationId[e];if(!n.length)return[];let i=(0,r.d7)(t,n),a=i.slice(0,i.findIndex(e=>e.responseId===s)+1).filter(e=>!!e.responseId).map(e=>e.responseId);return o.loadResponses(e,a)},this.loadConversationImageResponses=async e=>{let t=this.get(),s=t.nodesPromisesByConversationId[e];s||(s=this.fetchListResponseNodes(e));let o=t.conversationImageResponsesPromisesByConversationId[e];return o||(o=(async()=>{try{let o=(await s).map(e=>e.responseId);return await t.loadResponses(e,o)}catch(e){return(0,a.vV)("response-store:loadConversationImageResponses",e),[]}})().finally(()=>{t.removeConversationImageResponsesPromiseByConversationId(e)}),t.idsertConversationImageResponsesPromisesByConversationId(o,e)),o},this.processResponseChunk=e=>{var t,s,o,n,i,r,a,l,d;let{currentStreamResponse:c,responseChunk:u,onCitations:h,onHasImage:m,onDisclaimer:p,onFollowUpSuggestedMode:g,onUiLayout:v,onRealResponseId:I}=e,f=this.get(),{responseId:y,token:b,modelResponse:w,webSearchResults:C,citedWebSearchResults:k,xSearchResults:R,queryAction:_,cachedImageGenerationResponse:T,followUpSuggestions:M,cardAttachment:x,streamingImageGenerationResponse:P,finalMetadata:B,isThinking:E,messageTag:N,messageStepId:A,bannerMessage:V,disclaimer:z,imageAttachmentInfo:L,progressReport:D,memoryReferences:U,imageDimensions:j,followUpSuggestedMode:O,uiLayout:q,authNotification:F,toolUsageCardId:G,rolloutId:Q}=u;if(void 0!=A&&c.steps.length<=A&&(c.steps=[...c.steps,...S().map(Array(A-c.steps.length+1),()=>({text:[],tags:[],webSearchResults:[],xpostIds:[],xposts:[],toolUsageResults:[],rolloutId:null!=Q?Q:""}))]),y&&c.responseId!==y&&(c.responseId=y,c.inflightResponseId=y,I(y)),_&&(("aurora"===_.type||"flux"===_.type)&&(c.hasImages=!0,m()),"x"===_.type&&(c.hasSearches=!0)),L&&L.imageAttachmentCount&&(c.imageAttachmentCount=L.imageAttachmentCount),j&&(j.height&&(c.generatedImageHeight=j.height),j.width&&(c.generatedImageWidth=j.width)),null==C?void 0:C.results)if(void 0!=A){let e=c.steps[A];if(e.webSearchResults=C.results||[],G){let t={toolUsageCardId:G,webSearchResults:{results:C.results}};e.toolUsageResults=[...e.toolUsageResults||[],t]}}else 0===c.steps.length&&(c.webSearchResults=[...c.webSearchResults||[],...C.results||[]],h());if(null==R?void 0:R.results)if(void 0!=A){let e=c.steps[A];if(e){if(e.xposts=R.results||[],e.xpostIds=S().compact(e.xposts.map(e=>e.postId)),G){let t={toolUsageCardId:G,xSearchResults:{results:R.results}};e.toolUsageResults=[...e.toolUsageResults||[],t]}}else c.steps.push({text:[],tags:[],webSearchResults:[],xpostIds:S().compact(R.results.map(e=>e.postId)),xposts:R.results||[],toolUsageResults:G?[{toolUsageCardId:G,xSearchResults:{results:R.results}}]:[],rolloutId:null!=Q?Q:""})}else 0===c.steps.length&&(c.xposts=[...c.xposts||[],...R.results||[]],c.xpostIds=S().compact(c.xposts.map(e=>e.postId)),h());if((null==k?void 0:k.results)&&(c.citedWebSearchResults=[...c.citedWebSearchResults||[],...k.results||[]],h()),T&&T.imageUrl&&(c.generatedImageUrls=c.generatedImageUrls.concat([T.imageUrl])),x&&x.jsonData&&(c.cardAttachmentsJson=c.cardAttachmentsJson.concat([x.jsonData])),U&&(null==(t=U.references)?void 0:t.length)&&(c.memoryReferences=U.references),E&&!c.liveThinkingStartTime&&(c.liveThinkingStartTime=new Date(c.createTime).getTime()),"summary"===N?(b&&(b.includes("xai:tool_usage_card")?c.traceSteps.push({type:"tool",text:b,rolloutId:Q}):c.traceSteps.push({type:"summary",text:b,rolloutId:Q})),G&&(C&&(null!=(s=c.toolUsageResultById)[G]||(s[G]={}),c.toolUsageResultById={...c.toolUsageResultById,[G]:{...c.toolUsageResultById[G],webSearchResults:C}},c.webSearchResults=[...c.webSearchResults||[],...C.results||[]]),R&&(null!=(n=c.toolUsageResultById)[G]||(n[G]={}),c.toolUsageResultById={...c.toolUsageResultById,[G]:{...c.toolUsageResultById[G],xSearchResults:R}},c.xposts=[...c.xposts||[],...R.results||[]]))):"header"===N&&b&&c.traceSteps.push({type:"header",text:b,rolloutId:Q}),b)if(N&&"UNSET"!==N.toUpperCase()){if(c.searchingStartTime||(c.searchingStartTime=new Date(c.createTime).getTime()),"FINAL"===N.toUpperCase())c.searchingStartTime&&!c.searchingEndTime&&(c.searchingEndTime=Date.now()),c.message+=b;else if(null!=A){let e=c.steps[A];if(e)if(e.tags.includes(N)){let t=e.tags.indexOf(N);t>=0&&(e.text[t]+=b)}else e.text.push(b),e.tags.push(N)}}else E?c.thinkingTrace+=b:c.message+=b;if(c.liveThinkingStartTime&&!c.liveThinkingEndTime&&!E&&b&&(c.liveThinkingEndTime=Date.now()),M&&M.suggestions&&(c.suggestions=M.suggestions),O&&(c.followUpSuggestedMode=O,g(O)),B&&(B.followUpSuggestions&&(c.suggestions=B.followUpSuggestions),B.disclaimer&&p(B.disclaimer,c.conversationId)),P){let{imageId:e,imageUrl:t}=P;if(e&&t){let s=null!=(r=c.streamingImageById)?r:{};P.progress&&(c.streamingImageById={...s,[e]:{...null!=(a=s[e])?a:{},[P.progress]:P}}),f.setOneImageIdByUrl(e,t)}}if(V&&V.message&&p(V.message,c.conversationId),z&&z.message&&p(z.message,c.conversationId),D){c.progressReport=D,c.progressReportById||(c.progressReportById={});let e=D.message;e&&(c.progressReportById[e]=D)}return q&&(c.uiLayout={...null!=(l=c.uiLayout)?l:{},...q},null==v||v(c.uiLayout)),F&&(c.authNotification={...null!=(d=c.authNotification)?d:{},...F}),w&&(c={...c,...w,state:c.authNotification?"streaming":"closed"}),c},this.processSideBySide=e=>{let{responseChunk:t,toggledExperiment:s,conversationId:o,parentResponseId:n,userResponseId:i,modelName:r,threadParentId:a}=e,{sideBySideIndex:l,responseId:d}=t;if(l&&!s){let e="streaming_in_progress_".concat(l,"_").concat(f()());return N({conversationId:o,responseId:d||e,parentResponseId:i||n,sender:r,threadParentId:a})}},this.processSoftStop=e=>{let{currentStreamResponse:t,responseChunk:s,startTimeMs:o}=e,n=t.responseId;return t.liveThinkingStartTime&&!t.liveThinkingEndTime&&(t.liveThinkingEndTime=Date.now()),t.generationTimeMs=Date.now()-o,t.state="closed",s.responseId&&(t.responseId=s.responseId),t.partial=!1,n&&n.startsWith("streaming_in_progress_")&&n!==t.responseId&&x.getState().removeResponse(n),t},this.streamResponse=e=>{var t,s,d;let u,h,m,{message:I,metadata:S={},parentResponseId:b,parentQuotedText:w,conversationId:R,modelName:_,fileAttachmentIds:T,webpageUrls:x,toolOverrides:P,customInstructions:V,customPersonality:L,deepsearchPreset:D,systemPromptName:U,isReasoning:j,imageEditUri:O,followUpType:q,enableRetries:F,disableArtifactDiff:G,onOptimisticUserResponse:Q,onOptimisticModelResponse:W,onStart:H,onUserResponse:K,onStartExperiment:$,onRealResponseId:J,onCitations:X,onDisclaimer:Y,onHasImage:Z,onClose:ee,onWke:et,onError:es,isFromGrokFiles:eo,resumeResponseId:en,disableToolComposer:ei=!1,disableMemory:er=!1,modelMode:ea,ff:el,threadParentId:ed}=e,ec=C.w.getState(),eu=this.get(),eh=(0,n.f)(),em=new AbortController;ec.idsertAbortControllerById(em,R);let ep=k.x.getState().bestSubscription,eg=[],ev=!I;if(ev||(u=E({conversationId:R,responseId:"optimistic_query_".concat(f()()),parentResponseId:b,message:I,parentQuotedText:w,fileAttachments:T,webpageUrls:x,state:"optimistic",threadParentId:ed}),eu.upsertResponse(u),Q(u)),!ev&&(0,y.isEmpty)(b)){let e=null==(t=eu.byConversationId[R])?void 0:t.length,s=(0,r.Po)(eu.byConversationId[R]);(0,a.iu)("root_pivot",s.toString(),{location:"response-store",conversationId:R,totalResponses:String(e),longestBranchLength:String(s)})}let eI="streaming_in_progress_".concat(f()()),ef="",ey="";if(en&&eu.byId[en]){let e=eu.byId[en];ef=e.message,ey=e.thinkingTrace}let eS=N({conversationId:R,responseId:eI,parentResponseId:ev?b:null==u?void 0:u.responseId,sender:_,state:"optimistic",message:ef,thinkingTrace:ey,threadParentId:ed},D,j);eg.push(eS),eu.upsertResponse(eS),W(eS);let{modelConfigOverrideByModel:eb,isToolComposer2:ew,sideBySideMode:eC,userSettings:ek}=g.C$.getState(),eR=null!=(s=eb[_||"undefined"])?s:{};if((0,g.Qy)(eR)){let e={...eR};e.useToolOverrides||delete e.tools,e.useSideBySideParams||delete e.sideBySideParams,S.modelConfigOverride=e}!ei&&(null!=ew?ew:el.DEFAULT_USE_TOOL_COMPOSER2)&&(S.isMozart=!0);let e_=el.SHOW_MODEL_MODE_SELECTOR&&ek.preferences.useModelModeSelector3?(0,o.vC)(ea):void 0,eT=(d={parentResponseId:b,parentQuotedText:w,message:I,metadata:{...S,requestModelDetails:(0,i.I2)(_,el)},modelName:_,fileAttachments:T,webpageUrls:x,toolOverrides:P,enableSideBySide:"never"!==eC&&!eh,forceSideBySide:"always"===eC,systemPromptName:U,customInstructions:V,customPersonality:L,deepsearchPreset:D,disableArtifactDiff:G,isReasoning:j,imageEditUri:O,followUpType:q,isFromGrokFiles:eo,resumeResponseId:en,disableMemory:er,threadParentId:ed,modelMode:e_},{message:"",modelName:"",parentResponseId:"",parentQuotedText:void 0,systemPromptName:void 0,disableSearch:!1,imageAttachments:[],returnImageBytes:!1,returnRawGrokInXaiRequest:!1,fileAttachments:[],enableImageGeneration:!0,forceConcise:!1,enableImageStreaming:!0,enableSideBySide:!0,sendFinalMetadata:!0,imageGenerationCount:B,deepsearchPreset:"",isReasoning:!1,disableTextFollowUps:!0,followUpType:"",disableMemory:!1,...d}),eM=!1,ex=!1,eP=!1,eB=Date.now(),[eE,eN]=A(),{log:eA,stop:eV,resetTime:ez}=(0,a.Pp)("streamResponse",{type:"milliseconds_per_token",subscriptionTier:ep||"unknown",modelId:_,modelMode:ea||"none",millisecondsPerTokenList:[]}),eL=(0,a.wk)(()=>{var e;let t=null==(e=eg[0])?void 0:e.inflightResponseId;return!(!t||t.startsWith("streaming_in_progress_"))&&(h=Date.now(),(0,a.iu)("response_start_streaming",t,{location:"response-store:streamResponse",conversationId:R,responseId:t,modelId:_,modelMode:ea||"none"}),!0)}),eD=(0,a.wk)(()=>{var e;let t=null==(e=eg[0])?void 0:e.inflightResponseId;return!(!t||t.startsWith("streaming_in_progress_"))&&!!h&&(m=Date.now(),(0,a.iu)("response_start_streaming_summary",t,{location:"response-store:streamResponse",conversationId:R,responseId:t,modelId:_,modelMode:ea||"none",deltaMs:(m-h).toString()}),!0)}),eU=(0,a.wl)("streamResponse",{type:"time_to_first_token",modelId:_,subscriptionTier:ep||"unknown",modelMode:ea||"none",timeToFirstTokenMs:0},e=>{eg.forEach(t=>{t.liveTimeToFirstTokenMs=e})}),ej=(0,a.hl)("streamResponse",{type:"time_to_first_chunk",modelId:_,subscriptionTier:ep||"unknown",modelMode:ea||"none",timeToFirstChunkMs:0},e=>{eg.forEach(t=>{t.liveTimeToFirstChunkMs=e})}),eO=(0,a.NZ)("streamResponse",{type:"time_to_first_summary_token",modelId:_,subscriptionTier:ep||"unknown",modelMode:ea||"none",timeToFirstSummaryTokenMs:0},e=>{eg.forEach(t=>{t.liveTimeToFirstSummaryTokenMs=e})});return c.chatApi.chatAddResponseRaw({conversationId:R,body:eT}).then(async e=>{for await(let d of(u&&(u.state="streaming",eN(u)),(eg=eg.map(e=>({...e,state:"streaming"}))).forEach(eN),H(eg),(0,a.N8)("streamResponse",{type:"send_query_stream_start",subscriptionTier:ep||"unknown",modelId:_,modelMode:ea||"none"}),ez(),p(e.raw))){var t,s,o,n,i,r,l;if(ej(),eA(),d.error){let e=Error(d.error.message);throw et(e),e}if(!d.result)continue;let e=d.result,{userResponse:c,sideBySideIndex:h,isSoftStop:m,modelResponse:p,authNotification:g}=e;if(null==c?void 0:c.error)throw u&&(u.state="error",u.error=c.error,eN(u)),(0,a.vV)("response-store:streamResponse:userResponseChunk",c.error),Error(c.error);if(null==p?void 0:p.error)throw(eg=eg.map(e=>({...e,state:"error",error:p.error}))).forEach(eN),(0,a.vV)("response-store:streamResponse:modelResponseChunk",p.error),Error(p.error);let v=this.processSideBySide({responseChunk:e,toggledExperiment:eM,conversationId:R,parentResponseId:b,userResponseId:null==u?void 0:u.responseId,modelName:_,threadParentId:ed});if(v&&(eg[0]&&(null!=(s=eg[0]).experimentIds||(s.experimentIds=[]),eg[0].experimentIds.push(v.responseId)),eM=!0,v.uiLayout=null==(t=eg[0])?void 0:t.uiLayout,eg.push(v),eN(v),$(eg.map(e=>e.responseId))),c){null==u||u.responseId,eE(u={...c,conversationId:R,state:"closed",parentQuotedText:w,threadParentId:ed,createTime:(null==u?void 0:u.createTime)||c.createTime}),K(u),ex=!0,(eg=eg.map(e=>({...e,parentResponseId:null==u?void 0:u.responseId}))).forEach(eN);continue}let I=null!=h?h:0,f=eg[I];if(!f)return;f=this.processResponseChunk({currentStreamResponse:f,responseChunk:e,onCitations:()=>X(f),onHasImage:Z,onDisclaimer:Y,onFollowUpSuggestedMode:e=>{var t;(0,a.iu)("follow_up_suggested_mode_button_shown",e.mode,{location:"response-store:streamResponse",responseId:f.responseId,followUpSuggestedMode:null!=(t=e.mode)?t:"UNKNOWN"})},onUiLayout:e=>{eg=eg.map(t=>{var s;return{...t,uiLayout:{...null!=(s=t.uiLayout)?s:{},...e}}})},onRealResponseId:J}),(e.token||e.messageTag)&&(eU(),eL(),e.isThinking||(eO(),eD())),eE(f),eg[I]=f,m&&(f=this.processSoftStop({currentStreamResponse:f,responseChunk:e,startTimeMs:eB}),(0,a.iu)("generation_time_ms",null==(n=f.generationTimeMs)?void 0:n.toString(),{location:"response-store",conversationId:R,responseId:f.responseId}),eN(f),eg.every(e=>"closed"===e.state)&&((0,a.iu)("finished_query",null==(i=eg[0])?void 0:i.responseId,{location:"response-store",conversationId:R,toggledExperiment:eM.toString(),secondResponse:(null==(r=eg[1])?void 0:r.responseId)||"",isReasoning:j?j.toString():"",deepsearchPreset:D||""}),eg.forEach(eN),ee(eg,eg.map(e=>e.responseId)),eP=!0)),g&&((0,a.iu)("auth_notification_received",null==(l=eg[0])?void 0:l.responseId,{location:"response-store",conversationId:R}),eP=!0)}if(ex||ev||(this.ensureUserResponseSaved({conversationId:R,message:I,userResponse:u,onUserResponse:K,forceUpsertResponse:eN}).then(z(eg)).then(e=>eg=e).catch((0,a.HX)("response-store:useResponseStore:streamResponse")),ex=!0),!eP){let e=Error(v.CZ);(0,a.vV)("response-store:useResponseStore:streamResponse:closedStream",e,{conversationId:R,modelName:_,modelMode:ea||"none"})}(0,a.N8)("streamResponse",{type:"send_query_stream_success",subscriptionTier:ep||"unknown",modelId:_,modelMode:ea||"none"})}).catch(e=>{(0,l.GQ)(e)&&((0,a.vV)("response-store:useResponseStore:streamResponse",e,{conversationId:R,modelName:_,isReasoning:j?j.toString():"",deepsearchPreset:D||""}),(0,a.N8)("streamResponse",{type:"send_query_stream_error",subscriptionTier:ep||"unknown",modelId:_,modelMode:ea||"none"}));let t=es(e);if(F&&t)M(_,R,eg,j,D,ea,H,X,Y,Z,ee,et).catch(e=>{throw(0,a.vV)("response-store:useResponseStore:streamResponse:handleStreamError",e),e});else throw(eg=eg.map(e=>({...e,state:"error",compoutedThinkingEndTime:e.liveThinkingStartTime&&!e.liveThinkingEndTime?Date.now():e.liveThinkingEndTime,searchingEndTime:e.searchingStartTime&&!e.searchingEndTime?Date.now():e.searchingEndTime}))).forEach(eN),e}).finally(()=>{eV()})},this.reconnectToResponse=e=>{let{inflightResponse:t,conversationId:s,modelName:o,parentResponseId:n,enableRetries:i,isReasoning:r,deepsearchPreset:l,modelMode:d,onStart:u,onCitations:h,onDisclaimer:m,onHasImage:g,onClose:I,onWke:y,onError:S}=e,b=this.get(),w=C.w.getState(),R=new AbortController,_=k.x.getState().bestSubscription,T=!1;if(!t.responseId)throw Error("Inflight response missing responseId");let x=[],{log:P,stop:B,resetTime:E}=(0,a.Pp)("reconnectToResponse",{type:"milliseconds_per_token",subscriptionTier:_||"unknown",modelId:o,modelMode:d||"none",millisecondsPerTokenList:[]});return c.chatApi.chatReconnectResponseV2Raw({responseId:t.responseId}).then(async e=>{var c,f,S,C,k,M,B,V,z,D,U,j,O,q,F,G,Q,W,H,K,$,J,X;(0,a.N8)("reconnectToResponse",{type:"send_query_stream_reconnect_start",subscriptionTier:_||"unknown",modelId:o,modelMode:d||"none"}),E();let Y=p(e.raw);P();let Z=await Y.next();if(!(null==(c=Z.value)?void 0:c.result)||!(null==(C=Z.value)||null==(S=C.result)||null==(f=S.response)?void 0:f.modelResponse))throw Error("No initial state received from reconnect");let{title:ee,response:et}=Z.value.result;if(ee){let e=w.byId[s];w.upsertAndCacheConversation({...e,title:ee.newTitle})}let es=N({...et.modelResponse,responseId:t.responseId,inflightResponseId:t.responseId,conversationId:s,parentResponseId:n,sender:o,state:"streaming",...t.createTime&&{createTime:t.createTime}});if(((null==(k=et.queryAction)?void 0:k.type)==="aurora"||(null==(M=et.queryAction)?void 0:M.type)==="flux")&&(es.hasImages=!0,g()),(null==(B=et.queryAction)?void 0:B.type)==="x"&&(es.hasSearches=!0),(null==(V=et.followUpSuggestions)?void 0:V.suggestions)&&(es.suggestions=et.followUpSuggestions.suggestions),et.followUpSuggestedMode&&(es.followUpSuggestedMode=et.followUpSuggestedMode),et.finalMetadata&&(et.finalMetadata.followUpSuggestions&&(es.suggestions=et.finalMetadata.followUpSuggestions),et.finalMetadata.disclaimer&&m(et.finalMetadata.disclaimer,es.conversationId)),et.cachedImageGenerationResponse&&et.cachedImageGenerationResponse.imageUrl&&(es.generatedImageUrls=es.generatedImageUrls.concat([et.cachedImageGenerationResponse.imageUrl])),et.cardAttachment&&et.cardAttachment.jsonData&&(es.cardAttachmentsJson=es.cardAttachmentsJson.concat([et.cardAttachment.jsonData])),null==(D=et.modelResponse)||null==(z=D.steps)?void 0:z.length){let{toolUsageResultById:e,traceSteps:t}=L(null==(G=et.modelResponse)?void 0:G.steps);es.toolUsageResultById=e,es.traceSteps=t,es.searchingStartTime=new Date(es.createTime).getTime(),(null==(Q=et.modelResponse)?void 0:Q.message)&&(es.searchingEndTime=Date.now())}if((null==(U=et.modelResponse)?void 0:U.thinkingTrace)&&(es.liveThinkingStartTime=new Date(es.createTime).getTime(),et.isThinking||es.liveThinkingEndTime||(es.liveThinkingEndTime=Date.now())),et.bannerMessage&&et.bannerMessage.message&&m(et.bannerMessage.message,es.conversationId),et.disclaimer&&et.disclaimer.message&&m(et.disclaimer.message,es.conversationId),(null==(j=et.modelResponse)?void 0:j.uiLayout)&&(es.uiLayout=null==(W=et.modelResponse)?void 0:W.uiLayout),x=[es],w.idsertAbortControllerById(R,s),b.upsertResponse(es),u(x),et.streamingImageGenerationResponse){let{imageId:e,imageUrl:t}=et.streamingImageGenerationResponse;if(e&&t){let s=null!=(H=es.streamingImageById)?H:{};et.streamingImageGenerationResponse.progress&&(es.streamingImageById={...s,[e]:{...null!=(K=s[e])?K:{},[et.streamingImageGenerationResponse.progress]:et.streamingImageGenerationResponse}}),b.setOneImageIdByUrl(e,t)}}((null==(O=es.webSearchResults)?void 0:O.length)||(null==(q=es.citedWebSearchResults)?void 0:q.length)||(null==(F=es.xposts)?void 0:F.length))&&h(es);let[eo,en]=A(),ei=new Date(es.createTime).getTime();try{for await(let e of Y){if(P(),e.error){let t=Error(e.error.message);throw y(t),t}if(!e.result)continue;let{title:t,response:o}=e.result;if(null==t?void 0:t.newTitle){let e=w.byId[s];w.upsertAndCacheConversation({...e,title:t.newTitle})}if(o){if(null==($=o.modelResponse)?void 0:$.error)throw(0,a.vV)("response-store:reconnectToResponse:modelResponse",o.modelResponse.error),Error(o.modelResponse.error);es={...this.processResponseChunk({currentStreamResponse:es,responseChunk:o,onCitations:()=>h(es),onHasImage:g,onDisclaimer:m,onFollowUpSuggestedMode:e=>{var t;(0,a.iu)("follow_up_suggested_mode_button_shown",e.mode,{location:"response-store",responseId:es.responseId,followUpSuggestedMode:null!=(t=e.mode)?t:"UNKNOWN"})},onUiLayout:e=>{es.uiLayout=e},onRealResponseId:e=>{es.responseId=e}}),parentResponseId:n},eo(es),x[0]=es,o.isSoftStop&&(es=this.processSoftStop({currentStreamResponse:es,responseChunk:o,startTimeMs:ei}),(0,a.iu)("generation_time_ms",null==(J=es.generationTimeMs)?void 0:J.toString(),{location:"response-store",conversationId:s,responseId:es.responseId}),en(es),x.every(e=>"closed"===e.state)&&((0,a.iu)("finished_query",null==(X=x[0])?void 0:X.responseId,{location:"response-store",conversationId:s,isReasoning:r?r.toString():"",deepsearchPreset:l||""}),x.forEach(en),I(x,x.map(e=>e.responseId)),T=!0)),o.authNotification&&(T=!0)}}if(!T){let e=Error(v.CZ);(0,a.vV)("response-store:useResponseStore:reconnectToResponse:closedStream",e)}(0,a.N8)("reconnectToResponse",{type:"send_query_stream_reconnect_success",subscriptionTier:_||"unknown",modelId:o,modelMode:d||"none"})}catch(e){throw i||(es={...es,state:"error",liveThinkingEndTime:es.liveThinkingStartTime&&!es.liveThinkingEndTime?Date.now():es.liveThinkingEndTime,searchingEndTime:es.searchingStartTime&&!es.searchingEndTime?Date.now():es.searchingEndTime},x[0]=es,en(es)),e}}).catch(e=>{(0,a.vV)("response-store:reconnectToResponse",e),(0,a.N8)("reconnectToResponse",{type:"send_query_stream_reconnect_error",subscriptionTier:_||"unknown",modelId:o,modelMode:d||"none"});let t=S(e);if(i&&t)M(o,s,x,r,l,d,u,h,m,g,I,y).catch(e=>{throw(0,a.vV)("response-store:reconnectToResponse:handleStreamError",e),e});else{if(0===x.length){let e=N({conversationId:s,responseId:"streaming_in_progress_".concat(f()()),parentResponseId:n,sender:o,state:"error"});x=[e],b.upsertResponse(e)}throw e}}).finally(()=>{w.removeAbortControllerById(s),B()})},this.streamCreateAndRespond=async e=>{var t,s;let r,d,{temporary:u,message:h,modelName:m,fileAttachmentIds:I,webpageUrls:y,systemPromptName:S,personaId:b,toolOverrides:w,isPreset:R,customInstructions:_,customPersonality:T,deepsearchPreset:x,isReasoning:P,imageEditUri:V,enableRetries:L,disableArtifactDiff:D,onOptimisticConversation:U,onOptimisticResponse:j,onStart:O,onConversation:q,onUserResponse:F,onStartExperiment:G,onRealResponseId:Q,onCitations:W,onDisclaimer:H,onHasImage:K,onClose:$,onWke:J,onError:X,workspaceIds:Y,responseMetadata:Z={},isFromGrokFiles:ee,disableToolComposer:et=!1,disableMemory:es=!1,modelMode:eo,ff:en}=e,ei=this.get(),er=C.w.getState(),ea=(0,n.f)(),el=k.x.getState().bestSubscription,ed="optimistic_conversation_".concat(f()()),ec=(0,C.b)({conversationId:ed,personaId:b,temporary:u});er.upsertAndCacheConversation(ec),U(ec);let eu="optimistic_response_".concat(f()()),eh=E({conversationId:ec.conversationId,responseId:eu,message:h,fileAttachments:I,webpageUrls:y});ei.upsertResponse(eh),j(eh);let em="streaming_in_progress_".concat(f()()),ep=N({conversationId:ec.conversationId,responseId:em,parentResponseId:eh.responseId,sender:m},x,P),eg=[ep];ei.upsertResponse(ep);let{modelConfigOverrideByModel:ev,isToolComposer2:eI,sideBySideMode:ef,userSettings:ey}=g.C$.getState(),eS=null!=(t=ev[m||"undefined"])?t:{};if((0,g.Qy)(eS)){let e={...eS};e.useToolOverrides||delete e.tools,e.useSideBySideParams||delete e.sideBySideParams,Z.modelConfigOverride=e}!et&&(null!=eI?eI:en.DEFAULT_USE_TOOL_COMPOSER2)&&(Z.isMozart=!0);let eb=en.SHOW_MODEL_MODE_SELECTOR&&ey.preferences.useModelModeSelector3?(0,o.vC)(eo):void 0,ew=(s={temporary:u,message:h,modelName:m,fileAttachments:I,webpageUrls:y,systemPromptName:null!=S?S:b,toolOverrides:w,enableSideBySide:"never"!==ef&&!ea,forceSideBySide:"always"===ef,customInstructions:_,customPersonality:T,deepsearchPreset:x,isReasoning:P,disableArtifactDiff:D,imageEditUri:V,workspaceIds:Y,isFromGrokFiles:ee,responseMetadata:{...Z,requestModelDetails:(0,i.I2)(m,en)},disableMemory:es,modelMode:eb},{systemPromptName:"",temporary:!1,message:"",modelName:"",fileAttachments:[],imageAttachments:[],disableSearch:!1,enableImageGeneration:!0,returnImageBytes:!1,returnRawGrokInXaiRequest:!1,enableImageStreaming:!0,imageGenerationCount:B,forceConcise:!1,enableSideBySide:!0,sendFinalMetadata:!0,disableTextFollowUps:!0,...s}),eC=new AbortController;er.idsertAbortControllerById(eC,ed);let ek=!1,eR=!1,e_=!1,eT=Date.now(),[eM,ex]=A(),{log:eP,stop:eB,resetTime:eE}=(0,a.Pp)("streamCreateAndRespond",{type:"milliseconds_per_token",subscriptionTier:el||"unknown",modelId:m,modelMode:eo||"none",millisecondsPerTokenList:[]}),eN=(0,a.wk)(()=>{var e;let t=null==(e=eg[0])?void 0:e.inflightResponseId;return!(!t||t.startsWith("streaming_in_progress_"))&&(r=Date.now(),(0,a.iu)("response_start_streaming",t,{location:"response-store:streamResponse",conversationId:ec.conversationId,responseId:t,modelId:m,modelMode:eo||"none"}),!0)}),eA=(0,a.wk)(()=>{var e;let t=null==(e=eg[0])?void 0:e.inflightResponseId;return!(!t||t.startsWith("streaming_in_progress_"))&&!!r&&(d=Date.now(),(0,a.iu)("response_start_streaming_summary",t,{location:"response-store:streamCreateAndRespond",conversationId:ec.conversationId,responseId:t,modelId:m,modelMode:eo||"none",deltaMs:(d-r).toString()}),!0)}),eV=(0,a.wl)("streamCreateAndRespond",{type:"time_to_first_token",modelId:m,subscriptionTier:el||"unknown",modelMode:eo||"none",timeToFirstTokenMs:0},e=>{eg.forEach(t=>{t.liveTimeToFirstTokenMs=e})}),ez=(0,a.hl)("streamCreateAndRespond",{type:"time_to_first_chunk",modelId:m,subscriptionTier:el||"unknown",modelMode:eo||"none",timeToFirstChunkMs:0},e=>{eg.forEach(t=>{t.liveTimeToFirstChunkMs=e})}),eL=(0,a.NZ)("streamCreateAndRespond",{type:"time_to_first_summary_token",modelId:m,subscriptionTier:el||"unknown",modelMode:eo||"none",timeToFirstSummaryTokenMs:0},e=>{eg.forEach(t=>{t.liveTimeToFirstSummaryTokenMs=e})});return c.chatApi.chatCreateConversationAndRespondRaw({body:ew}).then(async e=>{for await(let d of(eh={...eh,state:"streaming"},eg=eg.map(e=>({...e,state:"streaming"})),ex(eh),eg.forEach(ex),O(eg),(0,a.N8)("streamCreateAndRespond",{type:"send_query_stream_start",subscriptionTier:el||"unknown",modelId:m,modelMode:eo||"none"}),eE(),p(e.raw))){if(ez(),eP(),d.error){let e=Error(d.error.message);throw J(e),e}if(!d.result)continue;let{response:e,conversation:c,title:u}=d.result;if(c){let e=ec.conversationId;ec={...ec,isNew:!0,fromPreset:R,state:"closed",systemPromptName:"",...c},er.upsertAndCacheConversation(ec,e),er.idsertAbortControllerById(eC,ec.conversationId),eh={...eh,conversationId:ec.conversationId},eg=eg.map(e=>({...e,parentResponseId:eh.responseId,conversationId:ec.conversationId})),eM(eh),eg.forEach(ex),q(ec);continue}if((null==u?void 0:u.newTitle)&&(ec={...ec,title:u.newTitle},er.upsertAndCacheConversation(ec)),e){var t,s,o,n,i,r,l;let{userResponse:d,sideBySideIndex:c,isSoftStop:u,modelResponse:h,authNotification:p}=e;if(null==d?void 0:d.error)throw ex(eh={...eh,...d,state:"error"}),(0,a.vV)("response-store:useResponseStore:streamResponse:userResponseChunk",d.error),Error(d.error);if(null==h?void 0:h.error)throw(eg=eg.map(e=>({...e,...h,state:"error"}))).forEach(ex),(0,a.vV)("response-store:useResponseStore:streamResponse:modelResponseChunk",h.error),Error(h.error);let g=this.processSideBySide({responseChunk:e,toggledExperiment:ek,conversationId:ec.conversationId,parentResponseId:eh.responseId,modelName:m,threadParentId:void 0});if(g&&(eg[0]&&(null!=(s=eg[0]).experimentIds||(s.experimentIds=[]),eg[0].experimentIds.push(g.responseId)),ek=!0,g.uiLayout=null==(t=eg[0])?void 0:t.uiLayout,eg.push(g),ex(g),G(eg.map(e=>e.responseId))),d){eM(eh={...eh,...d,conversationId:ec.conversationId,state:"closed",threadParentId:null!=(n=null==eh?void 0:eh.threadParentId)?n:""}),F(eh),eR=!0,(eg=eg.map(e=>({...e,parentResponseId:null==eh?void 0:eh.responseId}))).forEach(ex);continue}let v=null!=c?c:0,I=eg[v];if(!I)continue;I=this.processResponseChunk({currentStreamResponse:I,responseChunk:e,onCitations:()=>W(I),onHasImage:K,onDisclaimer:H,onFollowUpSuggestedMode:e=>{var t;(0,a.iu)("follow_up_suggested_mode_button_shown",e.mode,{location:"response-store:streamCreateAndRespond",responseId:I.responseId,followUpSuggestedMode:null!=(t=e.mode)?t:"UNKNOWN"})},onUiLayout:e=>{eg=eg.map(t=>{var s;return{...t,uiLayout:{...null!=(s=t.uiLayout)?s:{},...e}}})},onRealResponseId:Q}),(e.token||e.messageTag)&&(eV(),eN(),e.isThinking||(eL(),eA())),eM(I),eg[v]=I,u&&(I=this.processSoftStop({currentStreamResponse:I,responseChunk:e,startTimeMs:eT}),(0,a.iu)("generation_time_ms",null==(i=I.generationTimeMs)?void 0:i.toString(),{location:"response-store",conversationId:ec.conversationId,responseId:I.responseId}),ex(I),eg.every(e=>"closed"===e.state)&&((0,a.iu)("finished_query",null==(r=eg[0])?void 0:r.responseId,{location:"response-store",conversationId:ec.conversationId,toggledExperiment:ek.toString(),secondResponse:(null==(l=eg[1])?void 0:l.responseId)||"",isReasoning:P?P.toString():"",deepsearchPreset:x||""}),eg.forEach(ex),$(eg),e_=!0)),p&&(e_=!0)}}if(eR||(this.ensureUserResponseSaved({conversationId:ec.conversationId,message:h,userResponse:eh,onUserResponse:F,forceUpsertResponse:ex}).then(z(eg)).then(e=>eg=e).catch((0,a.HX)("response-store:useResponseStore:streamCreateAndRespond")),eR=!0),!e_){let e=Error(v.CZ);(0,a.vV)("response-store:useResponseStore:streamCreateAndRespond:closedStream",e,{conversationId:ec.conversationId,modelName:m,modelMode:eo||"none"})}(0,a.N8)("streamCreateAndRespond",{type:"send_query_stream_success",subscriptionTier:el||"unknown",modelId:m,modelMode:eo||"none"})}).catch(e=>{(0,l.GQ)(e)&&((0,a.vV)("response-store:useResponseStore:streamCreateAndRespond",e,{conversationId:ec.conversationId,modelName:m,isReasoning:P?P.toString():"",deepsearchPreset:x||""}),(0,a.N8)("streamCreateAndRespond",{type:"send_query_stream_error",subscriptionTier:el||"unknown",modelId:m,modelMode:eo||"none"}));let t=X(e);if(L&&t)M(m,ec.conversationId,eg,P,x,eo,O,W,H,K,$,J).catch(e=>{throw(0,a.vV)("response-store:useResponseStore:streamCreateAndRespond:handleStreamError",e),e});else throw(eg=eg.map(e=>({...e,state:"error",liveThinkingEndTime:e.liveThinkingStartTime&&!e.liveThinkingEndTime?Date.now():e.liveThinkingEndTime,searchingEndTime:e.searchingStartTime&&!e.searchingEndTime?Date.now():e.searchingEndTime}))).forEach(ex),$(eg),e}).finally(()=>{eB()})},this.ensureUserResponseSaved=e=>{let{conversationId:t,message:s,userResponse:o,onUserResponse:n,forceUpsertResponse:i}=e;return this.get().addUserResponse(t,s).then(e=>(i(e),n(e),e)).catch(()=>{if(!o)return;let e={...o,state:"error"};return i(e),e})},this.abortStream=async(e,t)=>{let s=this.get(),o=C.w.getState(),n=s.byId[t];if(!n.state||!["streaming","error","reconnecting"].includes(n.state))return Promise.resolve(t);let i=o.abortControllerById[e];return i&&(i.abort(),o.removeAbortControllerById(e)),c.chatApi.chatStopConversationInflightResponses({conversationId:e}).then(()=>{let t={...n,responseId:n.inflightResponseId,conversationId:e,state:"closed",partial:!0,liveThinkingEndTime:n.liveThinkingStartTime&&!n.liveThinkingEndTime?Date.now():n.liveThinkingEndTime,searchingEndTime:n.searchingStartTime&&!n.searchingEndTime?Date.now():n.searchingEndTime};return s.upsertResponse(t),t.responseId}).catch(e=>{let t={...n,state:"error",liveThinkingEndTime:n.liveThinkingStartTime&&!n.liveThinkingEndTime?Date.now():n.liveThinkingEndTime,searchingEndTime:n.searchingStartTime&&!n.searchingEndTime?Date.now():n.searchingEndTime};throw s.upsertResponse(t),e})},this.addUserResponse=(e,t,s)=>c.chatApi.chatAddUserResponse({conversationId:e,body:{message:t,parentResponseId:s}}).then(t=>{let s=this.get(),o={...t,conversationId:e};return s.upsertResponse(o),o}),this.addToolResponse=(e,t)=>c.chatApi.chatAddToolResponse({body:{responseId:e,toolResponse:t}}).then(()=>{let s=this.get(),o=s.byId[e];if(o){let e={...o,toolResponses:[...o.toolResponses||[],t]};return s.upsertResponse(e),e}throw Error("Response not found in state")}),this.createVoiceUserMessage=e=>{let{userResponseId:t,conversationId:s,parentResponseId:o,message:n,onUserResponse:i,onOptimisticModelResponse:r}=e,a=this.get(),l=E({responseId:t,parentResponseId:o,message:n,conversationId:s,state:"closed",partial:!1});a.upsertResponse(l),i(l);let d=N({conversationId:s,responseId:"streaming_in_progress_".concat(f()()),parentResponseId:l.responseId,sender:"ASSISTANT",state:"streaming"});a.upsertResponse(d),r(d)},this.loadThreadMessages=async(e,t)=>{let s=this.get();try{let o=(await this.fetchListResponseNodes(e)).filter(e=>e.threadParentId===t);if(!o.length)return[];let n=o.filter(e=>!!e.responseId).map(e=>e.responseId);return(await s.loadResponses(e,n)).sort((e,t)=>new Date(e.createTime).getTime()-new Date(t.createTime).getTime())}catch(e){return(0,a.vV)("response-store:loadThreadMessages",e),[]}}}}async function M(e,t,s,o,n,i,r,d,u,h,m,g){let v=x.getState(),I=C.w.getState(),f=k.x.getState().bestSubscription,y=s.map(e=>({...e,state:"reconnecting"}));y.forEach(v.upsertResponse);let S=e=>new Promise(t=>setTimeout(t,e));if(t.startsWith("optimistic_conversation_"))return void(y=y.map(e=>({...e,state:"error"}))).forEach(v.upsertResponse);let{log:b,stop:w,resetTime:R}=(0,a.Pp)("handleStreamError",{type:"milliseconds_per_token",subscriptionTier:f||"unknown",modelId:e,modelMode:i||"none",millisecondsPerTokenList:[]});(0,a.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_start",subscriptionTier:f||"unknown",modelId:e,modelMode:i||"none"});for(let s=1;s<=10;s++){try{let s=await v.fetchListInflightResponses(t,!0);if(s.length>0&&s[0].responseId&&y[0].parentResponseId){await c.chatApi.chatReconnectResponseV2Raw({responseId:s[0].responseId}).then(async l=>{var c,S,w,C,k,_,T,M,x,P,B,E,V,z,L,D,U,j,O,q;(0,a.N8)("handleStreamError",{type:"send_query_stream_reconnect_start",subscriptionTier:f||"unknown",modelId:e,modelMode:i||"none"}),R();let F=p(l.raw);b();let G=await F.next();if(!(null==(c=G.value)?void 0:c.result)||!(null==(C=G.value)||null==(w=C.result)||null==(S=w.response)?void 0:S.modelResponse))throw Error("No initial state received from reconnect");let{title:Q,response:W}=G.value.result;if(Q){let e=I.byId[t];I.upsertAndCacheConversation({...e,title:Q.newTitle})}let H=N({...W.modelResponse,conversationId:t,responseId:y[0].responseId,parentResponseId:y[0].parentResponseId,sender:y[0].sender,state:"streaming",...s[0].createTime&&{createTime:s[0].createTime},modelMode:i||"none"});if(((null==(k=W.queryAction)?void 0:k.type)==="aurora"||(null==(_=W.queryAction)?void 0:_.type)==="flux")&&(H.hasImages=!0,h()),(null==(T=W.queryAction)?void 0:T.type)==="x"&&(H.hasSearches=!0),(null==(M=W.followUpSuggestions)?void 0:M.suggestions)&&(H.suggestions=W.followUpSuggestions.suggestions),W.followUpSuggestedMode&&(H.followUpSuggestedMode=W.followUpSuggestedMode),W.finalMetadata&&(W.finalMetadata.followUpSuggestions&&(H.suggestions=W.finalMetadata.followUpSuggestions),W.finalMetadata.disclaimer&&u(W.finalMetadata.disclaimer,H.conversationId)),W.cachedImageGenerationResponse&&W.cachedImageGenerationResponse.imageUrl&&(H.generatedImageUrls=H.generatedImageUrls.concat([W.cachedImageGenerationResponse.imageUrl])),W.cardAttachment&&W.cardAttachment.jsonData&&(H.cardAttachmentsJson=H.cardAttachmentsJson.concat([W.cardAttachment.jsonData])),(null==(P=W.modelResponse)||null==(x=P.steps)?void 0:x.length)&&(H.searchingStartTime=new Date(H.createTime).getTime(),(null==(L=W.modelResponse)?void 0:L.message)&&(H.searchingEndTime=Date.now())),W.bannerMessage&&W.bannerMessage.message&&u(W.bannerMessage.message,H.conversationId),W.disclaimer&&W.disclaimer.message&&u(W.disclaimer.message,H.conversationId),(null==(B=W.modelResponse)?void 0:B.thinkingTrace)&&(H.liveThinkingStartTime=new Date(H.createTime).getTime(),W.isThinking||H.liveThinkingEndTime||(H.liveThinkingEndTime=Date.now())),y=[H],v.upsertResponse(H),r(y),W.streamingImageGenerationResponse){let{imageId:e,imageUrl:t}=W.streamingImageGenerationResponse;if(e&&t){let s=null!=(D=H.streamingImageById)?D:{};W.streamingImageGenerationResponse.progress&&(H.streamingImageById={...s,[e]:{...null!=(U=s[e])?U:{},[W.streamingImageGenerationResponse.progress]:W.streamingImageGenerationResponse}}),v.setOneImageIdByUrl(e,t)}}((null==(E=H.webSearchResults)?void 0:E.length)||(null==(V=H.citedWebSearchResults)?void 0:V.length)||(null==(z=H.xposts)?void 0:z.length))&&d(H);let[K,$]=A(),J=new Date(H.createTime).getTime();for await(let e of F){if(b(),e.error){let t=Error(e.error.message);throw g(t),t}if(!e.result)continue;let{title:s,response:i}=e.result;if(null==s?void 0:s.newTitle){let e=I.byId[t];I.upsertAndCacheConversation({...e,title:s.newTitle})}if(i){if(null==(j=i.modelResponse)?void 0:j.error)throw(0,a.vV)("response-store:handleStreamError:modelResponse",i.modelResponse.error),Error(i.modelResponse.error);H={...v.processResponseChunk({currentStreamResponse:H,responseChunk:i,onCitations:()=>d(H),onHasImage:h,onDisclaimer:u,onFollowUpSuggestedMode:e=>{var t;(0,a.iu)("follow_up_suggested_mode_button_shown",e.mode,{location:"response-store",responseId:H.responseId,followUpSuggestedMode:null!=(t=e.mode)?t:"UNKNOWN"})},onUiLayout:e=>{y=y.map(t=>{var s;return{...t,uiLayout:{...null!=(s=t.uiLayout)?s:{},...e}}})},onRealResponseId:()=>{}}),parentResponseId:y[0].parentResponseId},K(H),y[0]=H,i.isSoftStop&&(H=v.processSoftStop({currentStreamResponse:H,responseChunk:i,startTimeMs:J}),(0,a.iu)("generation_time_ms",null==(O=H.generationTimeMs)?void 0:O.toString(),{location:"response-store",conversationId:t,responseId:H.responseId}),$(H),y.every(e=>"closed"===e.state)&&((0,a.iu)("finished_query",null==(q=y[0])?void 0:q.responseId,{location:"response-store",conversationId:t,isReasoning:o?o.toString():"",deepsearchPreset:n||""}),y.forEach($),m(y,y.map(e=>e.responseId))))}}("streaming"===H.state||"reconnecting"===H.state)&&(H={...H,state:"closed",liveThinkingEndTime:H.liveThinkingStartTime&&!H.liveThinkingEndTime?Date.now():H.liveThinkingEndTime,searchingEndTime:H.searchingStartTime&&!H.searchingEndTime?Date.now():H.searchingEndTime},y[0]=H,$(H)),m(y,y.map(e=>e.responseId)),(0,a.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_success",subscriptionTier:f||"unknown",modelId:e,modelMode:i||"none"}),(0,a.N8)("handleStreamError",{type:"send_query_stream_reconnect_success",subscriptionTier:f||"unknown",modelId:e,modelMode:i||"none"})});break}(y=y.map(e=>({...e,state:"error",liveThinkingEndTime:e.liveThinkingStartTime&&!e.liveThinkingEndTime?Date.now():e.liveThinkingEndTime,searchingEndTime:e.searchingStartTime&&!e.searchingEndTime?Date.now():e.searchingEndTime}))).forEach(v.upsertResponse),(0,a.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_fail",subscriptionTier:f||"unknown",modelId:e,modelMode:i||"none"});break}catch(t){if(w(),(0,a.vV)("response-store:handleStreamError:retryError",t),(0,l.GQ)(t)&&((0,a.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_error",subscriptionTier:f||"unknown",modelId:e,modelMode:i||"none"}),(0,a.N8)("handleStreamError",{type:"send_query_stream_reconnect_error",subscriptionTier:f||"unknown",modelId:e,modelMode:i||"none"})),10===s)throw(0,a.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_fail",subscriptionTier:f||"unknown",modelId:e,modelMode:i||"none"}),(y=y.map(e=>({...e,state:"error"}))).forEach(v.upsertResponse),t;await S(2e3),(y=y.map(e=>({...e,state:"reconnecting"}))).forEach(v.upsertResponse)}w()}}let x=(0,d.y$)(T,"useResponseStore");function P(e,t){return x(s=>{var o;return e?null==(o=s.byId[e])?void 0:o[t]:void 0})}(0,d.lB)(x,"byId","byConversationId",(e,t)=>{let s=Object.values(e),o=x.getState().byConversationId,n=new Set(S()(s).filter(e=>e!==t[e.responseId]||!!e.state&&"closed"!==e.state).map(e=>e.conversationId).value()),i=s.filter(e=>n.has(e.conversationId)),r=b.A(e=>e.conversationId,i);return{...o,...S().pick(r,[...n.values()])}}),(0,d.lB)(x,"byId","nodesByConversationId",e=>{let t=x.getState().nodesByConversationId,s=!1,o={};for(let n in e){let i=e[n],r=i.conversationId,a=t[r]||[],l=a.find(e=>e.responseId===n);l?"streaming"===i.state&&l.parentResponseId!==i.parentResponseId&&(s=!0,o[r]=[...a,{...l,parentResponseId:i.parentResponseId,threadParentId:i.threadParentId}]):(s||(s=!0,o={...t}),o[r]?o[r]===a&&(o[r]=[...a]):o[r]=[...a],o[r].push({responseId:n,parentResponseId:i.parentResponseId,sender:i.sender,threadParentId:i.threadParentId}))}return s?o:t});let B=2;function E(e){var t;return{sender:"human",createTime:new Date().toISOString(),manual:!1,partial:!0,shared:!1,isControl:!1,query:"",queryType:"",thinkingTrace:"",webSearchResults:[],xpostIds:[],xposts:[],generatedImageUrls:[],imageAttachments:[],imageEditUris:[],fileAttachments:[],cardAttachmentsJson:[],fileUris:[],fileAttachmentsMetadata:[],state:"optimistic",parentResponseId:"",parentQuotedText:void 0,steps:[],imageEditUri:"",error:"",mediaTypes:[],webpageUrls:[],citedWebSearchResults:[],metadata:{},uiLayout:{reasoningUiLayout:"UNSPECIFIED"},selectedFileTextContent:"",selectedFileTextContentStartPosition:0,selectedFileTextContentEndPosition:0,toolResponses:[],toolUsageResultById:{},traceSteps:[],threadParentId:null!=(t=e.threadParentId)?t:"",...e}}function N(e,t,s){var o;let n="default"===t?Date.now():void 0,i=s?Date.now():void 0;return{message:"",createTime:new Date().toISOString(),manual:!1,partial:!0,shared:!1,isControl:!1,query:"",queryType:"",thinkingTrace:"",webSearchResults:[],xpostIds:[],xposts:[],generatedImageUrls:[],imageAttachments:[],imageEditUris:[],fileAttachments:[],cardAttachmentsJson:[],fileUris:[],fileAttachmentsMetadata:[],state:"streaming",steps:[],imageEditUri:"",error:"",mediaTypes:[],webpageUrls:[],citedWebSearchResults:[],metadata:{},deepsearchPreset:t,generatedImageHeight:void 0,generatedImageWidth:void 0,...e,liveThinkingStartTime:i,searchingStartTime:n,selectedFileTextContent:"",selectedFileTextContentStartPosition:0,selectedFileTextContentEndPosition:0,uiLayout:{reasoningUiLayout:"UNSPECIFIED"},toolResponses:[],toolUsageResultById:{},traceSteps:[],threadParentId:null!=(o=e.threadParentId)?o:""}}function A(){let e,t={};return[s=>{if(!e){x.getState().upsertResponse(s),e=setTimeout(()=>{let s=Object.values(t);t={},s.length&&x.getState().appendResponses(s),e=void 0},30);return}t[s.responseId]=s},s=>{s&&(t[s.responseId]=s),clearTimeout(e);let o=Object.values(t);t={},o.length&&x.getState().appendResponses(o),e=void 0}]}function V(e){var t;return e.liveThinkingStartTime||e.searchingStartTime||e.thinkingStartTime||(null==(t=e.progressReport)?void 0:t.category)==="HEAVY_ROLLOUT"}function z(e){return t=>(t&&e.forEach(e=>{e.parentResponseId=t.responseId}),e)}function L(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={},s=[];for(let o of e){if(o.toolUsageResults)for(let e of o.toolUsageResults)e.toolUsageCardId&&(t[e.toolUsageCardId]=S().merge(t[e.toolUsageCardId],e));if(o.text&&o.tags){let{rolloutId:e}=o;S()(o.tags).zip(o.text).sortBy(e=>{var t;return null!=(t=D[e[0]||""])?t:3}).forEach(t=>{let[o,n]=t;if(n)switch(o){case"summary":{let t=n.match(/(- .*)|(<xai:tool_usage_card>[\s\S]*<\/xai:tool_usage_card>)/g);null==t||t.forEach(t=>{t.startsWith("-")?s.push({type:"summary",text:t,rolloutId:e}):s.push({type:"tool",text:t,rolloutId:e})});break}case"header":s.push({type:"header",text:n,rolloutId:e})}})}}return{toolUsageResultById:t,traceSteps:s}}let D={header:0,summary:1,tool:1}},44347:(e,t,s)=>{s.d(t,{C$:()=>S,DC:()=>p,K2:()=>h,Qy:()=>g});var o=s(65258),n=s(97196),i=s(31352),r=s.n(i),a=s(96892),l=s.n(a),d=s(6132),c=s(82509),u=s(17823);let h={web_search:"web_search",google_web_search:"google_web_search",bing_web_search:"bing_web_search",web_search_with_snippets:"web_search_with_snippets",browse_page_with_js:"browse_page_with_js",browse_page_no_js:"browse_page_no_js",code_execution_training_parity:"code_execution_training_parity",get_x_user_handle:"get_x_user_handle",get_x_user_profile_pic_description:"get_x_user_profile_pic_description",x_post_lookup:"x_post_lookup",x_search:"x_search",x_keyword_search:"x_keyword_search",x_semantic_search:"x_semantic_search",get_top_us_news_from_x_trends:"get_top_us_news_from_x_trends",get_x_user_timeline:"get_x_user_timeline",get_x_bookmarks:"get_x_bookmarks",get_x_liked_posts:"get_x_liked_posts",render_x_posts:"render_x_posts",render_x_users:"render_x_users",render_card:"render_card"},m=d.z.object({model_name:d.z.string().nullish(),system_prompt_name:d.z.string().nullish(),enable_unified_layout:d.z.boolean().nullish(),tools_set:d.z.string().nullish(),system_turn_prompt:d.z.string().nullish(),tool_definition_prompt:d.z.string().nullish()}),p=d.z.object({promptMap:d.z.object({toolUseFc:d.z.string().nullish(),noToolUse:d.z.string().nullish(),toolUseSummarizer:d.z.string().nullish()}).nullish(),modelMap:d.z.object({noToolUse:d.z.string().nullish(),toolUse:d.z.string().nullish(),toolUseSummarizer:d.z.string().nullish(),imageGenModel:d.z.string().nullish(),imageEditModel:d.z.string().nullish()}).nullish(),useSingleModelEverything:d.z.boolean().nullish(),tools:d.z.record(d.z.nativeEnum(h),d.z.boolean()).nullish(),useToolOverrides:d.z.boolean().nullish(),sideBySideParams:m.array().nullish(),useSideBySideParams:d.z.boolean().nullish()});function g(e){let t=Object.values(null!=e?e:{});return!!t&&t.some(e=>"object"==typeof e&&e?Object.values(e).length>0:!e)}d.z.object({displayUserMessageMarkdown:d.z.boolean(),showFollowUpSuggestions:d.z.boolean(),autoWrapLongLinesCode:d.z.boolean(),browserNotificationsEnabled:d.z.boolean(),selectedSystemPromptId:d.z.string().optional(),showConversationPreviews:d.z.boolean(),hideArtifacts:d.z.boolean(),showActiveTabs:d.z.boolean(),disableTypeahead:d.z.boolean(),disableAutoScroll:d.z.boolean(),showGrok3ModeButtons:d.z.boolean(),enableTiptapEditorForQueryBar:d.z.boolean(),useModelModeSelector3:d.z.boolean(),enableStarBackground:d.z.boolean()});let v={displayUserMessageMarkdown:!1,showFollowUpSuggestions:!0,autoWrapLongLinesCode:!1,browserNotificationsEnabled:!1,selectedSystemPromptId:void 0,showConversationPreviews:!0,hideArtifacts:!1,showActiveTabs:!0,disableTypeahead:!1,disableAutoScroll:!1,showGrok3ModeButtons:!1,enableTiptapEditorForQueryBar:!0,useModelModeSelector3:!0,enableStarBackground:!0},I={isIncognito:!1,userSettingsPromise:void 0,userSettings:{excludeFromTraining:!1,allowXPersonalization:!0,preferences:v,enableMemory:!0},selectedLanguage:void 0,showAgeVerification:!1,ageVerificationCallback:void 0,modelConfigOverride:void 0,modelConfigOverrideByModel:{}},f={excludeFromTraining:!0,allowXPersonalization:!1,preferences:v,enableMemory:!1};class y{constructor(e,t){this.set=e,this.get=t,this.isIncognito=I.isIncognito,this.userSettingsPromise=I.userSettingsPromise,this.userSettings=I.userSettings,this.selectedLanguage=I.selectedLanguage,this.showAgeVerification=I.showAgeVerification,this.ageVerificationCallback=I.ageVerificationCallback,this.modelConfigOverride=I.modelConfigOverride,this.modelConfigOverrideByModel=I.modelConfigOverrideByModel,this.isToolComposer2=I.isToolComposer2,this.sideBySideMode=I.sideBySideMode,this.setIsIncognito=(0,o.kp)(this.set,"isIncognito"),this.setUserSettingsPromise=(0,o.kp)(this.set,"userSettingsPromise"),this.setUserSettings=(0,o.kp)(this.set,"userSettings"),this.setSelectedLanguage=(0,o.kp)(this.set,"selectedLanguage"),this.setShowAgeVerification=(0,o.kp)(this.set,"showAgeVerification"),this.setAgeVerificationCallback=(0,o.kp)(this.set,"setAgeVerificationCallback"),this.setModelConfigOverrideByModel=(0,o.kp)(this.set,"modelConfigOverrideByModel"),this.setIsToolComposer2=(0,o.kp)(this.set,"isToolComposer2"),this.setSideBySideMode=(0,o.kp)(this.set,"sideBySideMode"),this.initializeGdprUserSettings=()=>n.aK.settingsGetUserSettings().then(e=>{let t=this.get();void 0===e.excludeFromTraining||void 0===e.enableMemory?t.fetchSetUserSettings(f).catch(console.error):t.setUserSettings(w(e,t.userSettings))}),this.initializeEnterpriseUserSettings=()=>n.aK.settingsGetUserSettings().then(e=>{let t=this.get();e.excludeFromTraining?t.setUserSettings(w(e,t.userSettings)):t.fetchSetUserSettings(f).catch(console.error)}),this.fetchGetUserSettings=()=>{let e=this.get();if(e.userSettingsPromise)return e.userSettingsPromise;let t=n.aK.settingsGetUserSettings().then(t=>w(t,e.userSettings));return e.setUserSettingsPromise(t),t.then(e.setUserSettings).catch(console.error),t},this.fetchSetUserSettings=e=>{let t=this.get();t.setUserSettings({...t.userSettings,...e});let s=n.aK.settingsSetUserSettings({body:e}).then(e=>w(e,this.get().userSettings));return t.setUserSettingsPromise(s),s.then(t.setUserSettings).catch(e=>{console.error(e)}),s},this.fetchSetPreference=(e,t)=>{let s=this.get();return s.fetchSetUserSettings({...s.userSettings,preferences:{...s.userSettings.preferences,[e]:t}})}}}let S=(0,c.v)()((0,u.eh)((0,u.Zr)((e,t)=>new y(e,t),{name:"settings-store",partialize:e=>({modelConfigOverrideByModel:e.modelConfigOverrideByModel,isToolComposer2:e.isToolComposer2,sideBySideMode:e.sideBySideMode}),version:2})));function b(e,t){return d.z.object({displayUserMessageMarkdown:d.z.boolean().catch(e.displayUserMessageMarkdown),showFollowUpSuggestions:d.z.boolean().catch(e.showFollowUpSuggestions),autoWrapLongLinesCode:d.z.boolean().catch(e.autoWrapLongLinesCode),browserNotificationsEnabled:d.z.boolean().catch(e.browserNotificationsEnabled),selectedSystemPromptId:d.z.string().optional().catch(e.selectedSystemPromptId),showConversationPreviews:d.z.boolean().catch(e.showConversationPreviews),hideArtifacts:d.z.boolean().catch(e.hideArtifacts),showActiveTabs:d.z.boolean().catch(e.showActiveTabs),disableTypeahead:d.z.boolean().catch(e.disableTypeahead),disableAutoScroll:d.z.boolean().catch(e.disableAutoScroll),showGrok3ModeButtons:d.z.boolean().catch(e.showGrok3ModeButtons),enableTiptapEditorForQueryBar:d.z.boolean().catch(e.enableTiptapEditorForQueryBar),useModelModeSelector3:d.z.boolean().catch(e.useModelModeSelector3),enableStarBackground:d.z.boolean().catch(e.enableStarBackground)}).catch(e).parse(t)}function w(e,t){let s=l()(e,r());return{...t,...s,preferences:b(t.preferences,e.preferences)}}(0,o.CP)(S,"userSettings","user-settings",I.userSettings,function(e){return e&&"object"==typeof e?{excludeFromTraining:I.userSettings.excludeFromTraining,allowXPersonalization:I.userSettings.allowXPersonalization,preferences:{...b(v,e.userSettings),disableTypeahead:!1,showGrok3ModeButtons:!1},enableMemory:I.userSettings.enableMemory}:I.userSettings})},44845:(e,t,s)=>{s.d(t,{Ku:()=>i,TM:()=>n,ot:()=>r});var o=s(6132);let n=o.z.union([o.z.literal("none"),o.z.literal("unknown"),o.z.literal("deepsearch"),o.z.literal("deepersearch"),o.z.literal("think")]);function i(e){return"deepersearch"===e?"deeper":"deepsearch"===e?"default":void 0}function r(e){return"deepersearch"===e?"DEEPERSEARCH":"deepsearch"===e?"DEEPSEARCH":"think"===e?"REASONING":"DEFAULT"}},48992:(e,t,s)=>{s.d(t,{Cg:()=>l,Mb:()=>d,Po:()=>u,Wm:()=>function e(t,s){let o=t[s];if(!o)return s;let n=o[o.length-1];return n&&n.responseId?e(t,n.responseId):s},d7:()=>r,m$:()=>a,oN:()=>m,t$:()=>h,zp:()=>c});var o=s(38541),n=s.n(o),i=s(17703);function r(e,t,s){let o=n().keyBy(t,"responseId"),i=o[e];if(!i)return[];let r=[i],a=i.parentResponseId;for(;a&&(!s||r.length<s);){let e=o[a];if(!e||e.threadParentId)break;r.push(e),a=e.parentResponseId}return r}function a(e,t){let s;for(let o of e)if(t.find(e=>e.responseId===o.responseId))s=o;else break;return s}function l(e,t){let s=[],o=e,n=new Set;for(;o;){if(n.has(o.responseId||"")){(0,i.vV)("conversation-utils:getAncestorIds","Cycle detected in response hierarchy: ".concat(o.responseId));break}n.add(o.responseId||""),s.unshift(o.responseId||"");let e=o.parentResponseId;if(!e)break;o=t[e]}return s}function d(e){let t=e.filter(e=>!e.threadParentId),s=new Set(t.map(e=>e.parentResponseId)),o=t.filter(e=>!s.has(e.responseId));if(0!==o.length)return n().maxBy(o,e=>e.createTime)}function c(e,t,s){if(!s)return!1;for(let o of r(s,t))if(o.responseId&&!e.some(e=>e.responseId===o.responseId))return!0;return!1}function u(e){if(!e||0===e.length)return 0;let t=new Set(e.map(e=>e.parentResponseId).filter(e=>e&&!(0,o.isEmpty)(e))),s=e.filter(e=>!t.has(e.responseId)),n=0;for(let t of s)n=Math.max(n,r(t.responseId,e).length);return n}function h(e,t){return t.filter(t=>"threadParentId"in t&&t.threadParentId===e)}function m(e,t){return t.filter(t=>{var s,o;return t.threadParentId===e&&!(null==(s=t.responseId)?void 0:s.startsWith("streaming_in_progress_"))&&!(null==(o=t.responseId)?void 0:o.startsWith("optimistic_"))}).length}},49972:(e,t,s)=>{s.d(t,{b:()=>b,w:()=>S});var o=s(2376),n=s(17703),i=s(65258),r=s(97196),a=s(94980),l=s(3275),d=s(74995),c=s(6230),u=s(23831),h=s(53915),m=s(3814),p=s(54542),g=s(98451),v=s(43893);function I(e){return{...e,personaId:(0,o._c)(e.systemPromptName),isNew:!1,state:"closed"}}let f=a.A(I);class y{constructor(e,t){this.set=e,this.get=t,this.promiseById={},this.byId={},this.list=[],this.abortControllerById={},this.listPromiseByQuery={},this.nextPageTokenByQuery={},this.upsertConversation=(0,i.el)(this.set,"byId","conversationId"),this.appendConversations=(0,i.BC)(this.set,"byId","conversationId"),this.removeConversation=(0,i.TF)(this.set,"byId"),this.setById=(0,i.kp)(this.set,"byId"),this.idsertConversationPromise=(0,i.q5)(this.set,"promiseById"),this.removeConversationPromise=(0,i.TF)(this.set,"promiseById"),this.setPromiseById=(0,i.kp)(this.set,"promiseById"),this.idsertAbortControllerById=(0,i.q5)(this.set,"abortControllerById"),this.removeAbortControllerById=(0,i.TF)(this.set,"abortControllerById"),this.setListPromiseByQuery=(0,i.kp)(this.set,"listPromiseByQuery"),this.idsertListPromiseByQuery=(0,i.q5)(this.set,"listPromiseByQuery"),this.idsertNextPageTokenByQuery=(0,i.q5)(this.set,"nextPageTokenByQuery"),this.upsertAndCacheConversation=(e,t)=>{let s=this.get();t&&t in s.byId&&t!==e.conversationId&&(s.removeConversation(t),s.removeConversationPromise(t)),s.upsertConversation(e),s.idsertConversationPromise(Promise.resolve(e),e.conversationId)},this.appendAndCacheConversations=e=>{let t=l.A(d.A("conversationId"),e),s=c.A(e=>Promise.resolve(e),t),{byId:o,promiseById:n}=this.get();this.set({byId:{...o,...t},promiseById:{...n,...s}})},this.fetchCreateConversation=e=>{var t;let s=this.get(),i=v.A3.getState(),a=r.chatApi.chatCreateConversation({body:e}).then(e=>({...e,personaId:(0,o._c)(e.systemPromptName),isNew:!0,state:"closed"})),l=null==(t=e.addResponseRequest)?void 0:t.conversationId;return l&&(s.idsertConversationPromise(a,l),i.nodesByConversationId[l]=[]),a.then(e=>{s.upsertConversation(e),s.idsertConversationPromise(a,e.conversationId),i.nodesByConversationId[e.conversationId]=[]}).catch((0,n.HX)("fetchCreateConversation")),a},this.fetchUpdateConversation=(e,t)=>{let s=this.get(),o=r.chatApi.chatUpdateConversation({conversationId:e,body:t}).then(t=>({...s.byId[t.conversationId]||{conversationId:e,isNew:!1,state:"closed"},...t})).then(u.A(s.upsertConversation)),i={...s.byId[e]||{conversationId:e,isNew:!1,state:"closed"},...t};return s.upsertConversation(i),s.idsertConversationPromise(Promise.resolve(i),e),o.then(()=>s.idsertConversationPromise(o,e)).catch((0,n.HX)("fetchUpdateConversation")),o},this.fetchDeleteConversation=e=>{let t=this.get(),s=r.chatApi.chatDeleteConversation({conversationId:e});return t.removeConversation(e),t.removeConversationPromise(e),t.setListPromiseByQuery(c.A(t=>t.then(t=>t.filter(t=>t.conversation.conversationId!==e)),t.listPromiseByQuery)),s},this.fetchSoftDeleteConversation=e=>{let t=this.get(),s=r.chatApi.chatSoftDeleteConversation({conversationId:e});return t.removeConversation(e),t.removeConversationPromise(e),s},this.fetchGetConversation=e=>{let t=this.get();if(e in t.promiseById)return t.promiseById[e];let s=r.chatApi.chatGetConversation({conversationId:e,includeWorkspaces:!0,includeTaskResult:!0}).then(I);return t.set(h.A(m.A(["promiseById",e]),s)),s.then(t.upsertConversation).catch(console.error),s},this.fetchGetManyConversations=e=>{let t=this.get(),s={},o=[];if(e.forEach(e=>{e in t.promiseById?s[e]=t.promiseById[e]:o.push(e)}),0===o.length)return Promise.all(Object.values(s));let n=o.length>0?r.chatApi.chatGetConversations({conversationIds:o,includeWorkspaces:!0,includeTaskResult:!0}).then(e=>{let{conversations:t}=e;return t||[]}).then(f):Promise.resolve([]);return n.then(e=>{e.forEach(e=>{let s=Promise.resolve(e);t.idsertConversationPromise(s,e.conversationId)}),t.appendConversations(e)}).catch(console.error),Promise.all([...Object.values(s),n.then(e=>e||[])]).then(e=>e.flat())},this.fetchListConversations=(e,t)=>{let s=this.get(),o=JSON.stringify(function e(t){if(null===t||"object"!=typeof t)return t;if(Array.isArray(t))return t.map(e);let s=Object.keys(t).sort(),o={};for(let n of s)o[n]=e(t[n]);return o}(p.A(e=>!!e,e||{})),null,void 0);if(!t&&o in s.listPromiseByQuery)return s.listPromiseByQuery[o];let n=t?s.nextPageTokenByQuery[o]:void 0,i=r.chatApi.chatListConversations({pageSize:"60",pageToken:n,...e}).then(e=>{let{conversations:t,textSearchMatches:n,nextPageToken:i}=e;return(i&&s.idsertNextPageTokenByQuery(i,o),null==n?void 0:n.length)?n.map(e=>{if(e.conversation)return{...e,conversation:I(e.conversation)}}):(null==t?void 0:t.length)?t.map(e=>({conversation:I(e)})):[]}).then(e=>e.filter(e=>!!e)).then(u.A(e=>{s.appendConversations(e.map(e=>e.conversation)),s.setPromiseById(c.A(e=>Promise.resolve(e.conversation),l.A(e=>e.conversation.conversationId,e)))}));if(t){let e=s.listPromiseByQuery[o];if(e)return Promise.all([e,i]).then(g.A);s.idsertListPromiseByQuery(i,o)}else s.idsertListPromiseByQuery(i,o);return i},this.fetchSoftDeleteAllConversations=()=>(this.setById({}),this.setPromiseById({}),r.chatApi.chatSoftDeleteAllConversations())}}let S=(0,i.y$)(y,"useConversationStore");function b(e){let t=new Date().toISOString();return{title:"New conversation",createTime:t,modifyTime:t,starred:!1,temporary:!1,isNew:!0,state:"optimistic",mediaTypes:[],workspaces:[],taskResult:{},teamId:"",...e}}(0,i.lB)(S,"byId","list",Object.values)},56096:(e,t,s)=>{s.d(t,{x:()=>i});var o=s(65258);class n{constructor(e,t){this.set=e,this.get=t}}let i=(0,o.y$)(n,"useSubscriptionsStore")},56691:(e,t,s)=>{s.d(t,{$n:()=>c,gx:()=>u,ru:()=>d});var o=s(79342),n=s(7287),i=s(17338),r=s(88382),a=s(61312),l=s(61884);let d=(0,i.F)(["inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium leading-[normal] cursor-pointer","focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:opacity-60 disabled:cursor-not-allowed","transition-colors duration-100","[&_svg]:shrink-0","select-none"],{variants:{variant:{filled:"bg-button-filled text-fg-invert hover:bg-button-filled-hover disabled:hover:bg-button-filled",filledSecondary:"bg-surface-l2 text-fg-secondary hover:bg-surface-l4-hover dark:hover:bg-surface-l3 border border-border-l1 disabled:hover:bg-surface-l2 dark:disabled:hover:bg-surface-l2",outline:"border border-border-l2 text-fg-primary hover:bg-button-ghost-hover [&_svg]:hover:text-fg-primary disabled:hover:bg-transparent",ghost:"text-fg-primary hover:bg-button-ghost-hover disabled:hover:bg-transparent border border-transparent",ghostSecondary:"text-fg-secondary hover:text-fg-primary hover:bg-button-ghost-hover disabled:hover:text-fg-secondary disabled:hover:bg-transparent [&_svg]:hover:text-fg-primary",text:"text-fg-primary bg-transparent hover:text-fg-secondary disabled:hover:text-fg-primary",textSecondary:"text-secondary bg-transparent hover:text-primary disabled:hover:text-fg-secondary",sticky:"text-fg-secondary hover:text-fg-primary disabled:hover:text-fg-secondary bg-surface-l1 dark:bg-surface-l2 dark:hover:bg-surface-l3 hover:bg-surface-l4-hover disabled:hover:bg-surface-l1 dark:disabled:hover:bg-surface-l2",none:"",primary:"bg-button-primary text-background hover:bg-button-primary-hover",secondary:"bg-button-secondary text-primary hover:bg-button-secondary-hover",accent:"bg-sunset/90 text-ivory hover:bg-sunset",card:"ring-1 ring-inset ring-toggle-border bg-card hover:bg-card-hover text-primary",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",link:"text-primary underline-offset-4 hover:underline"},size:{xxs:"h-5 rounded-lg px-1.5 text-[10px]",xs:"h-6 rounded-lg px-2.5 text-xs",sm:"h-8 rounded-xl px-3 text-xs",md:"h-10 rounded-xl px-3.5 py-1.5 text-sm",lg:"h-12 rounded-2xl px-5",iconXs:"h-6 w-6 rounded-lg",iconSm:"h-8 w-8 rounded-lg",iconMd:"h-10 w-10 rounded-xl",iconLg:"h-12 w-12 rounded-2xl",none:"",iconXl:"h-10 w-10 rounded-full",pill:"h-9 rounded-full px-3.5 py-2",nav:"h-8 rounded-xl px-3.5 text-sm font-medium",icon:"h-10 w-10 rounded-xl",default:"h-9 px-4 py-2 rounded-lg",noPadding:"h-9 rounded-lg"},rounded:{true:"rounded-full",false:null},btnColor:{default:null,danger:null},overideIconStyle:{true:"[&_svg]:text-inherit [&_svg]:hover:text-inherit",false:null}},compoundVariants:[{variant:"filled",btnColor:"danger",className:"text-white bg-red-500 hover:bg-red-400 disabled:hover:bg-red-500"},{variant:"filledSecondary",btnColor:"danger",className:"text-red-400 dark:text-red-300 hover:text-red-500 dark:text-red-200"},{variant:["outline","ghost","ghostSecondary","text"],btnColor:"danger",className:"text-red-400 dark:text-red-300 hover:text-red-500 dark:text-red-200 hover:bg-red-400/10"}],defaultVariants:{variant:"none",size:"md",rounded:!1,btnColor:"default"}}),c=r.forwardRef((e,t)=>{let{className:s,variant:i,size:r,btnColor:l="default",rounded:c=!1,asChild:u=!1,overideIconStyle:h=!1,...m}=e,p=u?n.DX:"button";return(0,o.jsx)(p,{className:(0,a.cn)(d({variant:i,size:r,rounded:c,btnColor:l,overideIconStyle:h,className:s})),ref:t,type:"button",...m})});c.displayName="Button";let u=r.forwardRef((e,t)=>{let{className:s,variant:i,size:r,btnColor:c="default",rounded:u=!1,asChild:h=!1,overideIconStyle:m=!1,tooltipProps:p={},tooltipContent:g,tooltipContentProps:v={},tooltipAsChild:I,stayOpenOnClick:f=!1,...y}=e,S=h?n.DX:"button",b=y["aria-label"];return void 0===b&&"string"==typeof g&&(b=g),(0,o.jsxs)(l.m_,{delayDuration:100,...p,children:[(0,o.jsx)(l.k$,{asChild:!0,onClick:f?e=>e.preventDefault():void 0,children:(0,o.jsx)(S,{className:(0,a.cn)(d({variant:i,size:r,rounded:u,btnColor:c,overideIconStyle:m,className:s})),ref:t,type:"button","aria-label":b,...y})}),g?(0,o.jsx)(l.ZI,{onPointerDownOutside:f?e=>e.preventDefault():void 0,...v,children:g}):null]})});u.displayName="ButtonWithTooltip"},58192:(e,t,s)=>{s.d(t,{E8:()=>r,Sk:()=>o,Wl:()=>i,fG:()=>a,oQ:()=>n});let o="grok-3",n="Grok 3",i="Grok 3",r="grok-3",a="Grok 2"},61884:(e,t,s)=>{s.d(t,{Bc:()=>a,Gv:()=>u,ZI:()=>c,k$:()=>d,m_:()=>l});var o=s(79342),n=s(40251),i=s(88382),r=s(61312);let a=n.Kq,l=n.bL,d=n.l9,c=i.forwardRef((e,t)=>{let{className:s,sideOffset:i=4,disableAnimation:a,container:l,...d}=e;return(0,o.jsx)(n.ZL,{container:l,children:(0,o.jsx)(n.UC,{ref:t,collisionPadding:{top:16,right:16,bottom:16,left:16},sideOffset:i,className:(0,r.cn)("z-50 overflow-hidden rounded-md bg-popover shadow-sm dark:shadow-none px-3 py-1.5","text-xs text-popover-foreground pointer-events-none","max-w-80 text-wrap",a?"":(0,r.cn)("animate-in fade-in-0 zoom-in-95","data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95","data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2","data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2"),s),...d})})});c.displayName=n.UC.displayName;let u=(0,r.cn)("z-50 overflow-hidden rounded-2xl bg-primary text-primary-foreground","shadow-sm dark:shadow-none text-xs animate-in fade-in-0 zoom-in-95","data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95","data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 p-3");c.displayName=n.UC.displayName},65258:(e,t,s)=>{s.d(t,{BC:()=>f,CP:()=>S,L$:()=>h,MQ:()=>w,TF:()=>m,_q:()=>R,el:()=>p,gN:()=>v,kp:()=>u,lB:()=>y,oQ:()=>I,ok:()=>k,q5:()=>g,y$:()=>b});var o=s(85431),n=s(3275),i=s(74995),r=s(53915),a=s(46815),l=s(82509),d=s(17823),c=s(76328);function u(e,t){return s=>{e(e=>({...e,[t]:s}),void 0,"assign:".concat(C(arguments)))}}function h(e,t){return()=>{e(e=>({...e,[t]:!e[t]}),void 0,"toggle:".concat(C(arguments)))}}function m(e,t){return s=>{e(e=>({...e,[t]:o.A([s],e[t])}),void 0,"remove:".concat(C(arguments)))}}function p(e,t,s){return o=>{e(e=>({...e,[t]:{...e[t],...n.A(i.A(s),[o])}}),void 0,"upsert:".concat(C(arguments)))}}function g(e,t){return(s,o)=>{e(e=>({...e,[t]:{...e[t],[o]:s}}),void 0,"idsert:".concat(C(arguments)))}}function v(e,t){return(s,o)=>{e(e=>({...e,[t]:{...e[t],[o]:[...e[t][o]||[],s]}}),void 0,"lisert:".concat(C(arguments)))}}function I(e,t,s){return(o,n)=>{let i=!1;return e(e=>{var r;return{...e,[t]:{...e[t],[o]:null==(r=e[t][o])?void 0:r.filter(e=>{let t=e[s]!==n;return t||(i=!0),t})}}},void 0,"delist:".concat(C(arguments))),i}}function f(e,t,s){return o=>{e(e=>({...e,[t]:{...e[t],...n.A(i.A(s),o)}}),void 0,"append:".concat(C(arguments)))}}function y(e,t,s,o){let{subscribe:n,setState:l}=e;return n(i.A(t),(e,t)=>{l(r.A(a.A(s),o(e,t)))},{fireImmediately:!0})}function S(e,t,s,o,n){let{subscribe:l,setState:d}=e;try{let e=localStorage.getItem(s);if(null!=e){let s=JSON.parse(e);if(n){let e=n(s);d(r.A(a.A(t),e))}else d(r.A(a.A(t),s))}}catch(e){localStorage.setItem(s,JSON.stringify(o))}l(i.A(t),e=>{localStorage.setItem(s,JSON.stringify(e))})}function b(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return s?(0,l.v)()((0,d.lt)((0,d.eh)((t,s)=>new e(t,s)),{name:t,store:t})):(0,l.v)()((0,d.eh)((t,s)=>new e(t,s)))}function w(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return s?(0,l.v)()((0,d.lt)((0,d.eh)((0,c.D)((t,s)=>({...new e(t,s)}))),{name:t,store:t})):(0,l.v)()((0,c.D)((t,s)=>({...new e(t,s)})))}function C(e){return String([...e].slice(1))}function k(e){return{data:e,status:"success",error:null}}function R(e){return{data:null,status:"error",error:e instanceof Error?e:Error("unknown error")}}},68332:(e,t,s)=>{s.d(t,{o:()=>m});var o=s(38614),n=s(41739),i=s(17703),r=s(84499),a=s(49972),l=s(39116),d=s(12110),c=s(88382);let u=[new d.w("/chat/:chatId"),new d.w("/chat"),new d.w("/")],h=new d.w("/share/:shareLinkId");function m(){let e=(0,l.useRouter)(),t=(0,l.usePathname)(),{push:s}=(0,r.wK)(),d=(0,c.useMemo)(()=>!!t&&u.some(e=>e.test(t)),[t]),m=(0,c.useMemo)(()=>!!t&&h.test(t),[t]),p=(0,c.useMemo)(()=>{if(m){var e;return{shareLinkId:null==(e=h.test(t))?void 0:e.shareLinkId}}},[m,t]),g=(0,c.useCallback)((t,r,l)=>{let c=o.aP.getState();c.setConversationId(t),c.setSidePanelContent(void 0);let{fetchGetConversation:u,byId:h}=a.w.getState();if(t&&l){let e=n.a.getState();u(t).then(e.upsertConversationAsTab).catch((0,i.HX)("use-chat-router:routeToConversation:addToTabs"))}if(!r)if(t){var m,p;let o=null!=(p=null==(m=h[t])?void 0:m.temporary)&&p;s({page:"chat",conversationId:t,temporary:o}),d||e.push("/chat/".concat(t))}else s({page:"main"})},[d,s,e]);return{isChatPage:d,isSharePage:m,pageData:p,routeToConversation:g,signInWithReturnTo:(0,c.useCallback)((s,o,n)=>{let i=new URLSearchParams({q:s||"",reasoningMode:o||"none",voice:n?"true":"false"}).toString(),r=i?"".concat(t,"?").concat(i):t,a=r?new URLSearchParams({return_to:r}).toString():void 0;e.push("/sign-in".concat(a?"?".concat(a):""))},[e,t])}}},69648:(e,t,s)=>{s.d(t,{w:()=>a});var o=s(79342),n=s(90808),i=s(88382),r=s(61312);let a=i.forwardRef((e,t)=>{let{className:s,orientation:i="horizontal",decorative:a=!0,...l}=e;return(0,o.jsx)(n.b,{ref:t,decorative:a,orientation:i,className:(0,r.cn)("shrink-0 bg-border","horizontal"===i?"h-[1px] w-full":"h-full w-[1px]",s),...l})});a.displayName=n.b.displayName},70888:(e,t,s)=>{s.d(t,{x:()=>c});var o=s(17703),n=s(65258),i=s(97196),r=s(14908),a=s(86530).hp;let l={listByConversationId:{},fileMetaPromiseById:{},fileMetaById:{},attachListByConversationId:{}};class d{constructor(e,t){this.set=e,this.get=t,this.listByConversationId=l.listByConversationId,this.fileMetaPromiseById=l.fileMetaPromiseById,this.fileMetaById=l.fileMetaById,this.attachListByConversationId=l.attachListByConversationId,this.lisertByConversationId=(0,n.gN)(this.set,"listByConversationId"),this.removeByConversationId=(0,n.TF)(this.set,"listByConversationId"),this.delistByConversationId=(0,n.oQ)(this.set,"listByConversationId","file"),this.upsertFileMetadata=(0,n.el)(this.set,"fileMetaById","fileMetadataId"),this.idsertFileMetadataPromise=(0,n.q5)(this.set,"fileMetaPromiseById"),this.lisertAttachByConversationId=(0,n.gN)(this.set,"attachListByConversationId"),this.removeAttachByConversationId=(0,n.TF)(this.set,"attachListByConversationId"),this.delistAttachByConversationId=(0,n.oQ)(this.set,"attachListByConversationId","assetId"),this.fetchUploadFile=(e,t)=>{let s=this.get(),n=e.arrayBuffer().then(t=>i.chatApi.chatUploadFile({body:{fileName:e.name,fileMimeType:e.type,content:a.from(t).toString("base64")}}).then(e=>e).catch(e=>{if(e.message.includes("OUT_OF_RANGE"))throw Error("File was too large.");throw e})),r={file:e,metadataPromise:n};return s.lisertByConversationId(r,t),n.then(o=>{s.delistByConversationId(t,e)&&s.lisertByConversationId({...r,metadata:o},t)}).catch(n=>{s.delistByConversationId(t,e)&&(s.lisertByConversationId({...r,metadata:n},t),(0,o.vV)("fetchUploadFile",n))}),r},this.fetchFileMetadata=e=>{let t=this.get();if(e in t.fileMetaById)return Promise.resolve(t.fileMetaById[e]);if(e in t.fileMetaPromiseById)return t.fileMetaPromiseById[e];let s=i.chatApi.chatGetFileMetadata({fileMetadataId:e}).then(e=>e);return t.idsertFileMetadataPromise(s,e),s.then(t.upsertFileMetadata),s},this.fetchAttachThirdPartyFile=(e,t,s,n,a)=>{let l=this.get(),d=i.chatApi.chatUploadFile({body:{fileName:e,fileMimeType:t,fileSource:s,thirdPartyFileId:n}}).then(e=>e).catch(e=>{if(e.message.includes("OUT_OF_RANGE"))throw Error("File was too large.");throw e}),c=new File([n],e),u={file:c,metadataPromise:d};return l.lisertByConversationId(u,a),d.then(e=>{l.delistByConversationId(a,c)&&l.lisertByConversationId({...u,metadata:e},a)}).catch(e=>{l.delistByConversationId(a,c)&&(l.lisertByConversationId({...u,metadata:e},a),(0,o.vV)("fetchAttachThirdPartyFile",e)),e.message&&r.oR.error(e.message)}),u}}}let c=(0,n.y$)(d,"useFileStore")},83626:(e,t,s)=>{function o(e){let t=!1;return()=>{t||(e(),t=!0)}}function n(e,t){if(void 0!==e)return t(e)}s.d(t,{F:()=>n,S:()=>o})},84499:(e,t,s)=>{s.d(t,{KQ:()=>E,N_:()=>M,wK:()=>x});var o=s(79342),n=s(38614),i=s(17703),r=s(44347),a=s(39116),l=s(12110),d=s(88382),c=s(61657);let u=["conversations","attachments"],h=["name","size","used","created"],m="used",p=["image","document","spreadsheet","code","pdf"],g=["user","grok"],v=new l.w("/files"),I=new l.w("/workspace"),f=new l.w("/workspace/:id"),y=new l.w("/project"),S=new l.w("/project/:id"),b=new l.w("/chat/:id"),w=new l.w("/chat"),C=new l.w("/images"),k=new l.w("/tasks"),R=new l.w("/finance/:ticker"),_=new l.w("/faq");function T(e,t){switch(e.page===t.page&&(e=function(e){let t={...e};for(let e of Object.keys(t))void 0===t[e]&&delete t[e];return t}(e),e={...t,...e}),e.page){case"main":return{pathname:"/",query:{voice:e.voice?"true":void 0}};case"files":return{pathname:"/files",query:{file:e.fileId||void 0,emptyView:"default"===e.emptyView?void 0:e.emptyView,search:e.search||void 0,sort:e.sort===m?void 0:e.sort,fileType:e.fileType,createdBy:e.createdBy}};case"workspaces":return{pathname:"/project"};case"workspace":return{pathname:"/project/"+e.workspaceId,query:{tab:e.tab||void 0,chat:e.conversationId||void 0}};case"chat":if(e.temporary)return{pathname:"/chat"};if(!e.conversationId)return{pathname:"/"};return{pathname:"/chat/"+e.conversationId};case"unknown":return{pathname:"/"};case"images":return{pathname:"/images".concat(e.tab?"/".concat(e.tab):"")};case"tasks":return{pathname:"/tasks",query:{taskId:e.taskId||void 0,tab:e.tab||void 0}};case"plans":return{pathname:"/plans"};case"finance":return{pathname:"/finance/"+e.ticker};case"faq":return{pathname:"/faq"};default:let s=e;return(0,i.vV)("routeToUrlObject","Unhandled route case:"+s),{}}}let M=(0,d.forwardRef)((e,t)=>{let{route:s,onClick:i,...l}=e,{route:c}=x(),u=(0,d.useMemo)(()=>B(T(s,c)),[JSON.stringify(s),JSON.stringify(c)]),h=(0,a.useRouter)(),{route:m}=x(),p=(0,d.useCallback)(e=>{var t;if(null==i||i(e),!function(e){let t=e.currentTarget.getAttribute("target");return t&&"_self"!==t||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||2===e.button}(e)&&(e.preventDefault(),null==(t=globalThis)||t.window.history.pushState({},"",u),("unknown"===m.page||"unknown"===s.page)&&h.push(u),"main"===s.page)){let{setIsIncognito:e}=r.C$.getState();if(e(!1),"chat"===c.page){let{setOptimisticConversationId:e,setConversationId:t,setSidePanelContent:s}=n.aP.getState();e(void 0),t(void 0),s(void 0)}}},[m.page,h,i,s.page,u,c.page]);return(0,o.jsx)("a",{...l,onClick:p,href:u,ref:t})});function x(){let e=(0,a.usePathname)(),t=(0,a.useSearchParams)(),s=(0,d.useMemo)(()=>(function(e,t){var s,o,n,i,r,a,l;if("/"===e)return{page:"main",voice:"true"===t.get("voice")};if(v.test(e))return{page:"files",fileId:t.get("file")||null,emptyView:"image"===t.get("emptyView")?"image":"default",search:t.get("search")||void 0,sort:null!=(s=P(h,t.get("sort")))?s:m,fileType:P(p,t.get("fileType")),createdBy:P(g,t.get("createdBy"))};if(I.test(e)||y.test(e))return{page:"workspaces"};let d=f.test(e);if(null==d?void 0:d.id){let e=null!=(o=t.get("tab"))?o:"",s=null!=(n=t.get("chat"))?n:"";return{page:"workspace",workspaceId:d.id,tab:null!=(i=P(u,e))?i:null,conversationId:s}}let c=S.test(e);if(null==c?void 0:c.id){let e=null!=(r=t.get("tab"))?r:"",s=null!=(a=t.get("chat"))?a:"";return{page:"workspace",workspaceId:c.id,tab:null!=(l=P(u,e))?l:null,conversationId:s}}let T=b.test(e);if(null==T?void 0:T.id)return{page:"chat",conversationId:T.id,temporary:!1};if(w.test(e))return{page:"chat",conversationId:null,temporary:!0};if(C.test(e))return{page:"images"};if(k.test(e))return{page:"tasks",taskId:t.get("taskId"),tab:t.get("tab")};let M=R.test(e);return M?{page:"finance",ticker:M.ticker}:_.test(e)?{page:"faq"}:{page:"unknown"}})(e,t),[e,t.toString()]),o=(0,d.useCallback)(e=>{var t;let o=B(T(e,s));null==(t=globalThis)||t.window.history.pushState({},"",o)},[s]),n=(0,d.useCallback)(e=>{var t;let o=B(T(e,s));null==(t=globalThis)||t.window.history.replaceState({},"",o)},[s]);return(0,d.useMemo)(()=>({push:o,replace:n,route:s}),[o,n,s])}function P(e,t,s){return e.includes(t)?t:s}function B(e){if(e.query&&"string"!=typeof e.query)for(let t in e.query)void 0===e.query[t]&&delete e.query[t];return(0,c.format)(e)}function E(e,t){let s=B(T(e,e));return"".concat(t).concat(s)}},98100:(e,t,s)=>{s.d(t,{I2:()=>C,$E:()=>y,QG:()=>S,GB:()=>b});var o=s(38614),n=s(58192),i=s(12493),r=s(6132);let a=r.z.object({modelId:r.z.string(),name:r.z.string().optional(),description:r.z.string().optional(),modeDescription:r.z.string().optional(),tags:r.z.array(r.z.string()).optional(),badgeText:r.z.string().optional(),modelMode:r.z.nativeEnum(i.it).optional()});r.z.object({models:r.z.array(a).optional().default([]),defaultFreeModel:r.z.string().optional(),defaultProModel:r.z.string().optional(),unavailableModels:r.z.array(a).optional().default([]),defaultAnonModel:r.z.string().optional()});let l=e=>["get-models",e];var d=s(97196),c=s(70888),u=s(13511),h=s(61683),m=s(38541),p=s.n(m),g=s(74995),v=s(3275),I=s(88382),f=s(75500);function y(){let e=(0,f.h)();return(0,I.useMemo)(()=>e.FORCE_SIGN_IN_MODELS.value.forceSignInModels&&Array.isArray(e.FORCE_SIGN_IN_MODELS.value.forceSignInModels)?e.FORCE_SIGN_IN_MODELS.value.forceSignInModels:[],[e.FORCE_SIGN_IN_MODELS.value])}function S(e){var t,s;let n=(0,c.x)(g.A("listByConversationId")),i=(0,c.x)(g.A("attachListByConversationId")),r=(0,o.aP)(g.A("conversationId"))||"no_conversation_id",a=(0,o.aP)(g.A("reasoningMode")),l="deepsearch"==a||"deepersearch"==a,d="think"==a,u=n[r],h=i[r],m=((null==u?void 0:u.length)||0)+((null==h?void 0:h.length)||0),p=null==e||null==(t=e.tags)?void 0:t.includes("no_attachments_for_think"),v=null==e||null==(s=e.tags)?void 0:s.includes("no_attachments_for_deepsearch"),f=!!(m&&p),y=!!(m&&v);return{isAttachDisabled:(0,I.useMemo)(()=>!!p&&!!d||!!v&&!!l,[l,d,p,v]),isThinkDisabled:f,isDeepsearchDisabled:y,isThinkSelected:d,isDeepsearchSelected:l}}function b(){var e,t,s,o,i;let r=h.Ay.language,c=(0,f.h)(),{data:m,isPending:y}=(0,u.IT)({queryKey:l(r),queryFn:async()=>{var e,t,s,o,i;return{models:((e=await d.FI.modelsGetModels({body:{locale:r}})).models||[]).map(e=>a.safeParse(e)).filter(e=>e.success).map(e=>e.data).sort((e,t)=>e.name===n.Wl?-1:t.name===n.Wl||e.name===n.fG?1:t.name===n.fG?-1:0),unavailableModels:(e.unavailableModels||[]).map(e=>a.safeParse(e)).filter(e=>e.success).map(e=>e.data),defaultAnonModelId:null!=(t=e.defaultAnonModel)?t:n.Sk,defaultFreeModelId:null!=(s=e.defaultFreeModel)?s:n.Sk,defaultProModelId:null!=(o=e.defaultProModel)?o:n.Sk,defaultHeavyModelId:null!=(i=e.defaultHeavyModel)?i:n.Sk}},staleTime:3e5}),S=(0,I.useMemo)(()=>{var e;if(!m)return[];let t=_.safeParse(c.GROK35_FLEXIBLE_INPUT.value),s=new Set(null==(e=k.safeParse(c.HIDE_MODELS.value).data)?void 0:e.hideModels);return p().sortBy(m.models.filter(e=>!s.has(e.modelId)),"name").map(e=>({...e,...w(e.modelId,t)}))},[m,c.HIDE_MODELS,c.GROK35_FLEXIBLE_INPUT]),b=(0,I.useMemo)(()=>S?v.A(g.A("modelId"),S):{},[S]);return{models:S,unavailableModels:null!=(e=null==m?void 0:m.unavailableModels)?e:[],defaultAnonModelId:null!=(t=null==m?void 0:m.defaultAnonModelId)?t:n.Sk,defaultFreeModelId:null!=(s=null==m?void 0:m.defaultFreeModelId)?s:n.Sk,defaultProModelId:null!=(o=null==m?void 0:m.defaultProModelId)?o:n.Sk,defaultHeavyModelId:null!=(i=null==m?void 0:m.defaultHeavyModelId)?i:n.Sk,modelById:b,isPending:y}}function w(e,t){var s,o,n,i,r,a,l,d;let c={modelId:e};return(null==(o=t.data)||null==(s=o[e])?void 0:s.name_override)&&(c.name=null==(a=t.data)||null==(r=a[e])?void 0:r.name_override),(null==(i=t.data)||null==(n=i[e])?void 0:n.description_override)&&(c.description=null==(d=t.data)||null==(l=d[e])?void 0:l.description_override),c}function C(e,t){return w(e,_.safeParse(t.GROK35_FLEXIBLE_INPUT.value))}let k=r.z.object({hideModels:r.z.array(r.z.string())}),R=r.z.object({name_override:r.z.string().nullish(),description_override:r.z.string().nullish()}).catch({}),_=r.z.record(r.z.string(),R).catch({})}}]);