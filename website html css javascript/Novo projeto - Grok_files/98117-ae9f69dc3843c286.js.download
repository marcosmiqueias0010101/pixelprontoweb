!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="79efeac4-756a-4d23-aa78-2cae987c8564",e._sentryDebugIdIdentifier="sentry-dbid-79efeac4-756a-4d23-aa78-2cae987c8564")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[98117],{14461:(e,t,a)=>{a.d(t,{F:()=>l,a:()=>o});let i=e=>{var t;let a=null==e?void 0:e.filter(e=>{var t,a,i;return(null==(t=e.label)?void 0:t.length)&&(null==(a=e.label)?void 0:a.length)<=4&&(null==(i=e.label)?void 0:i.length)>0});return a&&a.length>0&&(null==(t=a[0])?void 0:t.label)?a[0].label:null};var s=a(97196),n=a(13511),r=a(75500);let l=e=>{let t=(0,r.h)();return(0,n.IT)({retry:!1,queryKey:["ticker",e],queryFn:async()=>{if(null==e||""==e)return null;try{return await s.rA.financeGetStockMiniSummary({ticker:e})}catch(e){if(e instanceof Error&&e.message.includes("404"))return null;throw e}},enabled:t.SHOW_FINANCE_SUGGESTIONS&&null!=e&&""!=e.trim()&&e.length<=4})},o=(e,t)=>{var a,s,n,r,o,d,c,u,p,m,g;let f=i(t||[]),{data:h}=l(f),{data:v}=l(e);if(!v&&!h)return t;let x=t.some(t=>t.label===e.trimEnd()),b=v&&!x?{type:"finance",label:e,prefix:e,payload:{type:"stockMiniSummary",summary:{ticker:null!=(d=null==v?void 0:v.ticker)?d:"",name:null!=(c=null==v||null==(a=v.stockOverview)?void 0:a.name)?c:"",value:null!=(u=null==v||null==(s=v.financeValue)?void 0:s.value)?u:0,change:null!=(p=null==v||null==(n=v.financeValue)?void 0:n.change)?p:0,changePercent:null!=(m=null==v||null==(r=v.financeValue)?void 0:r.changePercent)?m:0,unit:null!=(g=null==v||null==(o=v.financeValue)?void 0:o.unit)?g:""}}}:null;return[null!=b?b:null,...t.map(e=>{if(h&&e.label===f){var t,a,i,s,n,r,l,o,d,c,u;return{...e,type:"finance",payload:{type:"stockMiniSummary",summary:{ticker:null!=(r=h.ticker)?r:"",name:null!=(l=null==(t=h.stockOverview)?void 0:t.name)?l:"",value:null!=(o=null==(a=h.financeValue)?void 0:a.value)?o:0,change:null!=(d=null==(i=h.financeValue)?void 0:i.change)?d:0,changePercent:null!=(c=null==(s=h.financeValue)?void 0:s.changePercent)?c:0,unit:null!=(u=null==(n=h.financeValue)?void 0:n.unit)?u:""}}}}return e})].filter(e=>null!=e)}},30693:(e,t,a)=>{a.d(t,{F:()=>o});var i=a(79342),s=a(72055),n=a(88382),r=a(65146),l=a(75500);function o(){let e=(0,l.h)();return(0,n.useMemo)(()=>{var t,a;let i=Array.isArray(null==(a=e.EDIT_IMAGE_PRESETS)||null==(t=a.value)?void 0:t.presets)?e.EDIT_IMAGE_PRESETS.value.presets:[];return{editImagePresets:d.map(e=>({...e,label:e.label,presets:e.presets.map(e=>{var t,a;return{...e,prompt:null!=(a=null==(t=i.find(t=>t.presetId===e.presetId))?void 0:t.prompt)?a:""}})})).filter(e=>e.presets.some(e=>e.prompt)).map(e=>({...e,presets:e.presets.filter(e=>e.prompt)}))}},[e])}let d=[{category:"creative",icon:s.v9l,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.categories.creative",defaults:"Creative"}),presets:[{presetId:"water-color",icon:s.RSl,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.water-color",defaults:"Watercolor"}),previewUrl:"/image-editing-preset-previews/water-color.jpg"},{presetId:"15th-century",icon:s.lqP,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.15th-century",defaults:"15th Century"}),previewUrl:"/image-editing-preset-previews/15th-century.jpg"},{presetId:"graffiti",icon:s.OKP,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.graffiti",defaults:"Graffiti"}),previewUrl:"/image-editing-preset-previews/graffiti.jpg"},{presetId:"renaissance-painting",icon:s.esB,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.renaissance-painting",defaults:"Renaissance Painting"}),previewUrl:"/image-editing-preset-previews/renaissance-painting.jpg"},{presetId:"symbolist-painting",icon:s.kU3,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.symbolist-painting",defaults:"Symbolist Painting"}),previewUrl:"/image-editing-preset-previews/symbolist-painting.jpg"},{presetId:"expressionist-painting",icon:s.vMd,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.expressionist-painting",defaults:"Expressionist Painting"}),previewUrl:"/image-editing-preset-previews/expressionist-painting.jpg"},{presetId:"cubist-painting",icon:s.M6A,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.cubist-painting",defaults:"Cubist Painting"}),previewUrl:"/image-editing-preset-previews/cubist-painting.jpg"},{presetId:"ukiyo-e-painting",icon:s.GeJ,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.ukiyo-e-painting",defaults:"Ukiyo-e Painting"}),previewUrl:"/image-editing-preset-previews/ukiyo-e-painting.jpg"},{presetId:"bright-anime",icon:s.pnY,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.bright-anime",defaults:"Bright Anime"}),previewUrl:"/image-editing-preset-previews/bright-anime.jpg"},{presetId:"dark-anime",icon:s.AUI,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.dark-anime",defaults:"Dark Anime"}),previewUrl:"/image-editing-preset-previews/dark-anime.jpg"},{presetId:"cyberpunk",icon:s.Qxc,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.cyberpunk",defaults:"Cyberpunk"}),previewUrl:"/image-editing-preset-previews/cyberpunk.jpg"},{presetId:"retro-game",icon:s.Wud,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.retro-game",defaults:"Retro Game"}),previewUrl:"/image-editing-preset-previews/retro-game.jpg"}]},{category:"background",icon:s.dM2,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.categories.background",defaults:"Background"}),presets:[{presetId:"paris",icon:s.t6i,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.paris",defaults:"Paris"}),previewUrl:"/image-editing-preset-previews/paris.jpg"},{presetId:"london",icon:s.t6i,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.london",defaults:"London"}),previewUrl:"/image-editing-preset-previews/london.jpg"},{presetId:"tokyo",icon:s.t6i,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.tokyo",defaults:"Tokyo"}),previewUrl:"/image-editing-preset-previews/tokyo.jpg"},{presetId:"mars",icon:s.XQK,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.mars",defaults:"Mars"}),previewUrl:"/image-editing-preset-previews/mars.jpg"},{presetId:"tropical-paradise",icon:s.L71,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.tropical-paradise",defaults:"Tropical Paradise"}),previewUrl:"/image-editing-preset-previews/tropical-paradise.jpg"},{presetId:"cosmic-void",icon:s.sUz,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.cosmic-void",defaults:"Cosmic Void"}),previewUrl:"/image-editing-preset-previews/cosmic-void.jpg"},{presetId:"urban-rooftop",icon:s.t6i,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.urban-rooftop",defaults:"Urban Rooftop"}),previewUrl:"/image-editing-preset-previews/urban-rooftop.jpg"},{presetId:"enchanted-cave",icon:s.gDK,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.enchanted-cave",defaults:"Enchanted Cave"}),previewUrl:"/image-editing-preset-previews/enchanted-cave.jpg"},{presetId:"misty-forest",icon:s.YUH,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.misty-forest",defaults:"Misty Forest"}),previewUrl:"/image-editing-preset-previews/misty-forest.jpg"},{presetId:"retro-arcade",icon:s.ZNA,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.retro-arcade",defaults:"Retro Arcade"}),previewUrl:"/image-editing-preset-previews/retro-arcade.jpg"},{presetId:"space-station",icon:s.f36,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.space-station",defaults:"Space Station"}),previewUrl:"/image-editing-preset-previews/space-station.jpg"},{presetId:"desert-oasis",icon:s.L71,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.desert-oasis",defaults:"Desert Oasis"}),previewUrl:"/image-editing-preset-previews/desert-oasis.jpg"},{presetId:"volcano-lair",icon:s.Q5j,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.volcano-lair",defaults:"Volcano Lair"}),previewUrl:"/image-editing-preset-previews/volcano-lair.jpg"},{presetId:"post-apocalypse",icon:s.A1H,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.post-apocalypse",defaults:"Post-Apocalypse"}),previewUrl:"/image-editing-preset-previews/post-apocalypse.jpg"}]},{category:"subject",icon:s.BDI,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.categories.subject",defaults:"Subject"}),presets:[{presetId:"stylish-hat",icon:s.fbd,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.stylish-hat",defaults:"Stylish Hat"}),previewUrl:"/image-editing-preset-previews/stylish-hat.jpg"},{presetId:"mustache",icon:s.Hx3,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.mustache",defaults:"Mustache"}),previewUrl:"/image-editing-preset-previews/mustache.jpg"},{presetId:"superhero-costume",icon:s.KqI,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.superhero-costume",defaults:"Superhero Costume"}),previewUrl:"/image-editing-preset-previews/superhero-costume.jpg"},{presetId:"golden-glow",icon:s.S7m,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.golden-glow",defaults:"Golden Glow"}),previewUrl:"/image-editing-preset-previews/golden-glow.jpg"},{presetId:"mecha-warrior",icon:s.cC5,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.mecha-warrior",defaults:"Mecha Warrior"}),previewUrl:"/image-editing-preset-previews/mecha-warrior.jpg"},{presetId:"sunglasses-jacket",icon:s.ljW,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.sunglasses-jacket",defaults:"Sunglasses & Jacket"}),previewUrl:"/image-editing-preset-previews/sunglasses-jacket.jpg"},{presetId:"medieval-armor",icon:s.ekZ,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.medieval-armor",defaults:"Medieval Armor"}),previewUrl:"/image-editing-preset-previews/medieval-armor.jpg"},{presetId:"time-traveler",icon:s.zD7,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.time-traveler",defaults:"Time Traveler"}),previewUrl:"/image-editing-preset-previews/time-traveler.jpg"},{presetId:"hologram-effect",icon:s.srL,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.hologram-effect",defaults:"Hologram Effect"}),previewUrl:"/image-editing-preset-previews/hologram-effect.jpg"},{presetId:"dragon-rider",icon:s.Q5j,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.dragon-rider",defaults:"Dragon Rider"}),previewUrl:"/image-editing-preset-previews/dragon-rider.jpg"},{presetId:"remove-people",icon:s.Kr6,label:(0,i.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.remove-people",defaults:"Remove People"}),previewUrl:"/image-editing-preset-previews/remove-people.jpg"}]}]},40016:(e,t,a)=>{a.d(t,{q:()=>m});var i=a(79342),s=a(38614),n=a(72055),r=a(61312),l=a(43893),o=a(33846),d=a(74995),c=a(88382),u=a(65146),p=a(63174);let m=e=>{let{className:t,hasImage:a,inputValue:m,isStreaming:g,onInputValueChange:f,onSend:h,onAbort:v}=e,{t:x}=(0,u.Bd)("base"),b=(0,s.aP)(d.A("lastMessageId")),y=(0,s.aP)(d.A("streamedMessageId")),j=(0,l.A3)(d.A("byId")),w=(0,c.useRef)(null),I=(0,c.useRef)(null),[S,k]=(0,c.useState)(!1),N=(0,c.useMemo)(()=>g||!a,[g,a]),C=(0,c.useMemo)(()=>!S&&!g&&a&&!!m.trim(),[S,a,m,g]),E=(0,c.useCallback)(async e=>{var t;e.preventDefault(),!N&&m.trim()&&(k(!0),await (null==(t=h(m))?void 0:t.finally(()=>{var e;null==(e=I.current)||e.focus(),k(!1)})))},[h,N,m]),P=(0,c.useMemo)(()=>{let e=y?j[y]:void 0;if((null==e?void 0:e.parentResponseId)===b)return e},[y,j,b]),_=(0,c.useMemo)(()=>{if(g)return(null==P?void 0:P.state)||"closed"},[g,P]),A=(0,c.useCallback)(e=>{if(e.stopPropagation(),"Enter"===e.key&&!e.metaKey&&!e.ctrlKey&&!e.shiftKey&&!e.nativeEvent.isComposing){var t;e.preventDefault(),null==(t=w.current)||t.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))}},[]);return(0,i.jsxs)("form",{className:(0,r.cn)("w-full rounded-[32px] p-3 bg-input-background shadow shadow-input-border/10 flex gap-2 pl-5 items-end ring-1 ring-input-border ring-inset",t),onSubmit:E,ref:w,children:[(0,i.jsx)(p.A,{ref:I,className:(0,r.cn)("w-full @[480px]/input:px-3 bg-transparent focus:outline-none text-primary align-bottom resize-none pb-1.5",g&&"animate-pulse"),onChange:e=>f(e.target.value),value:m,placeholder:a?g?x("Editing image","Editing image"):x("Describe your edits","Describe your edits"):x("Upload an image to begin","Upload an image to begin"),minRows:1,onKeyDown:A,autoFocus:!0,disabled:N,name:"query",maxRows:5}),(0,i.jsx)("div",{className:(0,r.cn)("ml-auto flex flex-row items-end gap-1"),children:g&&("streaming"===_||"reconnecting"===_)?(0,i.jsx)(o.P.button,{whileTap:{scale:.95},initial:{scale:.95,opacity:1},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:.5,transition:{duration:.2}},className:(0,r.cn)("group flex flex-col justify-center rounded-full focus:outline-none focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"),onClick:e=>{e.preventDefault(),v().catch(console.error)},children:(0,i.jsx)("div",{className:(0,r.cn)("h-9","aspect-square flex flex-col items-center justify-center rounded-full","rounded-full ring-1 ring-inset","bg-primary text-background ring-button-outline-border"),children:(0,i.jsx)(n.M6A,{size:20})})}):(0,i.jsx)(o.P.button,{initial:{opacity:.5},animate:{opacity:1,transition:{duration:.1}},whileHover:a?{scale:1.1}:void 0,whileTap:a?{scale:.95}:void 0,className:(0,r.cn)("group flex flex-col justify-center rounded-full focus:outline-none focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"),type:"submit","aria-label":x("Submit","Submit"),disabled:!C,children:(0,i.jsx)("div",{className:(0,r.cn)("h-9 relative","aspect-square flex flex-col items-center justify-center","rounded-full ring-1 ring-inset duration-100","before:absolute before:inset-0 before:rounded-full before:bg-primary before:ring-0 before:transition-all duration-500",C?"bg-primary text-background ring-transparent before: before:[clip-path:circle(50%_at_50%_50%)]":"bg-button-secondary text-secondary before:[clip-path:circle(0%_at_50%_50%)] ring-0"),children:(0,i.jsx)(n.Kpk,{size:20,className:"relative"})})})})]})}},76393:(e,t,a)=>{a.d(t,{p:()=>n});var i=a(79342),s=a(61312);let n=e=>{let{value:t,sign:a,prefix:n,suffix:r}=e;return(0,i.jsxs)("span",{className:(0,s.cn)("text-lg","+"===a?"text-teal-300":"text-red-300"),children:[n,!!a&&a,t,r]})}},93220:(e,t,a)=>{a.d(t,{$:()=>l});var i=a(79342),s=a(61312),n=a(72055),r=a(33846);let l=e=>{let{className:t}=e;return(0,i.jsx)(r.P.div,{initial:{opacity:0,filter:"blur(4px)"},animate:{opacity:1,filter:"blur(0px)"},transition:{ease:"easeInOut"},className:(0,s.cn)("h-full w-full flex items-center justify-center animate-pulse-lg",t),children:(0,i.jsx)(n.xfq,{size:60,strokeWidth:1.3,className:"opacity-30 rotate-[-10deg]"})},"loader")}},98117:(e,t,a)=>{a.d(t,{A:()=>tO});var i=a(79342),s=a(81745),n=a(44428),r=a(82591),l=a(10953),o=a(38614),d=a(39489),c=a(23856),u=a(72055),p=a(56691),m=a(30693),g=a(4295),f=a(12220),h=a(17703),v=a(84969),x=a(33846),b=a(88382),y=a(65146),j=a(43086);let w=e=>{let{hasImage:t,prompt:a,onParentPeek:s,focusedImageUrl:n,parentImageUrl:r,isStreaming:l,onRegenerate:d,onClose:w}=e,{t:I}=(0,y.Bd)("base"),[S,k]=(0,b.useState)(!1),[N,C]=(0,b.useState)(void 0),[E,P]=(0,b.useState)(!1),_=(0,g.c)(),A=(0,o.aP)(e=>e.conversationId),M=(0,o.aP)(e=>e.lastMessageId),{editImagePresets:T}=(0,m.F)(),U=(0,b.useMemo)(()=>{if(!N)return;let e=T.flatMap(e=>e.presets).find(e=>e.prompt===N);return e?(0,i.jsxs)(i.Fragment,{children:[e.icon&&b.createElement(e.icon,{size:20,className:"text-secondary flex-shrink-0"}),(0,i.jsx)("h1",{className:"text-lg font-semibold truncate",children:e.label})]}):(0,i.jsx)("h1",{className:"text-lg font-semibold truncate",children:N})},[N,T]),R=(0,b.useCallback)(()=>{!E&&n&&(P(!0),(0,f.G)(n,null==n?void 0:n.split("/").pop()).catch((0,h.HX)("image-editor:handleDownload")).finally(()=>P(!1)))},[n,E]);return(0,b.useEffect)(()=>{a&&N!==a&&C(a)},[a,N]),(0,b.useEffect)(()=>{r&&!S&&k(!0)},[r,S]),(0,i.jsx)("header",{className:"flex justify-between w-full items-center min-h-10 gap-3  relative z-30 flex-shrink-0",children:(0,i.jsxs)(v.N,{mode:"popLayout",children:[N&&(0,i.jsx)(x.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},className:"flex items-center gap-2 w-full overflow-hidden min-w-0",children:U},N),(0,i.jsxs)("div",{className:"flex gap-2 ms-auto shrink-0",children:[(0,i.jsxs)(i.Fragment,{children:[S&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,i.jsx)(p.gx,{size:"iconMd",variant:"ghost",rounded:!0,"aria-label":I("Compare","Compare"),tooltipContent:I("Compare","Compare"),tooltipContentProps:{side:"bottom"},onMouseDown:()=>s(!0),onMouseUp:()=>s(!1),onMouseLeave:()=>s(!1),onTouchStart:e=>{e.preventDefault(),e.stopPropagation(),s(!0)},onTouchEnd:e=>{e.preventDefault(),e.stopPropagation(),s(!1)},onContextMenu:e=>{e.preventDefault(),e.stopPropagation()},onContextMenuCapture:e=>{e.preventDefault(),e.stopPropagation()},asChild:!0,disabled:l||!r,children:(0,i.jsx)(x.P.button,{whileTap:!l&&r?{scale:.9}:void 0,children:(0,i.jsx)(u.Uye,{className:"size-5"})})})},"compare"),(0,i.jsx)(x.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,i.jsx)(p.gx,{size:"iconMd",variant:"ghost",rounded:!0,"aria-label":I("Regenerate","Regenerate"),tooltipContent:I("Regenerate","Regenerate"),tooltipContentProps:{side:"bottom"},asChild:!0,disabled:l||!r,onClick:d,children:(0,i.jsx)(x.P.button,{whileTap:!l&&r?{scale:.9}:void 0,children:(0,i.jsx)(u.V$7,{className:"size-5"})})})},"regenerate")]}),t&&(0,i.jsx)(x.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,i.jsx)(p.gx,{variant:"ghost",size:"iconMd",rounded:!0,"aria-label":I("Download Image","Download Image"),tooltipContent:I("Download Image","Download Image"),tooltipContentProps:{side:"bottom"},disabled:l||!n||E,onClick:R,children:E?(0,i.jsx)(j.y,{size:"xs"}):(0,i.jsx)(u.s3U,{className:"size-5"})})},"download"),A&&M&&(0,i.jsx)(x.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,i.jsx)(c.w,{variant:"ghost",size:"iconMd",rounded:!0,conversationId:A,responseId:M,iconProps:{size:20}})},"share")]}),_?(0,i.jsx)(p.$n,{"aria-label":I("Close Image Editor","Close Image Editor"),variant:"filled",size:"iconMd",rounded:!0,onClick:w,children:(0,i.jsx)(u.uv5,{size:20})}):(0,i.jsx)(p.gx,{"aria-label":I("Close Image Editor","Close Image Editor"),tooltipContent:I("Close Image Editor","Close Image Editor"),tooltipContentProps:{side:"bottom"},variant:"filled",size:"md",rounded:!0,onClick:w,children:I("Close","Close")})]})]})})};var I=a(28951),S=a(61312);let k=e=>{let{images:t,focusedOption:a,isStreaming:s,onSelect:n}=e;return(0,i.jsx)(x.P.aside,{className:"lg:fixed top-0 inset-0 lg:top-0 lg:right-0 lg:left-auto flex lg:flex-col items-center justify-center lg:h-full gap-4 pb-3 lg:p-6 pointer-events-none z-30",variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",children:(0,i.jsx)(v.N,{mode:"popLayout",children:t.map((e,t)=>(0,i.jsx)(x.P.button,{className:(0,S.cn)("size-16 sm:size-20 relative rounded-xl border bg-background p-1 pointer-events-auto",{"ring-primary ring-2":t===a}),onClick:()=>n(t),whileTap:t!==a?{scale:.95}:{},variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",children:(0,i.jsx)("div",{className:"relative h-full w-full overflow-hidden rounded-lg",children:(0,i.jsx)("figure",{className:"absolute -translate-x-1/2 left-1/2 h-full aspect-[4/3]",children:(0,i.jsx)(I.L,{isModerated:e.isModerated,status:s?"streaming":"finished",iconSize:24,intermediateResults:s?e.progressMap:[{progress:1,imageUrl:e.url}]})})})},e.id))})},"image-editor-option-nav")};var N=a(40016),C=a(67153),E=a(75500),P=a(66408),_=a(23232),A=a(24734),M=a(4878),T=a(70888),U=a(59075),R=a(43893),z=a(44347),D=a(72359),O=a(74995),L=a(14908);let K=e=>{let{isEditingCurrentImage:t,setIsPeekingParent:a,isPeekingParent:s,focusedImage:n,parentImageUrl:r,generatedImageHeight:l,generatedImageWidth:o,isFinalImageLoaded:d,setIsFinalImageLoaded:c,isParentImageLoaded:u,setIsParentImageLoaded:p}=e,[m,g]=(0,b.useState)([]),[f,h]=(0,b.useState)(!1),[y,j]=(0,b.useState)(!1),[w,k]=(0,b.useState)(!0),N=(0,b.useMemo)(()=>!!(l&&o),[l,o]),C=(0,b.useMemo)(()=>l&&o?o/l:4/3,[l,o]);return(0,b.useEffect)(()=>{(t||!w)&&(null==n?void 0:n.progressMap)?g(n.progressMap):!t&&(null==n?void 0:n.url)?g(e=>[...e,{progress:1,imageUrl:n.url||""}]):g([])},[t,null==n?void 0:n.url,null==n?void 0:n.progressMap,w]),(0,b.useEffect)(()=>{if(!f)return void a(!1);let e=setTimeout(()=>{f&&!y&&a(!0)},100);return()=>clearTimeout(e)},[f,y,a]),(0,b.useEffect)(()=>{t&&w&&k(!1),t||!d||w||k(!0)},[t,d,w]),(0,i.jsx)("figure",{className:(0,S.cn)("relative group/image w-full max-w-5xl 2xl:max-w-6xl overflow-hidden rounded-lg select-none",!t&&r&&(s?"cursor-grabbing":"cursor-grab")),onDragStart:e=>{if(s)return void e.preventDefault();j(!0)},onDragEnd:()=>{j(!1),h(!1)},onMouseDown:e=>{0===e.button&&h(!0)},onMouseUp:()=>h(!1),onTouchStart:e=>{e.preventDefault(),e.stopPropagation(),h(!0)},onTouchEnd:e=>{e.preventDefault(),h(!1)},onMouseLeave:()=>{h(!1),j(!1)},children:(0,i.jsx)(v.N,{mode:"wait",children:t||!w?N?(0,i.jsx)(x.P.div,{initial:{opacity:0,filter:"blur(4px)"},animate:{opacity:1,filter:"blur(0px)"},exit:{opacity:1,filter:"blur(0px)",transition:{delay:1.5}},transition:{ease:"easeInOut"},className:"h-full mx-auto",style:{aspectRatio:C,maxHeight:l},children:(0,i.jsx)(I.L,{status:"streaming",intermediateResults:m,isModerated:null==n?void 0:n.isModerated,aspectRatio:C})},"streaming-image"):(0,i.jsx)(G,{}):(0,i.jsxs)("div",{className:"flex relative items-center justify-center w-full h-full",children:[(null==n?void 0:n.url)&&(0,i.jsxs)(i.Fragment,{children:[!d&&(0,i.jsx)(G,{className:"absolute z-20 inset-0"}),(0,i.jsx)(x.P.img,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},exit:"hidden",animate:r&&s||!d?"hidden":"visible",transition:{ease:"easeInOut"},src:n.url,alt:"active-image",className:"max-h-full aspect-auto rounded-lg",onLoad:()=>c(!0)},"finished-image")]}),(0,i.jsx)(v.N,{children:!t&&r&&s&&(0,i.jsxs)(x.P.div,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},initial:"hidden",exit:"hidden",animate:"visible",transition:{ease:"easeInOut"},className:"absolute z-10 w-full h-full flex items-center overflow-hidden",children:[!u&&(0,i.jsx)(G,{className:"absolute z-20 inset-0"}),(0,i.jsx)(x.P.img,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},animate:u?"visible":"hidden",src:r,alt:"parent-image",className:"max-h-full aspect-auto mx-auto rounded-lg",onLoad:()=>p(!0)},"parent-image")]},"parent-image-container")})]})})})},G=e=>{let{className:t}=e;return(0,i.jsx)(x.P.div,{initial:{opacity:0,filter:"blur(4px)"},animate:{opacity:1,filter:"blur(0px)"},transition:{ease:"easeInOut"},className:(0,S.cn)("h-full w-full flex items-center justify-center animate-pulse-lg",t),children:(0,i.jsx)(u.xfq,{size:60,strokeWidth:1.3,className:"opacity-30 rotate-[-10deg]"})},"loader")};var B=a(41320),H=a(4423),F=a(43035),W=a(93220),V=a(34500),q=a(73772);let $=e=>{let{hasImage:t,onSend:a,isStreaming:s}=e,{editImagePresets:n}=(0,m.F)(),r=(0,B.Di)(),[l,o]=(0,b.useState)(null),[d,c]=(0,b.useState)(null),u=(0,b.useMemo)(()=>s||!t,[s,t]),g=(0,b.useCallback)(e=>{o(t=>t===e?null:e)},[o]),f=(0,b.useCallback)(e=>{if(!s)return o(null),a(e.prompt,e.presetId)},[s,a]),h=(0,b.useCallback)(e=>{let t=document.querySelector('[data-preset-id="'.concat(e,'"]'));if(!t)return{};let a=t.getBoundingClientRect();return a.right+12+200>window.innerWidth?{left:a.left-200-12,top:a.top+(a.height-150)/2}:{left:a.right+12,top:a.top+(a.height-150)/2}},[]);return(0,b.useEffect)(()=>{if(!l||r)return void c(null);let e=()=>{let e=document.body.querySelector("[data-highlighted][data-preset-id]"),t=(null==e?void 0:e.getAttribute("data-preset-id"))||null;t&&c(t)};e();let t=new MutationObserver(e);return t.observe(document.body,{attributes:!0,attributeFilter:["data-highlighted"],subtree:!0}),()=>{t.disconnect()}},[l,r]),(0,i.jsx)("div",{className:"@container flex w-full xs:justify-center justify-start items-center overflow-x-auto xs:overflow-visible gap-2 xs:gap-3 relative z-30 no-scrollbar",children:n.map((e,t)=>(0,i.jsx)(x.P.div,{variants:{hidden:{opacity:0,y:10},visible:{opacity:1,y:0}},initial:"hidden",animate:"visible",transition:{duration:.15,ease:"easeInOut",delay:.06*t},className:"bg-surface-base rounded-full",children:r?(0,i.jsxs)(V._s,{open:e.category===l,onOpenChange:t=>{t?o(e.category):o(null)},children:[(0,i.jsx)(V.Uz,{disabled:u,asChild:!0,children:(0,i.jsx)(Q,{category:e,disabled:u})}),(0,i.jsxs)(V.zj,{className:"max-h-[90dvh]",children:[(0,i.jsx)(V.BE,{children:(0,i.jsxs)(V.gk,{className:"flex items-center justify-center gap-2",children:[e.icon&&b.createElement(e.icon,{size:20,className:"text-secondary flex-shrink-0"}),e.label]})}),(0,i.jsx)("div",{className:"p-2 space-y-2 overflow-auto",children:e.presets.map(e=>(0,i.jsxs)(p.$n,{variant:"ghost",size:"lg",className:"w-full flex items-center justify-start gap-3 h-auto py-3",onClick:()=>f(e),children:[e.icon&&b.createElement(e.icon,{size:18,className:"text-secondary flex-shrink-0"}),(0,i.jsx)("span",{children:e.label})]},e.presetId))})]})]}):(0,i.jsxs)(q.rI,{open:e.category===l,onOpenChange:()=>g(e.category),children:[(0,i.jsx)(q.ty,{disabled:u,asChild:!0,children:(0,i.jsx)(Q,{category:e,disabled:u})}),(0,i.jsx)(q.SQ,{hideWhenDetached:!0,side:"top",sideOffset:8,className:"min-w-60 space-y-0.5",onMouseLeave:()=>{c(null)},onWheel:e=>e.stopPropagation(),onKeyDown:e=>e.stopPropagation(),children:e.presets.map(t=>(0,i.jsxs)(q._2,{"data-preset-id":t.presetId,className:"flex items-center gap-2",onClick:()=>f(t),children:[t.icon&&b.createElement(t.icon,{size:16,className:"text-secondary flex-shrink-0"}),t.label,d===t.presetId&&(0,F.createPortal)((0,i.jsxs)(x.P.div,{layoutId:"preset-preview",className:"fixed w-[200px] h-[150px] bg-surface-l4 border border-border-l1 rounded-2xl shadow-lg z-50 pointer-events-none flex items-center justify-center p-1.5",style:h(t.presetId),children:[(0,i.jsx)(W.$,{className:"absolute inset-0"}),t.previewUrl&&(0,i.jsx)(H.default,{src:t.previewUrl,alt:t.presetId,width:200,height:150,priority:!r&&l===e.category,className:"w-full h-full object-cover rounded-xl relative z-10"})]}),document.body)]},t.presetId))})]})},e.category))})},Q=b.forwardRef((e,t)=>{let{category:a,disabled:s,...n}=e;return(0,i.jsxs)(p.$n,{ref:t,size:"md",variant:"filledSecondary",rounded:!0,className:(0,S.cn)(!s&&"*:hover:text-primary transition-all"),disabled:s,...n,children:[a.icon&&b.createElement(a.icon,{size:16,className:"flex-shrink-0 text-secondary transition-colors"}),(0,i.jsx)("span",{children:a.label})]})}),X=e=>{let{onUploadImage:t}=e,{t:a}=(0,y.Bd)("base"),s=(0,T.x)(O.A("fetchUploadFile")),n=(0,T.x)(O.A("removeByConversationId")),r=(0,o.aP)(O.A("conversationId")),{ASSET_SERVER_URL:l}=(0,d.v)(),c=(0,A.K)(),m=(0,b.useRef)(null),[g,f]=(0,b.useState)(!1),[h,w]=(0,b.useState)(!1),I=(0,b.useCallback)(()=>{var e;null==(e=m.current)||e.click()},[]),S=(0,b.useCallback)(async e=>{let i;if(1!==e.length)return void L.oR.error(a("Only a single image file is allowed","Only a single image file is allowed"));if(!["image/png","image/jpeg","image/jpg","image/webp"].includes(e[0].type))return void L.oR.error(a("Only image files are allowed","Only image files are allowed"));w(!0);try{let t=s(e[0],r||"no_conversation_id");i=await t.metadataPromise}catch(e){c("image-editor-upload:uploadFile",e)}i instanceof Error&&c("image-editor-upload:uploadFile",i,a("Failed to upload file","Failed to upload file")),w(!1),n(r||"no_conversation_id"),!i||i instanceof Error||t({url:(0,M.sU)(l,i.fileUri),metadata:i})},[a,s,r,t,l,n,c]),k=(0,b.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),h||f(!0)},[h]),N=(0,b.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),f(!1)},[]),C=(0,b.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),f(!1),!h)return S(Array.from(e.dataTransfer.files))},[S,h]),E=(0,b.useCallback)(e=>{if(e.target.files)return S(Array.from(e.target.files)).finally(()=>{m.current&&(m.current.value="")})},[S]);return(0,i.jsx)(x.P.div,{initial:{opacity:0},animate:{opacity:1},onDragOver:k,onDragLeave:N,onDrop:C,className:"border resize transition-colors w-full max-w-7xl h-full flex justify-center items-center border-border-l1 rounded-2xl p-8 mb-3 text-center ".concat(g&&!h&&"bg-surface-l1 border-border-l1"),children:(0,i.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,i.jsx)("div",{className:"p-4 rounded-full text-fg-secondary transition-colors bg-surface-l1",children:(0,i.jsx)(v.N,{mode:"popLayout",children:g&&!h?(0,i.jsx)(x.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,i.jsx)(u.sv7,{className:"size-6"})},"files"):(0,i.jsx)(x.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,i.jsx)(u.XGR,{className:"size-6"})},"image-plus")})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-medium text-primary",children:a("Upload an image to begin","Upload an image to begin")}),(0,i.jsx)(v.N,{mode:"popLayout",children:h?(0,i.jsx)(x.P.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary",children:a("Uploading image","Uploading image")},"uploading"):g?(0,i.jsx)(x.P.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary",children:a("Drop image here","Drop image here")},"dragging"):(0,i.jsx)(x.P.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary",children:a("Drag and drop to upload","Drag and drop to upload")},"not-dragging")})]}),(0,i.jsx)("div",{className:"flex gap-3",children:(0,i.jsxs)(p.$n,{variant:"outline",className:"text-fg-primary hover:bg-button-ghost-hover rounded-2xl transition-all py-2.5 px-4 h-auto *:hover:text-fg-primary *:hover:transition-colors",disabled:h,autoFocus:!0,onClick:I,children:[h?(0,i.jsx)(j.y,{size:"xxs"}):(0,i.jsx)(u._OO,{className:"size-4 text-fg-secondary"}),a("Upload","Upload")]})}),(0,i.jsx)("input",{ref:m,className:"hidden",type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:E,multiple:!1,"data-testid":"file-input"})]})})};var Y=a(15041);let J=()=>{let{ASSET_SERVER_URL:e}=(0,d.v)(),t=(0,E.h)(),a=(0,_._)(),{t:s}=(0,y.Bd)("base"),n=(0,C.L)();(0,A.K)();let{handleSendStart:r,timeToSendStart:l,consumeTimeToSendMs:c}=(0,P.Q)(),[u,p]=(0,D.Mj)("image-editor-first-open",!0),m=(0,U.j)(O.A("isOpen")),g=(0,U.j)(O.A("currentImage")),f=(0,U.j)(O.A("setImage")),x=(0,o.aP)(O.A("conversationId")),j=(0,o.aP)(O.A("streamedMessageId")),I=(0,o.aP)(O.A("lastMessageId")),S=(0,R.A3)(e=>e.byId[null!=j?j:""]),G=(0,R.A3)(O.A("byId")),B=(0,b.useMemo)(()=>{var e;return null!=(e=R.A3.getState().byConversationId[null!=x?x:""])?e:[]},[x]),[H,F]=(0,b.useState)(""),[W,V]=(0,b.useState)(!1),[q,Q]=(0,b.useState)(null),[J,Z]=(0,b.useState)(!1),[ee,et]=(0,b.useState)(!1),[ea,ei]=(0,b.useState)(!1),[es,en]=(0,b.useState)(!1),[er,el]=(0,b.useState)(!1),eo=(0,b.useMemo)(()=>!!g,[g]),ed=(0,b.useMemo)(()=>!!(g&&"key"in g),[g]),ec=(0,b.useMemo)(()=>!!(g&&"metadata"in g),[g]),eu=(0,b.useMemo)(()=>{if(ed){if(W)return!q&&S&&Q(S.responseId),S||G[null!=q?q:""];let e=B.filter(e=>e.streamingImageById).find(e=>{for(let t in e.streamingImageById){let a=e.streamingImageById[t][100];if((null==a?void 0:a.imageUrl)===(null==g?void 0:g.url))return!0}});return e||(null==B?void 0:B.find(e=>{var t,a;return null==(t=e.generatedImageUrls)?void 0:t.includes(null!=(a=g.assetKey)?a:"")}))}},[g,B,ed,W,S,q,G]),ep=(0,b.useMemo)(()=>(null==eu?void 0:eu.parentResponseId)?G[eu.parentResponseId]:void 0,[eu,G]),em=(0,b.useMemo)(()=>ep?(0,M.sU)(e,ep.imageEditUri):void 0,[ep,e]),eg=(0,b.useMemo)(()=>{if(ec){var t,a;return[{id:null!=(t=g.metadata.fileUri)?t:"",url:null!=(a=(0,M.sU)(e,g.metadata.fileUri))?a:"",isModerated:!1,progressMap:void 0}]}return ed?eu?W&&eu.streamingImageById?Object.entries(eu.streamingImageById).map(t=>{var a;let[i,s]=t,n=Object.keys(s).map(Number),r=s[Math.max(...n)];return{id:i,url:null!=(a=(0,M.sU)(e,r.imageUrl))?a:"",isModerated:!1,progressMap:n.map(t=>{var a;return{progress:t/100,imageUrl:null!=(a=(0,M.sU)(e,s[t].imageUrl))?a:""}})}}):eu.generatedImageUrls.map(t=>{var a,i,s;let n=null!=(i=Object.values(null!=(a=eu.streamingImageById)?a:{})[0])?i:{},r=Object.keys(n).map(Number);return{id:t,url:null!=(s=(0,M.sU)(e,t))?s:"",isModerated:!1,progressMap:r.length>0?r.map(t=>{var a;return{progress:t/100,imageUrl:null!=(a=(0,M.sU)(e,n[t].imageUrl))?a:""}}):void 0}}):[]:[]},[g,eu,ed,W,e,ec]),ef=(0,b.useMemo)(()=>eg.length>1?eg.find(e=>e.id===(null==g?void 0:g.key)||e.id===(null==g?void 0:g.assetKey)):eg[0],[eg,g]),eh=(0,b.useMemo)(()=>(0,i.jsx)(K,{isEditingCurrentImage:W,focusedImage:ef,parentImageUrl:es?void 0:em,isPeekingParent:J,setIsPeekingParent:Z,generatedImageWidth:null==eu?void 0:eu.generatedImageWidth,generatedImageHeight:null==eu?void 0:eu.generatedImageHeight,isParentImageLoaded:ea,isFinalImageLoaded:er,setIsFinalImageLoaded:el,setIsParentImageLoaded:ei}),[W,ef,J,em,null==eu?void 0:eu.generatedImageWidth,null==eu?void 0:eu.generatedImageHeight,ea,er,es]),ev=(0,b.useCallback)(e=>{e&&f(e)},[f]),ex=(0,b.useCallback)(e=>{let t=eg[e];W&&f({key:t.id}),f({key:t.id,assetKey:t.id,url:t.url,isModerated:t.isModerated,progress:(null==t?void 0:t.progressMap)?Math.max(...Object.keys(t.progressMap).map(Number)):1})},[eg,W,f]),eb=(0,b.useCallback)(async e=>(et(!0),e().finally(()=>{et(!1)})),[]),ey=(0,Y.m)("image-workbench:handleAbort",eb),ej=(0,b.useCallback)(async(e,a)=>{if(!e.trim()||!(null==g?void 0:g.url))throw Error("No message or image");let i=o.aP.getState(),s=z.C$.getState(),r=R.A3.getState(),l=T.x.getState(),d=a.replace(/^https?:\/\/[^/]+\/?/,"");F(""),l.removeByConversationId(i.conversationId||"no_conversation_id"),l.removeAttachByConversationId(i.conversationId||"no_conversation_id"),await n();let c=i.lastMessageId?r.byId[i.lastMessageId]:void 0;if(i.lastMessageId&&!c)throw Error("Last message is missing");if((null==c?void 0:c.sender)==="human")throw Error("Last message is human");"none"!==i.reasoningMode&&i.setReasoningMode("none");let u={message:e,toolOverrides:{imageGen:!0},imageEditUri:d,enableRetries:t.ENABLE_AUTO_STREAM_RETRY},p=ec&&g.metadata.fileMetadataId&&!(null==ep?void 0:ep.message)?[g.metadata.fileMetadataId]:[];if(ec)return i.conversationId?i.sendResponse({...u,parentResponseId:i.lastMessageId,conversationId:i.conversationId,fileAttachmentIds:p,webpageUrls:[],setOpimisticUserResponse:!0,setUserResponse:!0,ff:t}):i.establishNewConversation({...u,fileAttachmentIds:[g.metadata.fileMetadataId],temporary:s.isIncognito,ff:t});if(!i.conversationId)throw Error("No conversation id");return i.sendResponse({...u,parentResponseId:i.lastMessageId,conversationId:i.conversationId,fileAttachmentIds:p,webpageUrls:[],setOpimisticUserResponse:!0,setUserResponse:!0,ff:t})},[g,n,ec,ep,t]),ew=(0,b.useCallback)(async(e,t)=>{let a=o.aP.getState(),i=R.A3.getState(),s=a.streamedMessageId?i.byId[a.streamedMessageId]:void 0;return["streaming","optimistic","reconnecting"].includes((null==s?void 0:s.state)||"closed")&&await ey(),V(!0),ej(e,t).catch(()=>{U.j.getState().close()})},[ej,ey]),eI=(0,b.useCallback)(async(e,t)=>{if(e.trim()&&(null==ef?void 0:ef.url))return a("edit_image_start",(0,P.r)(ef.url),{queryType:t?"preset":"manual",location:"image-editor",presetId:t||"",message:e,messageLength:String(e.length),timeToSendMs:String(c())}),ew(e,ef.url).catch(e=>{(0,h.vV)("image-viewer:ImageEditor:handleEditCurrentImage",e)})},[ew,ef,a,c]),eS=(0,b.useCallback)(()=>{if((null==ep?void 0:ep.message)&&em)return a("edit_image_start",(0,P.r)(em),{queryType:"regenerate",location:"image-editor",presetId:"",message:null==ep?void 0:ep.message,messageLength:String(null==ep?void 0:ep.message),timeToSendMs:String(c())}),ew(ep.message,em).catch(e=>{(0,h.vV)("image-viewer:ImageEditor:handleRegenerate",e)})},[ep,em,ew,a,c]);(0,b.useEffect)(()=>{W&&eg.length&&!eg.find(e=>e.id===g.key)&&f({key:eg[0].id})},[eg,W,g,f]),(0,b.useEffect)(()=>{let t=U.j.getState();if(W&&S&&"error"===S.state)return t.close();if(W&&q&&S&&"closed"===S.state){var i,s,n,r;if(V(!1),Q(null),!I)return t.close();let l=G[I];if(!l)return t.close();let o=null==(n=l.streamingImageById)||null==(s=n[null!=(r=null==g?void 0:g.key)?r:""])||null==(i=s[100])?void 0:i.imageUrl;if(!o)return t.close();a("edit_image_end",(0,P.r)((null==ep?void 0:ep.imageEditUri)||""),{location:"image-editor"}),f({key:o,assetKey:o,url:(0,M.sU)(e,o),progress:100,isModerated:!1})}},[ep,S,W,q,I,G,e,a,f]),(0,b.useEffect)(()=>{W||ee||void 0!==l||r()},[c,r,W,ee,l]),(0,b.useEffect)(()=>{if(null==ef?void 0:ef.url){el(!1);let e=new Image;e.onload=()=>el(!0),e.src=ef.url}},[null==ef?void 0:ef.url]),(0,b.useEffect)(()=>{if(em){ei(!1),en(!1);let e=new Image;e.onload=()=>ei(!0),e.onerror=()=>en(!0),e.src=em}},[em]),(0,b.useEffect)(()=>{u&&m&&(p(!1),L.oR.message((0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-fg-primary font-bold",children:s("image-editor-welcome.title","Welcome to Image Editor")}),(0,i.jsx)("p",{className:"text-fg-secondary",children:s("image-editor-welcome.description","A focused space for you to transform images with Grok to anything you can imagine.")})]}),{duration:7e3}))},[u,m,p,s]);let ek=(0,U.j)(O.A("close"));return(0,i.jsxs)("div",{className:"flex flex-col items-center justify-between gap-6 sm:gap-20 w-full h-full",children:[(0,i.jsx)(w,{hasImage:eo,prompt:em?null==ep?void 0:ep.message:void 0,focusedImageUrl:null==ef?void 0:ef.url,parentImageUrl:es?void 0:em,isStreaming:W||ee,onParentPeek:e=>Z(e),onClose:ek,onRegenerate:eS}),eo?eh:m&&(0,i.jsx)(X,{onUploadImage:ev}),(0,i.jsx)("footer",{className:"relative w-full max-w-2xl h-16 flex-shrink-0 mt-12 sm:mt-0",children:(0,i.jsxs)("div",{className:"absolute bottom-0 inset-x-0 flex flex-col gap-4",children:[(0,i.jsx)(v.N,{mode:"popLayout",children:eo&&eg&&eg.length>1&&(0,i.jsx)(k,{isStreaming:W||ee,images:eg,focusedOption:eg.findIndex(e=>e.id===(null==ef?void 0:ef.id))||0,onSelect:ex})}),(0,i.jsx)($,{hasImage:eo,isStreaming:W||ee,onSend:eI}),(0,i.jsx)(N.q,{hasImage:eo,inputValue:H,isStreaming:W||ee,onInputValueChange:F,onSend:eI,onAbort:ey})]})})]})};var Z=a(13103),ee=a(53592),et=a(84852);let ea=()=>{let{t:e}=(0,y.Bd)("base"),t=(0,_._)(),a=(0,U.j)(O.A("isOpen")),s=(0,U.j)(O.A("close")),n=(0,o.aP)(O.A("conversationId")),[r,l]=(0,b.useState)(void 0),{handleEditorOpen:d,consumeEditorTimeMs:c,editorOpenTime:u}=(0,P.Q)();return(0,b.useEffect)(()=>{a&&void 0===u?d():a||void 0===u||t("image_editor_close",void 0,{timeInEditorMs:String(c()),location:"image-editor-dialog"})},[a,d,c,t,u]),(0,b.useEffect)(()=>{n!==r&&(r&&s(),l(n))},[n,s,r]),(0,i.jsx)(ee.lG,{open:a,onOpenChange:e=>{e||s()},children:(0,i.jsxs)(Z.ZJ,{children:[(0,i.jsx)(ee.LC,{className:"fixed inset-0 z-50 bg-overlay duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0"}),(0,i.jsxs)(ee.Cf,{"aria-describedby":e("image-editor.title","Image editor"),className:(0,S.cn)("fixed z-50 inset-0 bg-background duration-200 focus:outline-none","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 p-2 lg:p-6"),onCloseAutoFocus:e=>{e.preventDefault(),document.body.style.pointerEvents=""},children:[(0,i.jsx)(et.s,{children:(0,i.jsx)(Z.L3,{children:e("image-editor.title","Image editor")})}),(0,i.jsx)(J,{})]})]})})};var ei=a(55881),es=a(49972),en=a(41739),er=a(68332);let el=e=>{let t=(0,b.useRef)(null);return(0,b.useEffect)(()=>{let a=a=>{t.current&&!t.current.contains(a.target)&&e()};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[e]),t};var eo=a(86035),ed=a(86067),ec=a(62903),eu=a(38541),ep=a.n(eu),em=a(2376),eg=a(35181),ef=a(18585),eh=a(80226);let ev=(0,b.forwardRef)((e,t)=>{let{onSelect:a,tab:s,onRemove:n,isEditing:r,newTitle:l,onNewTitleChange:o,onEditStart:d,onEditSave:c,onEditCancel:m,isActive:g=!1,isDragging:f=!1,isStreaming:h=!1,isLoading:v=!1,isReconnecting:x=!1,showActions:j,className:w,...I}=e,{t:k}=(0,y.Bd)("base"),N=(0,es.w)(O.A("fetchGetConversation")),C=(0,eg.v)(N(s.conversationId));(0,b.useEffect)(()=>{if(C.data&&(C.data.temporary!==s.isTemporary||C.data.title!==s.title)){let{upsertConversationAsTab:e}=en.a.getState();e(C.data,s.conversationId)}},[C.data,s]);let E=(0,b.useCallback)(e=>{("keydown"!==e.type||"Enter"===e.key)&&(f||(e.preventDefault(),a(s.conversationId)))},[s.conversationId,a,f]),P=(0,b.useCallback)(e=>{e.stopPropagation(),n(s.conversationId)},[s.conversationId,n]),_=(0,b.useCallback)(e=>{e.stopPropagation(),("click"===e.type||e instanceof KeyboardEvent&&"Enter"===e.key)&&d(s.conversationId)},[d,s.conversationId]),A=(0,b.useCallback)(e=>{e.stopPropagation(),("click"===e.type||e instanceof KeyboardEvent&&"Enter"===e.key)&&c(s.conversationId)},[c,s.conversationId]),M=(0,b.useCallback)(e=>{o(e.target.value)},[o]),T=(0,b.useCallback)(e=>{e.stopPropagation(),"Enter"===e.key?c(s.conversationId):"Escape"===e.key&&m()},[m,c,s.conversationId]),U=(0,b.useMemo)(()=>{var e;if(s.isTemporary)return k("Temporary Chat","Temporary Chat");if(s.title)return s.title;if(null==(e=C.data)?void 0:e.createTime){let e=new Date(C.data.createTime);return"".concat(k("Chat on","Chat on")," ").concat(e.toLocaleDateString())}return k("Untitled Chat","Untitled Chat")},[k,s,C.data]);return v?(0,i.jsx)(eh.E,{className:"w-full h-10 my-1 rounded-2xl"}):(0,i.jsxs)("div",{...I,ref:t,className:(0,S.cn)("group pl-3 pr-1 py-1 text-sm hover:bg-button-ghost-hover w-full h-10 flex items-center rounded-2xl border gap-1.5","focus:outline-none focus-visible:ring-1 ring-ring ring-inset",g?"bg-button-ghost-hover text-fg-primary border-border-l1":"text-fg-secondary border-transparent",w),onClick:E,onKeyDown:E,tabIndex:0,role:"button",children:[r?(0,i.jsx)("input",{className:"w-full bg-transparent focus-visible:outline-none",value:l,onKeyDown:T,onChange:M,autoFocus:!0}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ex,{isStreaming:h,isReconnecting:x,conversation:C.data}),(0,i.jsx)("span",{className:(0,S.cn)("flex-1 select-none text-nowrap max-w-full overflow-hidden inline-block",!s.isPreserved&&"italic"),style:{maskImage:"linear-gradient(to right, black 85%, transparent 100%)",WebkitMaskImage:"linear-gradient(to right, black 85%, transparent 100%)"},children:U})]}),r?(0,i.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[(0,i.jsx)(p.gx,{variant:"ghost",size:"iconSm",rounded:!0,onClick:e=>{e.stopPropagation(),m()},tooltipContent:k("Cancel","Cancel"),tooltipContentProps:{hideWhenDetached:!0},children:(0,i.jsx)(u.uv5,{size:16,className:"text-fg-primary"})}),(0,i.jsx)(p.gx,{variant:"ghost",size:"iconSm",rounded:!0,onClick:A,tooltipContent:k("Save","Save"),tooltipContentProps:{hideWhenDetached:!0},children:(0,i.jsx)(u.Srz,{size:16,className:"text-fg-primary"})})]}):(0,i.jsxs)("div",{className:"flex items-center justify-end",children:[!s.isTemporary&&!f&&(0,i.jsx)(p.gx,{tabIndex:-1,className:(0,S.cn)("hidden group-hover:flex group-focus-visible:flex text-fg-secondary",j&&"flex"),onClick:_,variant:"ghost",size:"iconSm",rounded:!0,tooltipContent:k("Rename","Rename"),tooltipContentProps:{hideWhenDetached:!0},children:(0,i.jsx)(u.rZj,{})}),!f&&(0,i.jsx)(p.gx,{className:(0,S.cn)("hidden group-hover:flex group-focus-visible:flex text-fg-secondary",j&&"flex"),onClick:P,variant:"ghost",size:"iconSm",rounded:!0,tooltipContent:k("Close","Close"),tooltipContentProps:{hideWhenDetached:!0},children:(0,i.jsx)(u.uv5,{})})]})]})}),ex=e=>{let{conversation:t}=e,{personaById:a}=(0,em.v5)(),s=(0,b.useMemo)(()=>{if(!(null==t?void 0:t.personaId)||!(0,em.sS)(t.personaId))return;let e=a[t.personaId];if(e)return{...e,...(0,ef.e8)(e.personaId)}},[null==t?void 0:t.personaId,a]);return(null==t?void 0:t.temporary)?(0,i.jsx)(u.fz0,{className:"h-4 w-4"}):s&&(0,i.jsx)("span",{className:(0,S.cn)("[&>svg]:h-4 [&>svg]:w-4",s.colorClassName),children:s.icon})};var eb=a(85703);function ey(e){let{id:t,element:a,children:s,options:n,isDragging:r,disabled:l=!1}=e,{attributes:o,listeners:d,setNodeRef:c,transform:u,transition:p}=(0,ec.gl)({id:t,transition:{duration:150,easing:"cubic-bezier(0.25, 1, 0.5, 1)"},disabled:l,...n}),m={transform:eb.Ks.Transform.toString(u),transition:p,opacity:+!r};return(0,i.jsx)(a||"div",{ref:c,...d,...o,style:m,children:s})}let ej=()=>{let{routeToConversation:e}=(0,er.o)(),t=(0,_._)(),a=(0,A.K)(),s=(0,en.a)(O.A("drawerOpen")),n=(0,en.a)(O.A("menuFixed")),r=(0,en.a)(O.A("menuHidden")),l=(0,en.a)(O.A("tabByConversationId")),d=(0,en.a)(O.A("inEditId")),c=(0,o.aP)(O.A("conversationId")),[m,f]=(0,b.useState)(),[v,j]=(0,b.useState)(""),[w,I]=(0,b.useState)(!1);!function(){let e=(0,o.aP)(O.A("conversationId"));(0,b.useEffect)(()=>{if(e){let{upsertConversationAsTab:t,tabByConversationId:a}=en.a.getState(),{fetchGetConversation:i}=es.w.getState();a[e]||i(e).then(e=>{t(e,void 0,!1)}).catch((0,h.HX)("use-observe-conversation-id:fetchGetConversation"))}},[e])}();let k=(0,g.c)(),{t:N}=(0,y.Bd)("base"),C=(0,b.useMemo)(()=>Object.values(l).sort((e,t)=>e.index-t.index),[l]),E=(0,b.useCallback)(a=>{let i=l[a];if(a===c){if(!i)return;if(0===i.index){let t=C[i.index+1];t?e(t.conversationId,i.isTemporary):e(void 0)}else{let t=C[i.index-1];t?e(t.conversationId,i.isTemporary):e(void 0)}}let{removeTab:s}=en.a.getState();s(a),t("close_tab",a,{location:"tabs-manager"})},[c,e,C,t,l]),P=(0,b.useCallback)(e=>{let t=l[e];if(!t)return;let{setInEditId:a}=en.a.getState();a(t.conversationId),j(t.title)},[l]),M=(0,b.useCallback)(async e=>{if(d!==e)return;let i=v.trim();if(""===i)return;let{setInEditId:s}=en.a.getState();try{let{fetchUpdateConversation:a}=es.w.getState();await a(e,{title:i}),s(void 0),t("update_conversation",e,{location:"tabs-manager"})}catch(e){a("tabs-manager:handleEditSave",e)}},[d,v,t,a]),T=el(()=>{d&&U()}),U=(0,b.useCallback)(()=>{let{setInEditId:e}=en.a.getState();e(void 0),j("")},[]),R=(0,eo.MS)(eo.cA,{activationConstraint:{distance:8}}),z=(0,eo.FR)(R),D=(0,b.useCallback)(e=>{let{setInEditId:t}=en.a.getState();f(e.active.id),t(void 0)},[]),L=(0,b.useCallback)(e=>{let{appendTabByConversationId:a}=en.a.getState(),{active:i,over:s}=e,n=null==i?void 0:i.id,r=null==s?void 0:s.id;if(n&&r&&n!==r){let e=C.findIndex(e=>e.conversationId===n),t=C.findIndex(e=>e.conversationId===r);if(-1===e||-1===t)return;a((0,ec.be)(C,e,t).map((e,t)=>({...e,index:t})))}f(void 0),t("reorder_tab","",{location:"tabs-manager:handleDragEnd"})},[C,t]),K=(0,b.useCallback)(()=>{f(void 0)},[]),G=(0,b.useCallback)(()=>{let{setMenuHidden:e,toggleMenuFixed:t,menuFixed:a}=en.a.getState();t(),e(!a)},[]),B=(0,b.useCallback)(e=>{let{setMenuHidden:t,setInEditId:a}=en.a.getState();e.clientX>24&&t(!0),a(void 0)},[]),H=(0,b.useCallback)(e=>{let{setMenuHidden:t}=en.a.getState();e.clientX<64&&t(!1)},[]),F=(0,b.useCallback)(()=>{let{setDrawerOpen:e}=en.a.getState();e(!1)},[]),W=(0,b.useCallback)(()=>{let{setTabByConversationId:e,tabByConversationId:a,setDrawerOpen:i}=en.a.getState();e(c?ep().pick(a,c):{}),I(!1),i(!1),t("clear_all_tabs","",{location:"tabs-manager:handleClearAll"})},[c,t]),q=(0,b.useMemo)(()=>{if(!m)return;let{tabByConversationId:e}=en.a.getState();return e[m]},[m]),$=(0,b.useCallback)(a=>{let{setDrawerOpen:i,inEditId:s,upsertTab:n}=en.a.getState();if(a===s)return;U(),i(!1);let r=l[a];r&&(r.isPreserved||n({...r,isPreserved:!0}),e(r.conversationId,r.isTemporary),t("select_conversation",r.conversationId,{location:"tabs-manager"}))},[U,e,t,l]),Q=(0,b.useMemo)(()=>C.map(e=>e.conversationId),[C]),X=(0,b.useMemo)(()=>{let{tabByConversationId:e}=en.a.getState();return Object.values(e).length},[]);return k&&X>0?(0,i.jsx)(V._s,{open:s,onClose:F,dismissible:!0,children:(0,i.jsxs)(V.zj,{className:"bg-surface-base px-2 max-h-[90vh] focus:outline-none",children:[(0,i.jsxs)(V.BE,{className:"px-2 w-full pb-0 flex items-center h-8 gap-1",children:[(0,i.jsx)(V.gk,{className:"text-primary flex-1 whitespace-nowrap text-sm font-medium truncate text-left",children:N("active-tabs.label",{count:X,defaultValue_one:"Tab",defaultValue_other:"Tabs"})}),(0,i.jsx)("div",{className:"h-5 min-w-5 p-1 bg-surface-l1 text-xs flex items-center justify-center border border-border-l2 rounded-lg ms-1.5",children:X}),X>1&&(0,i.jsx)(p.$n,{className:(0,S.cn)("text-fg-secondary h-6 inline-block w-fit transition-[max-width] duration-200 ease-in-out overflow-hidden px-2",w?"opacity-100 max-w-full":"opacity-70 hover:opacity-100 max-w-6"),onClick:W,variant:"ghost",size:"iconSm",children:(0,i.jsx)(x.P.span,{variants:ew,initial:"initial",animate:"animate",exit:"exit",transition:{duration:.2},className:"flex items-center justify-center whitespace-nowrap",children:w?(0,i.jsx)("span",{className:"text-xs font-medium",children:N("clear-tabs-button.label","Clear")}):(0,i.jsx)(u.uv5,{className:"w-4 h-4"})},w?"clear":"xicon")})]}),(0,i.jsx)("div",{className:(0,S.cn)("flex flex-col z-[200] h-full w-full gap-1 py-4 min-h-[50dvh] overflow-y-auto","mask-image:linear-gradient(to_bottom,transparent_0%,black_16px,black_calc(100%-16px),transparent_100%)","-webkit-mask-image:linear-gradient(to_bottom,transparent_0%,black_16px,black_calc(100%-16px),transparent_100%)"),children:C.map(e=>(0,i.jsx)(ev,{showActions:!0,className:"py-3 rounded-xl",isLoading:!1,isEditing:d===e.conversationId,newTitle:v,onNewTitleChange:j,onEditStart:P,onRemove:E,onEditSave:M,onEditCancel:U,tab:e,onSelect:$,isActive:c===e.conversationId,isDragging:e.conversationId===m},e.conversationId))})]})}):!k&&X>0?(0,i.jsxs)("div",{ref:T,className:(0,S.cn)("group/menu mx-1 flex flex-col absolute top-16 left-0","max-h-[calc(100dvh-80px)] h-full px-2 py-1 pb-2","z-[200]","border border-border-l1","w-52 @[1440px]/mainview:w-64","bg-surface-l3 shadow-md rounded-3xl","transition-all duration-200 ease-in-out",r?"-translate-x-[220px] @[1440px]/mainview:-translate-x-[268px] px-2 pb-2":"translate-x-0 ",n&&"@7xl/mainview:!translate-x-0 @7xl/mainview:shadow-none @7xl/mainview:bg-surface-base @7xl/mainview:border-0 @7xl/mainview:p-0"),onMouseEnter:H,onMouseLeave:B,children:[(0,i.jsx)("div",{onMouseEnter:H,className:"h-full absolute -right-6 w-6 @4xl/mainview:-right-9 @4xl/mainview:w-9"}),(0,i.jsxs)(eo.Mp,{sensors:z,collisionDetection:eo.fp,onDragStart:D,onDragEnd:L,onDragCancel:K,modifiers:[ed.gj],children:[(0,i.jsx)(ec.gB,{items:Q,strategy:ec._G,children:(0,i.jsx)("div",{className:(0,S.cn)("flex flex-col gap-1 h-full overflow-y-auto py-1","mask-image:linear-gradient(to_bottom,transparent_0%,black_4px,black_calc(100%-4px),transparent_100%)","-webkit-mask-image:linear-gradient(to_bottom,transparent_0%,black_4px,black_calc(100%-4px),transparent_100%)"),children:C.map(e=>(0,i.jsx)(ey,{disabled:d===e.conversationId,id:e.conversationId,isDragging:e.conversationId===m,children:(0,i.jsx)(ev,{isEditing:d===e.conversationId,isLoading:!1,newTitle:v,onNewTitleChange:j,onEditStart:P,onRemove:E,onEditSave:M,onEditCancel:U,tab:e,onSelect:$,isActive:c===e.conversationId,isDragging:e.conversationId===m})},e.conversationId))})}),(0,i.jsx)(eo.Hd,{children:q?(0,i.jsx)(e=>{let{tab:t,isMobile:a}=e;return(0,i.jsx)(ev,{onRemove:E,isEditing:d===t.conversationId,newTitle:v,onNewTitleChange:j,onEditStart:P,onEditSave:M,onEditCancel:U,tab:t,onSelect:$,isActive:c===t.conversationId,isDragging:!0,showActions:a,className:(0,S.cn)(a?"py-3 rounded-xl":"","!bg-surface-l3 !text-fg-primary shadow-sm !opacity-100 absolute -translate-y-16 cursor-move z-[100]")},t.conversationId)},{tab:q,isMobile:!1}):null})]}),(0,i.jsxs)("div",{className:" flex items-center group w-full justify-between py-1 h-8 rounded-xl transition-colors focus:outline-none focus-visible:ring-1 ring-ring ring-inset max-w-full",children:[(0,i.jsx)(p.$n,{onClick:W,variant:"ghostSecondary",rounded:!0,size:"sm",className:"opacity-50 group-hover/menu:opacity-100 transition-opacity",children:(0,i.jsx)("span",{className:"text-xs font-medium",children:N("clear-tabs-button.label","Clear")})}),(0,i.jsx)(p.$n,{onClick:G,variant:"ghostSecondary",size:"iconSm",rounded:!0,"aria-label":n?N("toggle-tabs-visibility.close","Hide tabs"):N("toggle-tabs-visibility.lock","Lock tabs"),className:(0,S.cn)("hidden @4xl/mainview:flex opacity-50 group-hover/menu:opacity-100 transition-opacity"),children:(0,i.jsx)(u.O_5,{className:(0,S.cn)("h-4 w-4 transition-transform text-fg-secondary",n?"rotate-0":"rotate-180")})})]})]}):null},ew={initial:{opacity:0,translateX:-1},animate:{opacity:1,translateX:0},exit:{opacity:0,translateX:-1}};var eI=a(48795),eS=a(95739),ek=a(46748),eN=a(89482),eC=a(84499),eE=a(39116),eP=a(60575),e_=a(10084),eA=a(5790),eM=a(13504),eT=a(5663),eU=a(33231),eR=a(26067),ez=a(82767),eD=a(65912),eO=a(98100),eL=a(24429),eK=a(27636),eG=a(44845),eB=a(6132);let eH=eB.z.enum(["deepsearch","brainstorm","analyzeData","createImage","code","search","createReport","finance"]),eF=eB.z.object({type:eB.z.literal("stockMiniSummary"),summary:eB.z.object({ticker:eB.z.string(),name:eB.z.string(),value:eB.z.number(),change:eB.z.number(),changePercent:eB.z.number(),unit:eB.z.string()})}),eW=eB.z.discriminatedUnion("type",[eF]),eV=eB.z.object({prefix:eB.z.string().optional(),prompt:eB.z.string().optional(),label:eB.z.string(),type:eH,icon:eB.z.string().optional(),payload:eW.optional()}),eq=eB.z.object({label:eB.z.string(),prompt:eB.z.string().optional(),type:eH,img:eB.z.string().optional(),description:eB.z.string().optional(),prefix:eB.z.string().optional(),payload:eW.optional()}),e$=["en"],eQ=[{type:"createImage",prefix:"Draw ",label:"Create Images"},{type:"deepsearch",prefix:"Research ",label:"Research"},{type:"brainstorm",prefix:"How ",label:"How to"},{type:"analyzeData",prefix:"Help me ",label:"Analyze"},{type:"code",prefix:"Help me ",label:"Code"}],eX={deepsearch:"deepsearch",brainstorm:"think",analyzeData:"think",createImage:"none",code:"none",search:"none",createReport:"none",finance:"none"},eY={deepsearch:{},createReport:{},brainstorm:{webSearch:!0,xSearch:!0,xMediaSearch:!0,trendsSearch:!0,xPostAnalyze:!0},analyzeData:{},createImage:{imageGen:!0},code:{},search:{webSearch:!0,xSearch:!0,xMediaSearch:!0,trendsSearch:!0,xPostAnalyze:!0},finance:{}};var eJ=a(42557);let eZ=()=>{let{t:e}=(0,y.Bd)("base"),t=(0,U.j)(O.A("open")),a=(0,_._)(),{user:s}=(0,eJ.wV)(),n=(0,eE.useRouter)(),r=(0,b.useCallback)(()=>{if(!s){a("sign_in_redirect",void 0,{location:"edit-image-suggestion-pill"}),n.push("/sign-in");return}a("image_editor_open",void 0,{location:"suggestion-pill"}),t()},[s,t,a,n]);return(0,i.jsxs)(p.gx,{variant:"outline",rounded:!0,tooltipProps:{delayDuration:100},tooltipContentProps:{side:"bottom",className:"bg-fg-primary text-background"},tooltipContent:s?void 0:e("Sign in to edit images","Sign in to edit images"),onClick:r,children:[(0,i.jsx)(u.mgJ,{size:18,strokeWidth:2,className:"text-secondary"}),(0,i.jsx)("span",{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:e("Edit Image","Edit Image")})]})};var e0=a(21782);function e1(e){let{suggestion:t,onClick:a}=e,{label:s}=t,n=(0,b.useCallback)(()=>{a(t)},[a,t]);return(0,i.jsxs)(p.$n,{size:"md",variant:"outline",rounded:!0,onClick:n,children:[(0,i.jsx)(e4,{suggestion:t}),(0,i.jsx)("p",{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:s})]})}function e2(e){let{suggestions:t,onClick:a,handleSend:s}=e,{user:n}=(0,eJ.wV)(),r=(0,z.C$)(O.A("isIncognito")),l=!r,o=Math.min(t.length,5)-!!l-!!(n&&!r)-2,d=(0,e0.f)(),c=e$.includes(d);return(0,i.jsx)("div",{className:"flex flex-col gap-2",children:(0,i.jsxs)("div",{className:"flex flex-row flex-wrap w-full gap-2 @sm:gap-2 justify-center items-center",children:[c&&t.slice(0,o).map(e=>{let t=e.type+e.prefix+e.prompt;return(0,i.jsx)(e1,{suggestion:e,onClick:a},t)}),l&&(0,i.jsx)(eZ,{}),(0,i.jsx)(ef.Ph,{handleSend:s})]})})}function e4(e){let{suggestion:t}=e,[a,s]=(0,b.useState)(!1),[n,r]=(0,b.useState)(!0);return t.icon&&!a?(0,i.jsxs)(i.Fragment,{children:[n&&(0,i.jsx)(e3,{suggestion:t}),(0,i.jsx)("img",{src:t.icon,alt:"".concat(t.type," icon"),className:"me-2 h-[18px] w-[18px] object-contain",onError:()=>s(!0),onLoad:()=>r(!1),style:{display:n?"none":"block"}})]}):(0,i.jsx)(e3,{suggestion:t})}let e5={className:"text-secondary",strokeWidth:2,size:18};function e3(e){let{suggestion:t}=e;switch(t.type){case"deepsearch":return(0,i.jsx)(u.Dd5,{...e5});case"brainstorm":return(0,i.jsx)(u.KqI,{...e5});case"analyzeData":case"createReport":return(0,i.jsx)(u.EsT,{...e5});case"createImage":return(0,i.jsx)(u.XGR,{...e5});case"code":return(0,i.jsx)(u.CyN,{...e5});default:return(0,i.jsx)(i.Fragment,{})}}let e6=(e,t)=>{var a,i;let s="",n=0;for(;n<e.length&&(null==(a=e[n])?void 0:a.toLowerCase())===(null==t||null==(i=t[n])?void 0:i.toLowerCase());)s+=e[n],n++;return s},e8=e=>{let{suggestion:t}=e,a=t.label||"",s=t.prefix||"",n=a.split(" ").map(e=>({text:e,isHighlighted:!1})),r=s.split(" ");return n=n.map((e,t)=>{if(t>=r.length)return e;let a=r[t].toLowerCase()===e.text.toLowerCase();return{...e,isHighlighted:a}}),(0,i.jsx)(i.Fragment,{children:n.map((e,t)=>{if(t===r.length-1&&e.text.toLowerCase().includes(r[t])){var a;let s=e6(e.text,r[t]);return(0,i.jsxs)(b.Fragment,{children:[(0,i.jsx)("span",{className:"font-medium text-primary",children:s}),(0,i.jsxs)("span",{className:"text-muted-foreground",children:[null==(a=e.text)?void 0:a.slice(null==s?void 0:s.length),"\xa0"]})]},t)}return e.isHighlighted?(0,i.jsxs)("span",{className:"font-medium text-primary",children:[e.text,"\xa0"]},t):(0,i.jsxs)("span",{className:"text-muted-foreground",children:[e.text,"\xa0"]},t)})})};var e9=a(75036),e7=a(76393);function te(e){var t,a,s,n,r,l;let{stockMiniSummary:o}=e,d=(0,B.Di)(),{t:c,i18n:p}=(0,y.Bd)("finance"),m=(0,E.h)(),g=(null!=(t=o.summary.change)?t:0)>=0?"+":"-",f=Math.abs(null!=(a=o.summary.change)?a:0),h=Math.abs(null!=(s=o.summary.value)?s:0),v=Math.abs(null!=(n=o.summary.changePercent)?n:0),x=(0,e9.h)(d,p.language),j=(null!=(l=null!=(r=o.summary.name)?r:o.summary.ticker)?l:"").replace(" Common Stock",""),[w,I]=(0,b.useState)(!1);return(0,i.jsxs)("div",{className:(0,S.cn)("flex flex-grow flex-row content-center items-center pl-4 pr-4 py-4 w-max text-muted-foreground","rounded-[16px]"),onMouseOver:()=>I(!0),onMouseLeave:()=>I(!1),children:[(0,i.jsxs)("div",{className:(0,S.cn)("flex flex-col w-[95%] gap-2"),children:[(0,i.jsxs)("div",{className:(0,S.cn)("flex items-center w-full gap-2"),children:[(0,i.jsx)("span",{className:(0,S.cn)("font-semibold"),children:o.summary.ticker})," \xb7"," ",(0,i.jsx)("span",{children:j})," \xb7 ",(0,i.jsx)("span",{children:c("stock-suggestion.Finance","Finance")})]}),(0,i.jsxs)("div",{className:(0,S.cn)("flex items-center w-full gap-2 "),children:[(0,i.jsx)("span",{className:(0,S.cn)("text-lg font-semibold"),children:x(h,o.summary.unit)}),(0,i.jsx)(e7.p,{value:f.toFixed(h<1?3:2),sign:g}),(0,i.jsx)(e7.p,{value:"".concat(v.toFixed(2),"%"),sign:g,prefix:"(",suffix:")"})]})]}),(0,i.jsx)("div",{className:(0,S.cn)("flex items-center justify-center w-[5%] ",w?"opacity-100":"opacity-0"),children:m.SHOW_FINANCIAL_PAGE&&(0,i.jsx)(u.c_$,{})})]})}let tt=e=>"finance"===e?"h-auto":"h-12 py-2 sm:px-3",ta=e=>{let{suggestions:t,currentInput:a,onClickSuggestion:s,onKeyboardSelectSuggestion:n,direction:r="column",prefix:l,setPrefix:o,position:d,setPosition:c,incrementSuggestionsShownCount:u,areReasoningModeSuggestions:p}=e,[m,g]=(0,b.useState)(!1),f=(0,E.h)();return(0,b.useEffect)(()=>{if(!a&&!p){c(void 0),o("");return}if((null==a?void 0:a.includes("\n"))||(null==l?void 0:l.length)>75)return;let e=e=>{let i=null==t?void 0:t.length;if(!i||p)return;if("Backspace"===e.key){o(""),c(void 0);return}let s=0;"ArrowDown"===e.key&&(e.preventDefault(),void 0!==d&&(s=(d+1)%i),d===i-1&&(s=void 0)),"ArrowUp"===e.key&&(e.preventDefault(),void 0!==d&&(s=(d-1)%i),0===d&&(s=void 0),void 0===d&&(s=i-1)),("ArrowUp"===e.key||"ArrowDown"===e.key)&&(void 0===s&&n({label:l}),void 0===s||l||o(a),void 0!==s&&n(null==t?void 0:t[s]),c(s)),function(e){return!(e.key.length>1||e.ctrlKey||e.altKey||e.metaKey||32>e.key.charCodeAt(0))&&/[ -~]/.test(e.key)}(e)&&(o(""),c(void 0))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[a,d,c,o,n,t,l,p]),(0,i.jsx)(x.P.ul,{className:"pb-2 overflow-hidden bg-background min-h-36",style:{display:"flex",flexDirection:r},children:(0,i.jsx)(v.N,{children:(t||[]).map((e,t)=>{let n=(0,i.jsx)(e8,{suggestion:e});return(null==e?void 0:e.img)&&!m&&(n=(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("img",{src:null==e?void 0:e.img,alt:"suggestion icon",className:"rounded-sm h-full me-2",onError:()=>g(!0)}),(0,i.jsx)("div",{className:"leading-[1.2]",children:(0,i.jsx)(e8,{suggestion:e})})]})),f.SHOW_FINANCE_SUGGESTIONS&&(null==e?void 0:e.type)==="finance"&&(null==e?void 0:e.payload)&&(n=(0,i.jsx)(te,{stockMiniSummary:null==e?void 0:e.payload})),(0,i.jsx)(x.P.li,{className:(0,S.cn)("cursor-pointer rounded-xl flex flex-row items-center",d===t?"sm:border-input-border-focus sm:bg-button-ghost-hover":"",tt(e.type)),onMouseEnter:()=>{void 0===d&&o(a),c(t)},initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20,transition:{duration:.05}},onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onClick:()=>{var a;s(null!=(a=e.prompt)?a:e.label,null==e?void 0:e.type,t)},transition:{type:"spring",stiffness:700,damping:35,delay:.05*t},onAnimationComplete:()=>{null==u||u()},children:n},t)})})})};function ti(){var e;let t=null==(e=(0,E.h)().EXTRA_SUGGESTIONS.value)?void 0:e.extraSuggestions;return(0,b.useMemo)(()=>{if(t)return[...Array.isArray(t)?t.map(e=>eV.safeParse(e)).filter(e=>e.success).map(e=>e.data):[],...eQ];return eQ},[t])}var ts=a(14461),tn=a(48589),tr=a(56521),tl=a(13511);let to=e=>({ar:"SA",bn:"IN",de:"DE",en:"US",es:"ES",fa:"US",fil:"US",fr:"FR",id:"ID",it:"IT",ja:"JP",ko:"KR",nl:"NL",pl:"PL",pt:"PT",ru:"RU",sv:"SE",tr:"TR","uk-UA":"US",vi:"US",zh:"CN","zh-TW":"TW",cs:"US",hi:"US",hu:"US",mr:"US",ta:"US",te:"US"})[e]||"US",td=e=>({ar:"ar",bn:"bn",de:"de",en:"en",es:"es",fr:"fr",id:"en",it:"it",ja:"jp",ko:"ko",nl:"nl",pl:"pl",pt:"pt-pt",ru:"ru",sv:"sv",tr:"tr","uk-UA":"uk",vi:"vi",zh:"zh-hans","zh-TW":"zh-hant"})[e]||"en",tc=eB.z.object({results:eB.z.array(eB.z.object({query:eB.z.string(),img:eB.z.string().optional(),description:eB.z.string().optional()}))}).catch(e=>((0,h.vV)("use-completions",e),{results:[]}));var tu=a(44465);let tp=e=>Array.isArray(e)?e.map(e=>eq.safeParse(e)).filter(e=>e.success).map(e=>e.data):[],tm=[{label:"Help me analyze Bitcoin during downturns",prompt:"Analyze the historical performance of Bitcoin during major global economic crises and project its potential behavior in a future downturn.",type:"analyzeData",prefix:"Help me "},{label:"Help me understand successful hedge fund strategies",prompt:"Analyze the 10 most successful options trading strategies used by hedge funds and their risk profiles.",type:"analyzeData",prefix:"Help me "},{label:"Help me predict interest rates",prompt:"Based on X post trends over the last month, what is the probability that the Fed will hold interest rates steady?",type:"analyzeData",prefix:"Help me "},{label:"How can I save on grocery bills each month?",prompt:"Explain how to save money on grocery bills each month for a family of four, step by step. Use a simple analogy, like planning a road trip where you map out the cheapest gas stations and snacks, to show strategies like meal planning, bulk buying, and using coupons.",type:"brainstorm",prefix:"How "},{label:"How would one plan and build a university in 1885?",prompt:"How much would it cost to plan and build a university in 1885?",type:"brainstorm",prefix:"How "},{label:"How would one design and build the Eiffel Tower in 1889?",prompt:"Describe the major engineering challenges and cultural motivations behind constructing the Eiffel Tower in 1889. Include details on the materials and construction techniques used, the societal and artistic influences of the time, and how the project reflected Frances technological ambitions during that era.",type:"brainstorm",prefix:"How "},{label:"Research the best gaming laptop",prompt:"Compare the best gaming laptops under $2,500 for GPU performance, cooling, and battery life.",type:"deepsearch",prefix:"Research "},{label:"Research best home kits for building your own robot",prompt:"What are the best microcontrollers and kits for building a beginner-friendly robot, comparing Arduino, Raspberry Pi, and ESP32?",type:"deepsearch",prefix:"Research "},{label:"Research best running shoes",prompt:"Compare the best running shoes for marathons based on cushioning, durability, and energy return.",type:"deepsearch",prefix:"Research "},{label:"Draw a river otter playing a ukulele",type:"createImage",prefix:"Draw "},{label:"Draw Isaac Newton with an apple falling from his hand",type:"createImage",prefix:"Draw "},{label:"Draw astronauts on the surface of the moon having a picnic in spacesuits",type:"createImage",prefix:"Draw "},{label:"Help me write a function",prompt:"Can you help me write a function? I have the requirements and need assistance with implementation.",type:"code",prefix:"Help me "},{label:"Help me debug my code",prompt:"Can you help me debug my code? I'll share the code snippet with you.",type:"code",prefix:"Help me "},{label:"Help me learn Python",prompt:"Can you help me learn Python? Start by asking me about my current level of programming knowledge.",type:"code",prefix:"Help me "}],tg=(e,t,a)=>("none"===a?tm:tm.filter(e=>{var t,a;return!(null==e||null==(a=e.label)||null==(t=a.toLowerCase())?void 0:t.startsWith("draw"))})).filter(t=>{var a;return null==t||null==(a=t.label)?void 0:a.startsWith(e)}).filter(e=>!t||(null==e?void 0:e.type)===t).map(t=>{var a;return{...t,prefix:e,label:e+(null==t||null==(a=t.label)?void 0:a.slice(null==e?void 0:e.length))}}),tf=()=>{let e=(0,E.h)(),t=(0,e0.f)(),a=null;return"en"===t&&(a=e.INPUT_SUGGESTIONS),"es"===t&&(a=e.INPUT_SUGGESTIONS_ES),"de"===t&&(a=e.INPUT_SUGGESTIONS_DE),"pt"===t&&(a=e.INPUT_SUGGESTIONS_PT),"fr"===t&&(a=e.INPUT_SUGGESTIONS_FR),"id"===t&&(a=e.INPUT_SUGGESTIONS_ID),"ja"===t&&(a=e.INPUT_SUGGESTIONS_JA),"vi"===t&&(a=e.INPUT_SUGGESTIONS_VI),"zh"===t&&(a=e.INPUT_SUGGESTIONS_ZH),{allDsSuggestions:(0,b.useMemo)(()=>{var e;return tp(null==a||null==(e=a.value)?void 0:e.deepsearchModeSuggestions)||[]},[a]),allThinkSuggestions:(0,b.useMemo)(()=>{var e;return tp(null==a||null==(e=a.value)?void 0:e.thinkModeSuggestions)||[]},[a])}},th=Math.random(),tv=e=>{var t,a;let{prefix:i,type:s="",incrementTypeaheadReqCount:n=()=>{}}=e,r=(0,o.aP)(O.A("reasoningMode")),{allDsSuggestions:l,allThinkSuggestions:d}=tf(),{suggestions:c}=function(e){let{prefix:t,incrementTypeaheadReqCount:a=()=>{}}=e,i=(0,e0.f)(),s=(0,z.C$)(O.A("userSettings")),n=(0,e0.f)(),[r,l]=(0,b.useState)([]),o=(0,tn.o)(t,50),d=(0,E.h)(),c=ti(),u=(0,b.useMemo)(()=>r.some(e=>t.startsWith(e)),[r,t]),p=(0,b.useMemo)(()=>c.some(e=>o===e.prefix)&&"en"===i,[c,o,i]),m=!s.preferences.disableTypeahead&&d.ENABLE_BRAVE_COMPLETIONS&&!p&&!u&&o.length>0&&o.length<=400&&o.split(" ").length<=50&&o.length>=3,{data:g}=(0,tl.IT)({queryKey:["typeahead",n,o],queryFn:async()=>{let e=await function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en",a=new URLSearchParams;a.set("q",e),a.set("rich","1"),a.set("lang",td(t)),a.set("country",to(t));let i=Date.now();return(0,tr.h)("/search?".concat(a.toString())).then(e=>e.json()).then(tc.parse).then(t=>({source:"brave",msTaken:Date.now()-i,suggestions:t.results.map(t=>({label:t.query,prompt:t.query,prefix:e,type:"search",...t})).filter(t=>t.label!==e)}))}(o,n);return null==a||a(),e.suggestions.length||l(e=>[...e,o]),e},enabled:m});return g}({prefix:i,incrementTypeaheadReqCount:n})||{},u=(0,ts.a)(i,c||[]),{isThinkSelected:p,isDeepsearchSelected:m}=(0,eO.QG)();return!i&&m?{suggestions:null==(t=(0,tu.N)(l,th))?void 0:t.slice(0,4),areReasoningModeSuggestions:!0}:!i&&p?{suggestions:null==(a=(0,tu.N)(d,th))?void 0:a.slice(0,4),areReasoningModeSuggestions:!0}:tm.some(e=>i===e.prefix)?{suggestions:tg(i,s,r)}:{suggestions:u||[]}};function tx(e){let{className:t,handleSend:a,position:s,setPosition:n,incrementTypeaheadReqCount:r=()=>{},incrementSuggestionsShownCount:l=()=>{},focusTextArea:d=()=>{}}=e,c=(0,o.aP)(O.A("setReasoningMode")),u=(0,E.h)(),[p,m]=(0,b.useState)(),[g,f]=(0,b.useState)(""),h=(0,o.aP)(O.A("conversationId"))||"no_conversation_id",v=(0,o.aP)(e=>e.queryByConversationId[h])||"",x=(0,b.useCallback)(e=>{let{idsetQueryByConversationId:t}=o.aP.getState();t(e,h)},[h]),{isThinkSelected:y,isDeepsearchSelected:j}=(0,eO.QG)(),w=(0,_._)(),{suggestions:I,areReasoningModeSuggestions:k}=tv({prefix:g||v,type:p,incrementTypeaheadReqCount:r});(0,b.useEffect)(()=>{v||(f(""),m(void 0))},[v]);let N=(0,b.useCallback)((e,t,a)=>{x(e),f(e),w("click_suggestion",e,{suggestionType:t,position:String(a),location:"chat-autocomplete-suggestions"})},[w,x]),C=!(0,b.useMemo)(()=>j||y?!!(null==I?void 0:I.length):!!v,[v,null==I?void 0:I.length,j,y])||!(null==I?void 0:I.length),P=(0,b.useCallback)(e=>{if(m(e.type),c(eX[e.type]),e.prefix){var t;let a="".concat(null==(t=e.prefix)?void 0:t.trim()).concat(v?":":"");(null==v?void 0:v.includes(a))||(x("".concat(a," ").concat(v)),null==d||d())}else e.prompt&&a({query:e.prompt,toolOverrides:eY[e.type],isPreset:!!u.SUGGESTIONS_USE_CACHE});w("click_suggestion_pill",e.label,{suggestionType:e.type,suggestionPrefix:String(e.prefix),suggestionPrompt:String(e.prompt),location:"chat-autocomplete-suggestions:handleClickTile"})},[x,v,a,u.SUGGESTIONS_USE_CACHE,w,c,d]),A=ti();return(0,i.jsxs)("div",{className:(0,S.cn)("z-10 w-full @xl:w-4/5 overflow-x-auto no-touch-scrollbar will-change-[mask-image] @sm:[mask-image:none] min-h-10",ez.Q,t),children:[(0,i.jsx)("div",{className:(0,S.cn)("absolute","bg-background w-full",ez.Q,"transition-opacity",I&&0!==I.length?"opacity-100":"opacity-0 pointer-events-none"),children:(0,i.jsx)(ta,{currentInput:v,suggestions:I,onClickSuggestion:N,onKeyboardSelectSuggestion:e=>x((null==e?void 0:e.label)||g),prefix:g,setPrefix:f,direction:"column",position:s,setPosition:n,incrementSuggestionsShownCount:l,areReasoningModeSuggestions:k})}),C&&(0,i.jsx)(e2,{suggestions:A,onClick:P,handleSend:a})]})}let tb=e=>{let{suggestions:t,onSelect:a,direction:s="column"}=e;return(null==t?void 0:t.length)?(0,i.jsx)(x.P.ul,{className:"pb-2 space-y-2 overflow-hidden bg-background",style:{display:"flex",flexDirection:s},children:(0,i.jsx)(v.N,{children:t.map((e,t)=>(0,i.jsx)(x.P.li,{className:"py-2 cursor-pointer sm:px-4 rounded-xl sm:hover:border-input-border-focus sm:hover:bg-button-ghost-hover",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20,transition:{duration:.1}},onClick:()=>{var i;return a(null!=(i=e.prompt)?i:e.label,e.type,t)},transition:{type:"spring",stiffness:700,damping:35,delay:.1*t},children:(0,i.jsx)(e8,{suggestion:e})},t))})}):null};var ty=a(62810);function tj(e){let{className:t,handleSend:a,focusTextArea:s}=e,[n,r]=(0,b.useState)(),l=(0,o.aP)(O.A("setReasoningMode")),d=(0,E.h)(),c=(0,_._)(),{scrollRef:u,className:p}=(0,ty.r)(),m=(0,o.aP)(O.A("conversationId"))||"no_conversation_id",g=(0,o.aP)(O.A("idsetQueryByConversationId")),f=(0,o.aP)(e=>e.queryByConversationId[m])||"",h=(0,b.useCallback)(e=>g(e,m),[m,g]),{suggestions:v}=tv({prefix:f,type:n});(0,b.useEffect)(()=>{0===f.length&&r(void 0)},[f]);let x=(0,b.useCallback)((e,t,a)=>{h(e),null==s||s(),c("click_suggestion",e,{suggestionType:t,location:"chat-prompt-suggestions-new",sugguestion:e,position:String(a)}),r(void 0)},[c,h,s]),y=(0,b.useCallback)(e=>{l(eX[e.type]),e.prefix?(h(e.prefix),r(e.type),null==s||s()):e.prompt&&a({query:e.prompt,toolOverrides:eY[e.type],isPreset:!!d.SUGGESTIONS_USE_CACHE}),c("click_suggestion_pill",e.label,{suggestionType:e.type,suggestionPrefix:String(e.prefix),suggestionPrompt:String(e.prompt),location:"chat-prompt-suggestions:handleClickTile"})},[l,c,h,s,a,d.SUGGESTIONS_USE_CACHE]),j=ti();return(0,i.jsx)("div",{ref:u,className:(0,S.cn)("w-full @xl:w-4/5 overflow-x-auto no-touch-scrollbar",ez.Q,p,t),children:(null==v?void 0:v.length)>0?(0,i.jsx)(tb,{suggestions:null==v?void 0:v.slice(0,3),onSelect:x}):(0,i.jsx)(e2,{suggestions:j,onClick:y,handleSend:a})})}var tw=a(73304);let tI=e=>{let{onHide:t}=e,a=(0,_._)(),s=(0,B.Di)(),{t:n}=(0,y.Bd)("tasks"),{taskPresets:r}=(0,eK.hB)(),l=(0,tw.d)(O.A("setCreateDialogIsOpen")),o=(0,tw.d)(O.A("setTaskToEdit")),[d,c]=(0,b.useState)(tk(r)[0]),m=(0,b.useCallback)(()=>{a("task_preset_clicked",void 0,{location:"PresetTaskPill"}),l(!0),o(d)},[d,l,o,a]),g=(0,b.useCallback)(e=>{a("task_preset_clicked",void 0,{location:"PresetTaskPill"}),l(!0),o(e),c(e)},[l,o,a]);return d?(0,i.jsxs)("div",{className:"flex items-center gap-2 w-full justify-center",children:[(0,i.jsxs)("div",{className:(0,S.cn)("rounded-3xl p-3 bg-surface-l1 border text-xs flex items-center justify-between",{"min-w-[500px]":!s}),children:[(0,i.jsx)(tS,{value:d,onValueChange:g}),(0,i.jsxs)(p.$n,{variant:"filledSecondary",size:"sm",rounded:!0,onClick:m,className:"font-semibold",children:[(0,i.jsx)(u.mdw,{size:14}),s?n("create-custom-task-dialog.schedule-task-short","Schedule"):n("create-custom-task-dialog.schedule-task","Schedule Task")]})]}),(0,i.jsx)(p.gx,{tooltipContent:(0,i.jsx)("p",{children:n("create-custom-task-dialog.schedule-task-hide","Hide")}),tooltipContentProps:{side:"bottom"},variant:"filledSecondary",size:"iconMd",rounded:!0,"aria-label":n("create-custom-task-dialog.schedule-task-hide","Hide"),onClick:t,children:(0,i.jsx)(u.X,{size:14})})]}):null};function tS(e){let{value:t,onValueChange:a}=e,[s,n]=(0,b.useState)(!1),{taskPresets:r}=(0,eK.hB)(),{t:l}=(0,y.Bd)("tasks"),o=(0,B.Di)(),d=(0,b.useCallback)(e=>{n(e)},[]);return(0,i.jsxs)(q.rI,{open:s,onOpenChange:d,children:[(0,i.jsx)(q.ty,{asChild:!0,children:(0,i.jsxs)(p.$n,{className:"flex items-center font-semibold",variant:"text","aria-label":l("selected-day.label","Selected day"),size:"sm",children:[t.cta||t.name,(0,i.jsx)(u.yQN,{size:14,className:(0,S.cn)("transition-transform duration-200",{"rotate-180":s})})]})}),(0,i.jsx)(q.SQ,{side:"bottom",align:"start",sideOffset:20,alignOffset:-12,className:(0,S.cn)({"w-[500px]":!o}),children:tk(r).map(e=>(0,i.jsxs)(q._2,{onClick:()=>{a(e)},className:"group flex items-center justify-between gap-2",children:[e.name,(0,i.jsx)(u.c_$,{size:14,className:"opacity-0 group-hover:opacity-100"})]},e.name))})]})}function tk(e){for(let t=e.length-1;t>0;t--){let a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}return e}let tN=()=>(0,i.jsx)(i.Fragment,{});function tC(){var e;let{t,i18n:a}=(0,y.Bd)("chat"),{isSuperGrokUser:s,isEnterpriseUser:n,isSuperGrokProUser:r,isPending:d}=(0,eL.Q2)(),{getUserTasksQuery:c}=(0,eK.y$)({fetchActive:!0}),{data:p,isLoading:m}=c,g=(0,z.C$)(O.A("selectedLanguage")),f=(0,b.useMemo)(()=>g||a.languages.find(e=>e in eR.IV)||eR.GG,[a.languages,g]),j=(0,l.a8)({isSuperGrokPro:r,isSuperGrok:s,isEnterprise:n,language:f}),w=(0,b.useRef)(""),{signInWithReturnTo:I}=(0,er.o)(),k=(0,_._)(),N=(0,E.h)(),{handleVoiceModeEnter:P}=(0,eI.F)({location:"chat-new"}),A=(0,o.aP)(O.A("establishNewConversation")),M=(0,z.C$)(O.A("isIncognito")),R=(0,o.aP)(O.A("activeModelId")),D=(0,o.aP)(O.A("defaultAnonModelId")),L=(0,o.aP)(O.A("defaultFreeModelId")),K=(0,o.aP)(O.A("defaultProModelId")),G=(0,o.aP)(O.A("setDefaultAnonModelId")),H=(0,o.aP)(O.A("setDefaultFreeModelId")),F=(0,o.aP)(O.A("setDefaultProModelId")),W=(0,o.aP)(O.A("outputMode")),V=(0,o.aP)(O.A("reasoningMode")),q=(0,o.aP)(O.A("setReasoningMode")),$=(0,eA.iV)(O.A("open")),Q=(0,T.x)(O.A("listByConversationId")),X=(0,T.x)(O.A("attachListByConversationId")),Y=(0,U.j)(O.A("isOpen")),J=(0,b.useMemo)(()=>Q.no_conversation_id||[],[Q]),Z=(0,b.useMemo)(()=>X.no_conversation_id||[],[X]),ee=(0,eO.$E)(),et=(0,B.Di)(),ea=(0,b.useMemo)(()=>!M&&(J.length>0&&!!J.every(e=>e.file.type.includes("image"))||(null==Z?void 0:Z.length)>0&&!!Z.every(e=>e.mimeType.includes("image"))),[J,Z,M]),es=(0,b.useMemo)(()=>!M&&N.SHOW_CREATE_REPORT_BUTTON_ON_ATTACHMENTS&&(J.length>0&&!!J.every(e=>e.metadata&&e.file.type.includes("csv"))||(null==Z?void 0:Z.length)>0&&!!Z.every(e=>e.mimeType.includes("csv"))),[J,Z,N.SHOW_CREATE_REPORT_BUTTON_ON_ATTACHMENTS,M]),[en,el]=(0,b.useState)(!1);(0,b.useEffect)(()=>{var e,t;let a=null!=(t=window.localStorage.getItem("hideTaskPillCount"))?t:0;a=Number(a),N.REPLACE_HOME_PILLS_WITH_TASKS&&(null==p||null==(e=p.tasks)?void 0:e.length)!==void 0&&0===p.tasks.length&&a<2&&el(!0)},[N.REPLACE_HOME_PILLS_WITH_TASKS,null==p||null==(e=p.tasks)?void 0:e.length]);let eo=(0,b.useCallback)(()=>{var e;let t=null!=(e=window.localStorage.getItem("hideTaskPillCount"))?e:0;window.localStorage.setItem("hideTaskPillCount",String(Number(t)+1)),el(!1)},[]),ed=(0,C.L)(),ec=(0,ei.useSession)().user,eu=(0,b.useRef)(null),ep=(0,b.useCallback)(()=>{var e;null==(e=eu.current)||e.focus()},[eu]);(0,eU.v)(eT.Ib,ep,[]);let{handleKeyDown:em,consumeCompositionTimeMs:eg,consumeBackspaceCount:eh,consumeAvgKeystrokeLatency:ev,consumeKeystrokeCount:ex,position:eb,setPosition:ey,consumePosition:ej,consumeTypeaheadReqCount:ew,incrementTypeaheadReqCount:eS,incrementSuggestionsShownCount:ek,consumeSuggestionsShownCount:eN}=(0,eD.T)(),eC=(0,b.useCallback)(async e=>{let{query:t,fileAttachmentIds:a,webpageUrls:i,toolOverrides:s,isPreset:n,workspaceIds:r}=e;if(!t)return!1;if(!ec&&(!N.ENABLE_ANON_USERS||ee.includes(R)))return k("sign_in","chat-new",{location:"chat-new"}),I(t,V),!1;let l=z.C$.getState(),o=ej(),d=s;return(null==N?void 0:N.ENABLE_BRAVE_COMPLETIONS)&&-1!==o&&void 0!==o&&!s&&(d={webSearch:!0}),k("send_query","",{selectedModel:R,fileAttachments:String((null==a?void 0:a.length)||0),webpageUrls:String((null==a?void 0:a.length)||0),location:"chat-new",outputMode:W,toolOverrides:JSON.stringify(d),reasoningMode:V,personalityId:l.userSettings.preferences.selectedSystemPromptId||"",personaId:"",messageLength:String(t.length),compositionTime:String(eg()),backspaceCount:String(eh()),avgKeystrokeLatency:String(ev()),keystrokeCount:String(ex()),position:String(o),typeaheadRequestCount:String(ew()),suggestionsShownCount:String(eN()),workspaceCount:String((null==r?void 0:r.length)||0)}),await ed(),!!await A({message:t,fileAttachmentIds:a,webpageUrls:i,toolOverrides:d,temporary:M,isPreset:n,enableRetries:N.ENABLE_AUTO_STREAM_RETRY,ff:N,workspaceIds:r}).catch(e=>{(0,h.vV)("chat-new:establishNewConversation",e)})},[R,ec,N,k,M,W,V,ee,ed,A,ev,eh,eg,ex,ej,eN,ew,I]),{modelById:eE,defaultAnonModelId:eB,defaultFreeModelId:eH,defaultProModelId:eF,isPending:eW}=(0,eO.GB)(),eV=(0,o.aP)(O.A("setActiveModelId")),eq=(0,o.aP)(O.A("setModelMode"));(0,b.useEffect)(()=>{if(eW||d&&ec)return;let e=new URLSearchParams(location.search),t=e.get("q"),a=e.get("reasoningMode"),i=e.get("fileid");if(K!==eF&&(n||s||r)&&eF&&eE[eF]){F(eF),eV(eF);return}if(L!==eH&&ec&&eH&&eE[eH]){H(eH),eV(eH);return}if(D!==eB&&eB&&eE[eB]){G(eB),eV(eB);return}if(a){let e=eG.TM.parse(a);e&&q(e)}t&&!w.current&&(eC({query:t,fileAttachmentIds:i?[i]:void 0,webpageUrls:[]}).catch(e=>{(0,h.vV)("chat-new:mount:handleSend",e)}),w.current="auto-start")},[eW,d]);let e$=(0,b.useCallback)(function(){for(var e=arguments.length,a=Array(e),i=0;i<e;i++)a[i]=arguments[i];let{query:s,parentQuotedText:n,fileAttachmentIds:r,webpageUrls:l,toolOverrides:o,isPreset:d,persona:c}=a[0];if(c){let e=(0,ef.pL)(c.personaId,t);e.modelMode&&eq(e.modelMode)}eC({query:s,parentQuotedText:n,fileAttachmentIds:r,webpageUrls:l,toolOverrides:o,isPreset:d}).catch(e=>{(0,h.vV)("chat-new:handleClickSuggestion",e)})},[eC,eq,t]),eQ=(0,b.useCallback)(()=>{let e=[...J.map(e=>e.metadata).filter(e=>e&&!(e instanceof Error)).map(e=>e.fileMetadataId),...Z.map(e=>e.assetId)];eC({query:t("create-report-prompt","Create a report"),fileAttachmentIds:e}).catch(e=>{(0,h.vV)("chat-new:handleClickCreateReport",e)})},[eC,J,Z,t]);return(0,i.jsxs)("div",{className:"flex flex-col items-center w-full h-full p-2 mx-auto justify-center @sm:p-4 @sm:gap-9 isolate mt-16 @sm:mt-0 overflow-scroll",children:[N.SHOW_GROK_4_PROMOTION_DIALOG&&(0,i.jsx)(tN,{}),(0,i.jsxs)("div",{className:"flex flex-col items-center gap-6 h-[450px] w-full @sm:pt-12 isolate",children:[(0,i.jsxs)("div",{className:(0,S.cn)("flex flex-col items-center justify-center w-full @sm:px-4 px-2 gap-6 @sm:gap-4 @xl:w-4/5 flex-initial pb-0",ez.Q),children:[(0,i.jsx)(j,{height:64,width:320}),et&&(0,i.jsx)(tj,{focusTextArea:ep,className:(0,S.cn)("@sm:hidden",{invisible:M}),handleSend:e$})]}),(0,i.jsxs)("div",{className:(0,S.cn)("absolute bottom-0 mx-auto inset-x-0",ez.Q,"@sm:relative flex flex-col items-center w-full gap-1 @sm:gap-5 @sm:bottom-auto @sm:inset-x-auto @sm:max-w-full"),children:[(0,i.jsxs)("div",{className:(0,S.cn)("flex flex-col-reverse items-center justify-between flex-1 w-full gap-0 @sm:gap-3 @sm:flex-col relative","p-2 @sm:p-0"),children:[(0,i.jsx)(eP.s,{className:"mt-2",textAreaClassName:"min-h-14 pt-5 my-0 mb-5",placeholder:t("query-bar-placeholder.1","What do you want to know?"),onQuery:eC,onFrontPage:!Y,ref:eu,isIncognito:M,enableVoiceMode:!0,onKeyDown:em,onVoiceModeEnter:P},"query-bar"),(0,i.jsxs)(v.N,{mode:"popLayout",initial:!1,children:[ea&&!M&&(0,i.jsx)(x.P.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:"bg-background rounded-full",children:(0,i.jsxs)(e_.R,{shouldGetFromStore:!0,buttonProps:{variant:"filledSecondary",size:"md",rounded:!0},location:"chat-new-input",children:[(0,i.jsx)(u.mgJ,{className:"size-5 text-secondary"}),t("Edit Image","Edit Image")]})},"edit"),es&&!M&&(0,i.jsx)(x.P.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:"bg-background rounded-full",children:(0,i.jsx)(e1,{suggestion:{type:"createReport",label:t("create-report","Create Report")},onClick:eQ})},"edit"),!m&&!et&&(en?(0,i.jsx)(x.P.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:(0,S.cn)("w-full flex justify-center",{invisible:M}),children:(0,i.jsx)(tI,{onHide:eo})},"task-pill"):!et&&!ea&&!es&&(0,i.jsx)(x.P.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:"w-full flex justify-center",children:(0,i.jsx)(tx,{className:(0,S.cn)("hidden @sm:block overflow-visible",M&&"invisible"),handleSend:e$,position:eb,setPosition:ey,incrementTypeaheadReqCount:eS,incrementSuggestionsShownCount:ek,focusTextArea:ep})},"suggestions"))]})]}),ec?null:(0,i.jsx)("div",{className:"text-[11px] @sm:text-xs text-secondary text-nowrap",children:(0,i.jsx)(y.x6,{ns:"chat",i18nKey:"clickwrapAgreement",defaults:"By messaging Grok, you agree to our <terms>Terms</terms> and <policy>Privacy Policy</policy>.",components:{terms:(0,i.jsx)("a",{className:"text-primary",href:"https://x.ai/legal/terms-of-service",target:"_blank",rel:"noopener noreferrer"}),policy:(0,i.jsx)("a",{className:"text-primary",href:"https://x.ai/legal/privacy-policy",target:"_blank",rel:"noopener noreferrer"})}})})]})]}),!(n||s||r)&&!$&&(0,i.jsx)(eM.Fp,{})]})}var tE=a(63209),tP=a(48992),t_=a(61214);function tA(e){let{conversationIsLoading:t,conversationError:a,optimisticConversationId:s,conversationId:n,conversation:r}=e,l=(0,A.K)(),d=(0,o.aP)(O.A("reconnectToInflightResponses")),c=(0,o.aP)(O.A("conversationMode")),[u,p]=(0,b.useState)(!1),m=(0,E.h)();return((0,b.useEffect)(()=>{(null==r?void 0:r.conversationId)&&(r.isNew||(p(!0),d(r.conversationId,m.ENABLE_AUTO_STREAM_RETRY,m).catch(e=>{l("chat-page:reconnectToInflightResponses",e)}).finally(()=>p(!1))),R.A3.getState().loadInitialResponses(r.conversationId).then(e=>{var t;let a=o.aP.getState();if(a.conversationId===(null==(t=e[0])?void 0:t.conversationId)){let t=(0,tP.Mb)(e);if(!t)return void a.setLastMessageId(void 0);if("streaming"===t.state||"reconnecting"===t.state){a.setLastMessageId(t.parentResponseId),a.setStreamedMessageId(t.responseId);return}if("optimistic"===t.state){a.setLastMessageId(t.parentResponseId),a.setOptimisticMessageId(t.responseId);return}a.setLastMessageId(t.responseId)}}).catch(e=>{l("chat-page:loadInitialResponses",e)}))},[null==r?void 0:r.conversationId]),s)?(0,i.jsx)(t_.T,{conversationId:s,conversation:void 0,isOptimisticConversation:!0,conversationIsLoading:t,conversationError:a,enableVoiceMode:!0},"voice"===c?"voice-chat-interaction":"chat-interaction"):n?(0,i.jsx)(t_.T,{conversationId:n,conversation:r||void 0,isOptimisticConversation:!1,conversationIsLoading:t,conversationError:a,isReconnecting:u,enableVoiceMode:!0},"chat-interaction"):null}var tM=a(52553),tT=a(92437);function tU(e){let{conversationId:t,containerRef:a,user:s}=e,{t:n}=(0,y.Bd)("chat"),r=function(e,t){let a=(0,o.aP)(O.A("activeModelId")),{modelById:i}=(0,eO.GB)(),s=null==i?void 0:i[a],{isAttachDisabled:n}=(0,eO.QG)(s),{attachFiles:r}=(0,tM.S)(),l=(0,_._)(),{user:d}=(0,ei.useSession)(),c=(0,T.x)(O.A("listByConversationId"))[e||"no_conversation_id"]||[];return"hover"===(0,tT.t)({onDrop:e=>{d&&(r(e),e.forEach(e=>{l("upload_file",e.name,{location:"file-drop",mimeType:e.type})}))},canDrop:e=>!n&&!!e.files.length&&(!c.length||!c.find(t=>{var a;return t.file.name===(null==(a=e.files[0])?void 0:a.name)})),ref:t},[c,d,n,r])}(t,a),l=(0,o.aP)(O.A("activeModelId")),{modelById:d}=(0,eO.GB)(),c=null==d?void 0:d[l],{isAttachDisabled:p,isThinkSelected:m,isDeepsearchSelected:g}=(0,eO.QG)(c);return(0,i.jsx)(v.N,{children:r&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-overlay z-50"},"drop-backdrop"),(0,i.jsx)(x.P.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:20},className:"absolute inset-0 z-50 flex items-center justify-center p-6 pointer-events-none",children:s?p?(0,i.jsxs)("div",{className:"rounded-2xl w-full max-w-xl bg-background flex flex-col items-center py-12 border-[1px] border-dashed border-input-border",children:[(0,i.jsx)("div",{children:(0,i.jsx)(u.lW3,{size:32,className:"text-red-400"})}),(0,i.jsx)("h2",{className:"mt-4 text-lg font-medium text-primary",children:n("Attachments are disabled","Attachments are disabled")}),(0,i.jsxs)("p",{className:"text-secondary",children:[n("Attachments are disabled for","Attachments are disabled for")," ",(0,i.jsx)("span",{className:"font-semibold",children:m?"Think":g?"DeepSearch":void 0})]})]}):(0,i.jsxs)("div",{className:"rounded-2xl w-full max-w-xl bg-background flex flex-col items-center py-12 border-[1px] border-dashed border-input-border",children:[(0,i.jsx)("div",{children:(0,i.jsx)(u.XGR,{size:32,className:"text-secondary"})}),(0,i.jsx)("h2",{className:"mt-4 text-lg font-medium text-primary",children:n("Drop your files here","Drop your files here")}),(0,i.jsx)("p",{className:"text-secondary",children:n("Drop your files here to add them to your conversation","Drop your files here to add them to your conversation")})]}):(0,i.jsxs)("div",{className:"flex flex-col items-center w-full max-w-xl py-12 border-4 border-red-400 border-dashed rounded-2xl bg-background",children:[(0,i.jsx)("div",{children:(0,i.jsx)(u.XGR,{size:32,className:"text-secondary"})}),(0,i.jsx)("h2",{className:"mt-4 mb-2 text-lg font-medium text-red-400",children:n("Sign in to attach files!","Sign in to attach files!")}),(0,i.jsx)("p",{className:"text-secondary",children:n("You must be signed in to attach files to your conversation","You must be signed in to attach files to your conversation")})]})},"drop-modal")]})})}let tR=e=>!!(null==e?void 0:e.liveThinkingStartTime)||!!(null==e?void 0:e.searchingStartTime),tz=()=>{let{t:e}=(0,y.Bd)("base"),t=(0,E.h)(),[a,s]=(0,b.useState)(""),[n,r]=(0,b.useState)(0),l=(0,o.aP)(e=>null==e?void 0:e.lastMessageId),d=(0,o.aP)(e=>null==e?void 0:e.streamedMessageId),c=(0,R.A3)(e=>{var t;return null==e||null==(t=e.byId)?void 0:t[l||""]}),u=(0,R.A3)(e=>{var t;return null==e||null==(t=e.byId)?void 0:t[d||""]}),[p,m]=(0,D.Mj)("notifications-ask-count",0),g=(0,z.C$)(e=>e.userSettings.preferences.browserNotificationsEnabled);(0,b.useEffect)(()=>{if(0===n||g)return;let e=setTimeout(()=>r(e=>e+1e3),1e3);return()=>clearTimeout(e)},[n]),(0,b.useEffect)(()=>{if(!g&&u&&tR(u)){if((null==u?void 0:u.state)==="streaming")return void r(1e3);(null==c?void 0:c.state)==="closed"&&r(0)}},[null==u?void 0:u.state,null==c?void 0:c.state]),(0,b.useEffect)(()=>{let e=n>=6e3&&n<7e3;!a&&!g&&e&&!(p>=2)&&(null==t?void 0:t.ENABLE_BROWSER_NOTIFICATIONS)&&(s((0,L.oR)((0,i.jsx)(tD,{onDismiss:f}),{duration:1/0,className:"inset-x-0 mx-auto"})),m(p+1))},[a,n]),(0,b.useEffect)(()=>{g&&((null==c?void 0:c.liveThinkingStartTime)||(null==c?void 0:c.searchingStartTime))&&(null==c?void 0:c.state)==="closed"&&h()},[c]);let f=()=>{L.oR.dismiss(a),s("")},h=()=>{var a;if((null==(a=document)||!a.hasFocus())&&(null==t?void 0:t.ENABLE_BROWSER_NOTIFICATIONS)){if(null==u?void 0:u.searchingStartTime)return void new Notification(e("notifications_answer_ready_search",'Your "DeepSearch" answer is ready'));new Notification(e("notifications_answer_ready",'Your "Think" answer is ready'))}};return h},tD=e=>{let{onDismiss:t=()=>{}}=e,{t:a}=(0,y.Bd)("base"),[s,n]=(0,b.useState)("ASK"),r=(0,z.C$)(O.A("fetchSetPreference")),l=async()=>{if("granted"===Notification.permission||(n("WAIT"),"granted"===await Notification.requestPermission())){n("ALLOWED"),await r("browserNotificationsEnabled",!0);return}n("DENIED")};return((0,b.useEffect)(()=>{if("ASK"===s){let e=setTimeout(()=>t(),4e3);return()=>clearTimeout(e)}if("WAIT"===s)return;let e=setTimeout(()=>t(),2e3);return()=>clearTimeout(e)},[s]),(0,g.f)()||"DENIED"===s)?null:"ALLOWED"===s?(0,i.jsxs)("div",{className:"flex items-center gap-4 min-w-[348px]",children:[(0,i.jsx)(u.Jlk,{className:"size-5"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-sm font-semibold",children:a("notifications_enabled_title","Notifications enabled")}),(0,i.jsx)("div",{className:"text-xs text-secondary",children:a("notifications_enabled_subtitle","We'll keep you updated")})]})]}):(0,i.jsxs)("div",{className:"flex justify-between items-center gap-4 relative group min-w-[348px]",children:[(0,i.jsxs)("div",{className:"flex items-center gap-4",children:[(0,i.jsx)(u.ZVq,{className:"size-5"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-sm font-semibold",children:a("notifications_ask_title","Get notified when answer ready")}),(0,i.jsx)("div",{className:"text-xs text-secondary",children:a("notifications_ask_subtitle","Enable notifications")})]})]}),(0,i.jsx)(p.$n,{className:"rounded-xl px-2 py-2",variant:"secondary",disabled:"WAIT"===s,onClick:l,children:a("notifications_enable","Enable")})]})};function tO(){let e=(0,eE.useSearchParams)(),t=(0,E.h)(),a=(0,A.K)(),{signInWithReturnTo:l}=(0,er.o)(),{user:d}=(0,ei.useSession)(),{handleVoiceModeEnter:c}=(0,eI.F)({location:"voice-chat-page"}),u=(0,o.aP)(O.A("optimisticConversationId")),p=(0,o.aP)(O.A("conversationId")),m=(0,es.w)(O.A("fetchGetConversation")),g=(0,o.aP)(O.A("conversationMode")),f=(0,o.aP)(O.A("voiceConnectionStatus")),v=(0,o.aP)(O.A("exitVoiceMode")),x=(0,z.C$)(e=>e.userSettings.preferences.showActiveTabs),j=(0,U.j)(O.A("isOpen")),{route:w,replace:I}=(0,eC.wK)();(0,b.useEffect)(()=>{var e;if("chat"===w.page&&w.temporary)return;let t="chat"===w.page&&null!=(e=w.conversationId)?e:void 0;o.aP.setState({conversationId:t})},[w]);let k=e.get("reasoningMode");(0,b.useEffect)(()=>{k&&I({...w})},[w,k,I]),tz(),function(){let e=(0,eE.useSearchParams)(),{t}=(0,y.Bd)("chat"),a=(0,eE.useRouter)(),i=(0,b.useRef)(!1),s=e.get(eS.il),n=(0,eN.M4)(s||"");(0,b.useEffect)(()=>{if(!i.current&&s){setTimeout(()=>L.oR.success(t("oauth.connection.success","Successfully connected {{provider}}!",{provider:n})),0),i.current=!0;let e=new URL(window.location.href);e.searchParams.delete(eS.il),a.replace("".concat(e.pathname).concat(e.search).concat(e.hash,"/"),{scroll:!1})}},[n,s,a,t])}(),function(e){let t=(0,es.w)(t=>e?t.byId[e]:void 0);(0,ek.r)(null==t?void 0:t.title)}(p);let{data:N,isLoading:C,error:P}=(0,eg.v)(p?m(p):void 0);(0,b.useEffect)(()=>{o.aP.getState().setChatPageLoaded(!0)},[]),(0,b.useEffect)(()=>{j&&"voice"===g&&v("navigation").catch(e=>{a("chat-page:exitVoiceMode",e)})},[j,g,v,a]),(0,b.useEffect)(()=>{if("voice"in w&&w.voice&&"voice"!==g&&(I({page:"main",voice:!1}),t.ENABLE_VOICE_MODE))if(d)c().catch(e=>(0,h.vV)("chat-page:handleVoiceModeEnter",e));else{(0,h.iu)("sign_in","voice-chat-page",{location:"voice-chat-page"}),l(void 0,void 0,!0);return}},[w,I,g,c,f,d,l,t]);let _=(0,b.useRef)(null);return(0,i.jsx)(r.t,{fallbackRender:()=>(0,i.jsx)(tL,{}),children:(0,i.jsxs)("main",{ref:_,className:(0,S.cn)("h-dvh flex-grow flex-shrink relative selection:bg-highlight w-0","@container isolate","print:h-full print:prose print:max-w-none"),children:[(0,i.jsx)(n.a,{hidden:!0}),(0,i.jsx)(tU,{conversationId:p,containerRef:_,user:d}),(0,i.jsx)(tE.hx,{showTasks:!0,conversationIsLoading:C,conversation:N||void 0,isOptimisticConversation:!!u}),(0,i.jsx)(s.CommandMenu,{}),u||p?(0,i.jsx)(tA,{optimisticConversationId:u,conversationIsLoading:C,conversationError:P,conversationId:p,conversation:N},"conversation-view"):(0,i.jsx)(tC,{}),(0,i.jsx)(ea,{}),t.ENABLE_CONVERSATION_TABS&&!t.USE_APP_SIDEBAR_V2&&x&&(0,i.jsx)(ej,{})]},"chat-page")})}function tL(){let{t:e}=(0,y.Bd)("chat");return(0,i.jsx)("div",{className:"w-full h-dvh flex justify-center items-center align-middle",children:(0,i.jsxs)("div",{className:"w-full max-w-lg text-center",children:[(0,i.jsx)(eC.N_,{route:{page:"main"},className:"mb-6 flex justify-center",children:(0,i.jsx)(l.r1,{height:20,width:60,className:"opacity-80 hover:opacity-100 fill-black dark:fill-white"})}),(0,i.jsx)("div",{children:e("There was an error","There was an error")}),(0,i.jsx)("div",{className:"mt-6",children:(0,i.jsx)(p.$n,{variant:"primary",size:"md",onClick:()=>{window.location.href="/"},children:e("Return to Home","Return to Home")})})]})})}}}]);